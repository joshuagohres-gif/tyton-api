<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Tyton Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@400;600;700;800&family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&family=Space+Grotesk:wght@400;500;600;700&family=Space+Mono:wght@400;700&family=Bebas+Neue&display=swap');
    
    :root{
      --navy:#0a0d1a; --gold:#daa520; --maroon:#7a263a; --ink:#050814; --muted:#a8c8ec; --bg:#060b16;
      --card:#0e1425; --ring:#1a2847; --ring-focus:#daa520; --white:#f0f9ff; --shadow:rgba(0,0,0,.6);
      --gradient-primary: linear-gradient(135deg, #b8860b 0%, #daa520 30%, #ffb627 70%, #ffd700 100%);
      --gradient-secondary: linear-gradient(135deg, #00d4aa 0%, #0891b2 50%, #0284c7 100%);
      --gradient-mystical: linear-gradient(135deg, #8b5cf6 0%, #a855f7 30%, #c084fc 70%, #e879f9 100%);
      --glow-primary: rgba(218,165,32,.2);
      --glow-secondary: rgba(8,145,178,.15);
      --glow-mystical: rgba(168,85,247,.15);
      --surface-elevated: rgba(14,20,37,.85);
      --border-subtle: rgba(168,200,236,.12);
      --border-accent: rgba(218,165,32,.5);
      --atomic-cyan: #00d4aa;
      --cosmic-purple: #8b5cf6;
      --retro-orange: #daa520;
    }
    
    html,body{
      margin:0;padding:0;
      background: 
        radial-gradient(ellipse at 15% 20%, rgba(255,107,53,.06) 0%, transparent 60%),
        radial-gradient(ellipse at 85% 30%, rgba(0,212,170,.04) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 80%, rgba(139,92,246,.03) 0%, transparent 40%),
        radial-gradient(ellipse at 30% 60%, rgba(255,182,39,.02) 0%, transparent 45%),
        conic-gradient(from 0deg at 50% 50%, var(--bg) 0deg, #0a1121 120deg, #051018 240deg, var(--bg) 360deg);
      color:var(--white); 
      font:14px/1.5 'Space Grotesk', 'Inter', 'SF Pro Display', 'Segoe UI', system-ui, sans-serif;
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }

    /* Atomic Age Typography */
    h1, h2, h3, h4, h5, h6, .page-title {
      font-family: 'Exo 2', 'Orbitron', 'Rajdhani', 'Space Mono', 'Space Grotesk', monospace;
      font-weight: 700;
      letter-spacing: 1px;
      text-transform: uppercase;
      background: linear-gradient(135deg, var(--white) 0%, #e2e8f0 50%, var(--gold) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 20px rgba(218,165,32,0.15);
    }

    .page-title {
      font-size: clamp(24px, 4vw, 36px);
      font-weight: 800;
      letter-spacing: 2px;
      text-align: center;
      margin-bottom: 16px;
    }
    
    html::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(2px 2px at 20% 30%, var(--atomic-cyan), transparent),
        radial-gradient(2px 2px at 40% 70%, var(--retro-orange), transparent),
        radial-gradient(1px 1px at 90% 40%, var(--cosmic-purple), transparent),
        radial-gradient(1px 1px at 60% 10%, var(--atomic-cyan), transparent),
        radial-gradient(2px 2px at 80% 80%, var(--retro-orange), transparent);
      background-size: 200px 200px, 300px 300px, 150px 150px, 250px 250px, 180px 180px;
      opacity: 0.08;
      pointer-events: none;
      z-index: -1;
      animation: atomicFloat 20s linear infinite;
    }
    
    @keyframes atomicFloat {
      0% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(-10px, -5px) rotate(120deg); }
      66% { transform: translate(5px, -10px) rotate(240deg); }
      100% { transform: translate(0, 0) rotate(360deg); }
    }
    
    @keyframes betaGlow {
      0% { 
        text-shadow: 0 0 15px rgba(139,92,246,0.6), 0 0 25px rgba(139,92,246,0.3);
        background-position: 0% 50%;
      }
      16.67% {
        text-shadow: 0 0 17px rgba(168,85,247,0.7), 0 0 28px rgba(168,85,247,0.4);
        background-position: 16.67% 50%;
      }
      33.33% {
        text-shadow: 0 0 19px rgba(196,132,252,0.75), 0 0 32px rgba(196,132,252,0.45);
        background-position: 33.33% 50%;
      }
      50% {
        text-shadow: 0 0 20px rgba(232,121,249,0.8), 0 0 35px rgba(232,121,249,0.5), 0 0 45px rgba(232,121,249,0.2);
        background-position: 50% 50%;
      }
      66.67% {
        text-shadow: 0 0 19px rgba(251,191,36,0.75), 0 0 32px rgba(251,191,36,0.45);
        background-position: 66.67% 50%;
      }
      83.33% {
        text-shadow: 0 0 17px rgba(239,68,68,0.7), 0 0 28px rgba(239,68,68,0.4);
        background-position: 83.33% 50%;
      }
      100% { 
        text-shadow: 0 0 15px rgba(139,92,246,0.6), 0 0 25px rgba(139,92,246,0.3);
        background-position: 100% 50%;
      }
    }
    
    [x-cloak]{display:none!important;}

    /* Enhanced Header */
    header{
      position: fixed; 
      top: 0; 
      left: 0;
      right: 0;
      z-index: 1100; 
      backdrop-filter: blur(20px) saturate(180%);
      background:
        linear-gradient(180deg, var(--surface-elevated) 0%, rgba(15,22,41,.6) 100%);
      box-shadow:
        0 8px 32px rgba(0,0,0,.4),
        0 1px 0 rgba(230,169,26,.1),
        inset 0 1px 0 rgba(241,245,249,.05);
      border-bottom: 1px solid var(--border-accent);
    }
    
    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: var(--gradient-primary);
      opacity: 0.6;
    }
    
    .bar{
      width: 100%;
      display:flex; justify-content: space-between;
      align-items:center; gap:16px; padding:12px 0 12px 20px;
      position: relative;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
      position: relative;
      z-index: 1300; /* Ensure the container has proper stacking context */
    }
    
    .brand{
      display:flex; align-items:center; gap:12px; 
      text-decoration:none; color:var(--white);
      transition: transform 0.2s ease;
    }
    
    .brand:hover {
      transform: scale(1.02);
    }
    
    .brand img{
      width:40px;height:40px; border-radius:10px; 
      display:block; 
      box-shadow:
        0 6px 20px rgba(0,0,0,.4),
        0 0 0 1px rgba(230,169,26,.3),
        0 0 15px var(--glow-primary);
      border: 2px solid var(--border-accent);
      object-fit: cover;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .brand:hover img {
      transform: translateY(-2px) scale(1.02);
      box-shadow:
        0 12px 35px rgba(0,0,0,.6),
        0 0 0 1px rgba(230,169,26,.5),
        0 0 30px var(--glow-primary);
    }
    
    .brand span{
      font-weight:700; letter-spacing:.8px; font-size: 16px;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .brand[aria-current="page"] {
      background: rgba(218,165,32,.15);
      border: 1px solid rgba(218,165,32,.3);
      border-radius: 10px;
      padding: 8px 12px;
    }
    
    /* Logo Container */
    .logo-container {
      position: relative;
    }

    /* User Dropdown - Simple and working */
    #user-dropdown {
      position: fixed !important;
      z-index: 999999 !important;
      pointer-events: auto !important;
    }
    
    #user-dropdown.visible {
      display: block !important;
      visibility: visible !important;
    }
    
    .nav{display:flex; justify-content:center; gap:12px;}
    .nav button{
      appearance:none;border:1px solid transparent;background:transparent;
      color:var(--white); padding:10px 16px;border-radius:25px; cursor:pointer;
      font-weight: 500; transition: all 0.3s ease;
      position: relative; overflow: hidden;
    }
    
    .nav button:hover { 
      background: rgba(255,255,255,.1);
      transform: translateY(-1px); 
    }
    
    .nav button[aria-current="page"]{
      background:rgba(218,165,32,.2); 
      border-color:rgba(218,165,32,.5);
      box-shadow: 0 0 0 2px rgba(218,165,32,.3);
    }
    
    .right{display:flex; justify-content:flex-end; align-items:center; gap:12px; margin-left: auto; flex-shrink: 0; min-width: 200px;}
    .badge{
      font-size:11px; color:#cbd5e1; border:1px solid #334155; 
      padding:4px 12px; border-radius:20px; 
      background:rgba(15,23,42,.8);
      backdrop-filter: blur(4px);
      font-weight: 500;
    }

    .badge.online { color: #22c55e; border-color: #16a34a; }
    .badge.offline { color: #ef4444; border-color: #dc2626; }

    /* Enhanced Main Content */
    main{max-width:1200px;margin:24px auto; padding:0 20px 100px;}
    
    .page-title {
      text-align: center;
      margin: 0 0 40px 0;
      font-size: 32px;
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      letter-spacing: -0.5px;
      filter: drop-shadow(0 0 20px var(--glow-primary));
    }
    
    .page-title::before,
    .page-title::after {
      content: '';
      flex: 1;
      height: 1px;
      background: linear-gradient(to right, transparent, var(--border-accent), transparent);
      margin: 0 20px;
      max-width: 100px;
    }
    
    .grid{
      display:grid; 
      grid-template-columns: repeat(auto-fill,minmax(320px,1fr)); 
      gap:20px;
    }
    
    /* Enhanced Cards */
    .card{
      background:
        linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.9) 100%),
        linear-gradient(135deg, rgba(255,107,53,.08) 0%, rgba(139,92,246,.05) 50%, rgba(0,212,170,.07) 100%);
      border: 1px solid var(--border-subtle);
      border-radius: 20px; 
      padding: 24px;
      box-shadow:
        0 20px 40px rgba(0,0,0,.3),
        0 8px 16px rgba(0,0,0,.2),
        inset 0 1px 0 rgba(241,245,249,.08);
      backdrop-filter: blur(16px) saturate(180%);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      transform: translateZ(0);
      will-change: transform, box-shadow;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #b8860b, #daa520, #ffd700, transparent);
      opacity: 0.8;
      pointer-events: none;
      box-shadow: 0 0 8px rgba(218, 165, 32, 0.2);
    }
    
    .card::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(circle at 25% 25%, rgba(255,107,53,0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(139,92,246,0.08) 0%, transparent 50%),
        radial-gradient(circle at 50% 80%, rgba(0,212,170,0.12) 0%, transparent 45%);
      animation: cosmic-drift 25s ease-in-out infinite;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      transform: translateZ(0);
    }
    
    
    .card:hover {
      transform: translateY(-8px) scale(1.02) translateZ(0);
      box-shadow:
        0 32px 64px rgba(0,0,0,.4),
        0 16px 32px rgba(0,0,0,.3),
        0 0 0 1px #daa520,
        0 0 20px rgba(218,165,32,0.3),
        0 0 40px rgba(255,215,0,0.15),
        0 6px 30px rgba(184,134,11,0.15),
        inset 0 1px 0 rgba(255,255,255,0.12);
      border-color: #daa520;
    }
    
    .card:hover::after { 
      opacity: 0.7;
    }
    
    /* Profile Card - Keep effects contained within frame */
    .profile-card {
      background:
        linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.9) 100%),
        linear-gradient(135deg, rgba(255,107,53,.08) 0%, rgba(139,92,246,.05) 50%, rgba(0,212,170,.07) 100%);
      overflow: hidden !important;
    }
    
    .profile-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #b8860b, #daa520, #ffd700, transparent);
      opacity: 0.8;
      pointer-events: none;
      box-shadow: 0 0 8px rgba(218, 165, 32, 0.2);
      z-index: 1;
    }
    
    .profile-card::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 25% 25%, rgba(255,107,53,0.06) 0%, transparent 40%),
        radial-gradient(circle at 75% 75%, rgba(139,92,246,0.04) 0%, transparent 40%),
        radial-gradient(circle at 50% 80%, rgba(0,212,170,0.08) 0%, transparent 35%);
      animation: cosmic-drift 25s ease-in-out infinite;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      transform: translateZ(0);
      z-index: 0;
    }
    
    .profile-card:hover {
      transform: translateY(-4px) scale(1.01) translateZ(0);
      box-shadow:
        0 24px 48px rgba(0,0,0,.35),
        0 12px 24px rgba(0,0,0,.25),
        0 0 0 1px rgba(218,165,32,0.3),
        0 0 16px rgba(218,165,32,0.2),
        inset 0 1px 0 rgba(255,255,255,0.1);
      border-color: rgba(218,165,32,0.4);
    }
    
    .profile-card:hover::after { 
      opacity: 0.4;
    }
    
    /* Ensure profile content stays above the background effects */
    .profile-card .profile {
      position: relative;
      z-index: 2;
    }
    
    .card h3{
      margin:0 0 8px 0; font-size:18px; font-weight: 600;
      color: var(--white);
      font-family: 'Exo 2', 'Orbitron', 'Space Grotesk', sans-serif;
      letter-spacing: 0.5px;
    }
    
    .card .meta{
      color:var(--muted); font-size:12px; 
      background: rgba(148,163,184,.1);
      padding: 4px 8px; border-radius: 8px;
      display: inline-block; margin-bottom: 12px;
    }
    
    .card p { line-height: 1.6; color: rgba(255,255,255,.9); }
    
    /* Clickable project cards */
    .clickable-project {
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .clickable-project:hover {
      transform: translateY(-12px) scale(1.03) translateZ(0);
      box-shadow:
        0 40px 80px rgba(0,0,0,.5),
        0 20px 40px rgba(0,0,0,.4),
        0 0 0 2px var(--gold),
        inset 0 1px 0 rgba(255,255,255,0.1);
    }
    
    .clickable-project h3 {
      color: var(--gold);
      transition: color 0.3s ease;
    }

    /* Clickable equipment cards */
    .clickable-equipment {
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .clickable-equipment:hover {
      transform: translateY(-12px) scale(1.03) translateZ(0);
      box-shadow:
        0 40px 80px rgba(0,0,0,.5),
        0 20px 40px rgba(0,0,0,.4),
        0 0 0 2px var(--gold),
        0 0 20px var(--glow-primary),
        0 0 40px var(--glow-primary),
        0 6px 30px rgba(184,134,11,0.15),
        inset 0 1px 0 rgba(255,255,255,0.12);
      border-color: var(--gold);
    }
    
    .clickable-equipment h3 {
      color: var(--gold);
      transition: color 0.3s ease;
    }
    
    .actions{display:flex; gap:8px; margin-top:16px; flex-wrap: wrap;}
    
    /* Enhanced Buttons */
    .btn{
      appearance:none; 
      border:1px solid var(--border-subtle); 
      background: rgba(241,245,249,.08);
      color:var(--white); 
      padding:10px 18px; 
      border-radius:14px; 
      cursor:pointer;
      font-weight: 500; 
      transition: all 0.3s ease;
      display: inline-flex; 
      align-items: center; 
      gap: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
    }
    
    
    /* .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(241,245,249,.1), transparent);
      transition: left 0.6s ease;
      pointer-events: none;
      z-index: -1;
    } */
    
    .btn:hover{
      border-color:var(--border-accent); 
      background:
        linear-gradient(135deg, rgba(241,245,249,.15) 0%, rgba(241,245,249,.08) 100%);
      transform: translateY(-2px);
      box-shadow:
        0 8px 25px rgba(0,0,0,.2),
        0 0 0 1px var(--border-accent),
        inset 0 1px 0 rgba(241,245,249,.15);
    }
    
    /* .btn:hover::before {
      left: 100%;
    } */
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn.gold{
      background:var(--gradient-primary); 
      color:#0a0600; border-color:var(--border-accent);
      font-weight: 600;
      box-shadow: 
        0 8px 25px var(--glow-primary),
        0 4px 12px rgba(0,0,0,.2),
        inset 0 1px 0 rgba(255,255,255,.2);
      text-shadow: 0 1px 2px rgba(0,0,0,.3);
    }
    
    /* .btn.gold::before {
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.3), transparent);
      pointer-events: none;
    } */
    
    .btn.gold:hover {
      box-shadow: 
        0 12px 35px var(--glow-primary),
        0 6px 20px rgba(0,0,0,.3),
        0 0 0 1px rgba(218,165,32,.6),
        inset 0 1px 0 rgba(255,255,255,.3);
      transform: translateY(-3px) scale(1.02);
    }
    
    /* Profile Actions Container */
    .profile-actions {
      position: absolute !important;
      bottom: 20px !important;
      right: 24px !important;
      top: auto !important;
      left: auto !important;
      display: flex !important;
      flex-direction: row !important;
      align-items: center;
      justify-content: flex-end;
      gap: 12px;
      z-index: 10 !important;
      width: auto;
      height: auto;
    }

    /* Stylized Edit Profile Button */
    .edit-profile-button {
      position: relative;
      background: linear-gradient(135deg, var(--gradient-primary) 0%, #ffb627 50%, #ffd700 100%);
      border: 2px solid rgba(218,165,32,.8);
      border-radius: 16px;
      padding: 10px 16px;
      color: var(--white);
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 8px 25px rgba(218,165,32,.4),
        0 4px 12px rgba(0,0,0,.2),
        inset 0 1px 0 rgba(255,255,255,.3);
      text-shadow: 0 1px 2px rgba(0,0,0,.8);
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(8px);
      overflow: hidden;
      z-index: 1;
      min-height: 40px;
      white-space: nowrap;
      flex-shrink: 0;
    }
    
    .edit-profile-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.4), transparent);
      transition: left 0.6s ease;
      pointer-events: none;
    }
    
    .edit-profile-button:hover::before {
      left: 100%;
    }
    
    .edit-profile-button:hover {
      transform: translateY(-2px) scale(1.05);
      box-shadow: 
        0 12px 35px rgba(218,165,32,.6),
        0 8px 20px rgba(0,0,0,.3),
        0 0 0 1px rgba(255,215,0,.8),
        0 0 20px rgba(255,215,0,.4),
        inset 0 1px 0 rgba(255,255,255,.4);
      border-color: rgba(255,215,0,.9);
      background: linear-gradient(135deg, #ff7a47 0%, #ff8c3e 30%, #ffb627 70%, #ffd700 100%);
    }
    
    .edit-icon {
      font-size: 16px;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,.5));
      position: relative;
      z-index: 1;
    }
    
    .edit-text {
      position: relative;
      z-index: 1;
      letter-spacing: 0.3px;
    }
    
    /* Specific button positioning within container */
    .profile-actions #edit-profile-btn {
      order: 1;
    }
    
    .profile-actions #post-btn {
      order: 2;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .profile-actions {
        bottom: 14px !important;
        right: 16px !important;
        gap: 8px;
        flex-direction: row;
      }
      
      .edit-profile-button {
        padding: 8px 12px;
        font-size: 13px;
      }
      
      .edit-icon {
        font-size: 14px;
      }
    }
    
    .btn.ghost{
      border-color:rgba(218,165,32,.4); 
      color:#ffd700;
      background: rgba(218,165,32,.1);
    }
    
    .btn.ghost:hover {
      background: rgba(218,165,32,.2);
      box-shadow: 0 0 16px rgba(218,165,32,.3);
    }

    /* Enhanced Forms */
    .field{display:grid; gap:8px; margin-bottom:16px}
    .field label { font-weight: 500; color: var(--white); }
    
    .field input,.field textarea,.field select{
      background:#0f172a; color:var(--white); 
      border:1px solid var(--ring); border-radius:12px; 
      padding:12px 14px; outline:none;
      transition: all 0.3s ease;
      font-family: inherit;
    }

    /* Authentication Modal Styles */
    .auth-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .auth-modal-content {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      padding: 20px;
    }

    .auth-card {
      max-width: 400px;
      width: 100%;
      position: relative;
    }

    .auth-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      color: var(--muted);
      font-size: 20px;
      cursor: pointer;
      z-index: 1;
      transition: color 0.2s ease;
    }

    .auth-close:hover {
      color: var(--white);
    }

    .auth-form {
      display: none;
    }

    .auth-title {
      text-align: center;
      margin-bottom: 24px;
      font-size: 24px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .auth-divider {
      text-align: center;
      margin: 16px 0;
      color: var(--muted);
    }

    .auth-link-text {
      text-align: center;
      margin-top: 16px;
      color: var(--muted);
    }

    .auth-link-btn {
      background: none;
      border: none;
      color: var(--gold);
      cursor: pointer;
      text-decoration: underline;
      font-family: inherit;
      transition: color 0.2s ease;
    }

    .auth-link-btn:hover {
      color: #f3bd4b;
    }

    .btn-full {
      width: 100%;
      margin-bottom: 16px;
      text-decoration: none;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
    }

    .btn-google {
      padding: 12px 16px;
      font-size: 14px;
      white-space: nowrap;
    }

    /* Fixed Left Navigation Sidebar */
    .nav-sidebar {
      position: fixed;
      top: 0; /* Start at top to pass under header */
      left: 0;
      width: 220px;
      height: 100vh;
      background: linear-gradient(180deg, var(--surface-elevated) 0%, rgba(15,22,41,.95) 100%);
      border-right: 1px solid var(--border-accent);
      box-shadow: 4px 0 20px rgba(0,0,0,.3);
      backdrop-filter: blur(16px);
      z-index: 900; /* Lower than header */
      display: flex;
      flex-direction: column;
      padding: 76px 0 20px 0; /* Top padding to align with header height */
    }

    .nav-sidebar::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 1px;
      height: 100%;
      background: var(--gradient-primary);
      opacity: 0.6;
    }

    
    .nav-menu {
      flex: 1;
      padding: 0 16px;
    }
    
    .nav-item {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 14px 20px;
      margin-bottom: 4px;
      background: none;
      border: none;
      color: var(--white);
      text-align: left;
      cursor: pointer;
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      border-radius: 10px;
      position: relative;
    }

    
    .nav-item:hover {
      background: rgba(255,255,255,.08);
      color: var(--gold);
      transform: translateX(4px);
    }

    .nav-item img {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      opacity: 0.8;
      transition: opacity 0.2s ease;
    }

    .nav-item:hover img {
      opacity: 1;
    }

    .nav-item[aria-current="page"] {
      background: rgba(218,165,32,.15);
      color: var(--gold);
      border-left: 3px solid var(--gold);
      margin-left: -3px;
      padding-left: 23px;
    }

    .nav-item[aria-current="page"] img {
      opacity: 1;
    }
    
    /* Sidebar Weather Widget */
    .sidebar-weather-widget {
      margin: 20px 16px 16px 16px;
      padding: 12px;
      background: rgba(14,20,37,.7);
      border: 1px solid rgba(218,165,32,.3);
      border-radius: 12px;
      backdrop-filter: blur(8px);
      transition: all 0.3s ease;
    }
    
    .sidebar-weather-widget:hover {
      background: rgba(14,20,37,.9);
      border-color: rgba(218,165,32,.5);
      box-shadow: 0 4px 12px rgba(218,165,32,.2);
    }
    
    .weather-main-info {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 12px;
    }
    
    .weather-temp-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .sidebar-weather-widget .weather-location {
      font-size: 10px;
      color: var(--muted);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      text-align: center;
    }
    
    .sidebar-weather-widget .weather-icon {
      font-size: 20px;
      line-height: 1;
    }
    
    .sidebar-weather-widget .weather-temp {
      font-size: 18px;
      color: var(--gold);
      font-weight: 700;
    }
    
    .sidebar-weather-widget .weather-status {
      font-size: 10px;
      color: var(--muted);
      text-align: center;
      font-weight: 500;
      line-height: 1.2;
    }
    
    .sidebar-weather-widget .weather-time {
      font-size: 11px;
      color: var(--white);
      font-weight: 600;
      text-align: center;
    }
    
    .weather-details-sidebar {
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,.1);
    }
    
    .weather-detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .weather-detail-row .detail-label {
      font-size: 9px;
      color: var(--muted);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .weather-detail-row .detail-value {
      font-size: 10px;
      color: var(--white);
      font-weight: 600;
    }

    /* Adjust main layout for sidebar and fixed header */
    body {
      padding-left: 220px;
      padding-top: 76px; /* Account for fixed header height */
    }
    
    header {
      margin-left: -220px;
      padding-left: 220px;
      overflow: hidden; /* Prevent content from extending beyond boundaries */
    }

    /* Search Bar */
    .search-container {
      position: relative;
      margin-right: 16px;
    }

    .search-bar {
      background: rgba(15,23,42,.8);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 10px 16px 10px 40px;
      color: var(--white);
      font-family: inherit;
      font-size: 14px;
      width: 200px;
      outline: none;
      transition: all 0.3s ease;
      backdrop-filter: blur(8px);
    }

    .search-bar:focus {
      border-color: var(--border-accent);
      box-shadow: 0 0 0 2px rgba(218,165,32,.3);
      background: rgba(15,23,42,.9);
      width: 250px;
    }

    .search-bar::placeholder {
      color: var(--muted);
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-size: 16px;
      pointer-events: none;
    }

    .search-bar:focus + .search-icon {
      color: var(--gold);
    }

    @media (max-width: 768px) {
      .search-container {
        margin-right: 8px;
      }
      
      .search-bar {
        width: 150px;
        padding: 8px 12px 8px 32px;
        font-size: 13px;
      }
      
      .search-bar:focus {
        width: 180px;
      }
      
      .search-bar::placeholder {
        font-size: 12px;
      }
    }
    
    .field input:focus,.field textarea:focus,.field select:focus{
      border-color:var(--ring-focus); 
      box-shadow: 0 0 0 2px rgba(61,79,138,.6);
      background: rgba(15,23,42,.8);
      outline: none;
    }

    /* Enhanced Tabs */
    .tabs{display:flex; gap:12px; margin:16px 0; flex-wrap: wrap;}
    .tabs button{
      border:none; background:rgba(255,255,255,.08); 
      color:var(--white); padding:8px 16px; 
      border-radius:20px; cursor:pointer;
      font-weight: 500; transition: all 0.3s ease;
    }
    
    .tabs button[aria-selected="true"]{
      background:rgba(218,165,32,.3); 
      outline:1px solid rgba(218,165,32,.6);
      box-shadow: 0 0 16px rgba(218,165,32,.3);
    }
    
    .tabs button:hover:not([aria-selected="true"]) {
      background: rgba(255,255,255,.15);
    }

    /* Enhanced Profile Section */
    .profile{
      display:grid; grid-template-columns: 120px 1fr; 
      gap:20px; align-items:center;
    }
    
    .avatar{
      width:120px; height:120px; border-radius:50%; 
      background:#111827; border:3px solid rgba(218,165,32,.3); 
      object-fit:cover; transition: all 0.3s ease;
    }
    
    .avatar:hover {
      border-color: rgba(218,165,32,.6);
      box-shadow: 0 0 24px rgba(218,165,32,.4);
    }

    /* Enhanced Marketplace Booking */
    .booking-form {
      background: rgba(15,23,42,.6);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 12px;
      padding: 16px;
      margin: 12px 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .booking-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .booking-inputs .field {
      margin-bottom: 0;
    }

    .booking-btn {
      align-self: flex-start;
      min-width: 120px;
    }
    
    .booking-list {
      background: rgba(15,23,42,.4);
      border-radius: 8px;
      padding: 12px;
      margin: 8px 0;
    }
    
    .booking-list ul {
      margin: 0;
      padding-left: 16px;
    }
    
    .booking-list li {
      color: rgba(255,255,255,.8);
      margin: 4px 0;
    }

    /* Enhanced Diagnostics */
    pre.diag{
      background:#0b1220; color:#cbd5e1; 
      border:1px dashed #334155; padding:16px; 
      border-radius:12px; overflow:auto;
      font-size: 12px; line-height: 1.4;
      max-height: 200px;
    }

    /* Create Form Enhancement */
    .create-section {
      background:
        linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.9) 100%),
        linear-gradient(135deg, rgba(255,107,53,.12) 0%, rgba(139,92,246,.08) 50%, rgba(0,212,170,.10) 100%);
      border: 1px solid var(--border-subtle);
      border-radius: 20px; 
      padding: 24px;
      box-shadow:
        0 20px 40px rgba(0,0,0,.3),
        0 8px 16px rgba(0,0,0,.2),
        inset 0 1px 0 rgba(241,245,249,.08);
      backdrop-filter: blur(16px) saturate(180%);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      transform: translateZ(0); /* Force hardware acceleration */
      will-change: transform, box-shadow;
    }

    .create-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #b8860b, #daa520, #ffd700, transparent);
      opacity: 0.9;
      pointer-events: none;
      box-shadow: 0 0 12px rgba(218, 165, 32, 0.25);
    }

    .create-section::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(circle at 20% 30%, rgba(255,107,53,0.15) 0%, transparent 40%),
        radial-gradient(circle at 80% 70%, rgba(139,92,246,0.12) 0%, transparent 40%),
        radial-gradient(circle at 50% 90%, rgba(0,212,170,0.18) 0%, transparent 35%);
      animation: cosmic-drift 20s ease-in-out infinite;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      transform: translateZ(0);
    }

    .create-section:hover {
      transform: translateY(-8px) scale(1.02) translateZ(0);
      box-shadow:
        0 32px 64px rgba(0,0,0,.4),
        0 16px 32px rgba(0,0,0,.3),
        0 0 0 1px #daa520,
        0 0 25px rgba(218,165,32,0.35),
        0 0 50px rgba(255,215,0,0.2),
        0 8px 40px rgba(184,134,11,0.2),
        inset 0 1px 0 rgba(255,255,255,0.12);
      border-color: #daa520;
    }

    .create-section:hover::after {
      opacity: 1;
    }

    @keyframes cosmic-drift {
      0%, 100% { 
        transform: translateX(0) translateY(0) rotate(0deg) translateZ(0);
      }
      25% { 
        transform: translateX(-10px) translateY(-15px) rotate(1deg) translateZ(0);
      }
      50% { 
        transform: translateX(5px) translateY(-10px) rotate(-0.5deg) translateZ(0);
      }
      75% { 
        transform: translateX(-5px) translateY(5px) rotate(0.8deg) translateZ(0);
      }
    }

    /* Tag styling */
    .tag {
      display: inline-block; 
      background: rgba(218,165,32,.2); 
      color: #ffd700; 
      padding: 2px 8px; 
      border-radius: 12px; 
      font-size: 11px; 
      margin: 2px 4px 2px 0; 
      border: 1px solid rgba(218,165,32,.3);
    }

    /* Empty State Styling */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
      font-style: italic;
      grid-column: 1 / -1;
    }

    /* Pagination Styling */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 40px 0;
      padding: 20px;
    }

    .pagination-current {
      color: var(--white);
      font-weight: 600;
      font-size: 16px;
      padding: 8px 16px;
      background: rgba(218,165,32,0.1);
      border: 1px solid rgba(218,165,32,0.3);
      border-radius: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .pagination .btn {
      min-width: 120px;
    }

    .pagination .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .pagination-info {
      font-size: 14px;
      background: rgba(255,255,255,0.05);
      padding: 12px 20px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    .pagination-info p {
      margin: 0;
      font-weight: 500;
    }

    /* Loading States */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .spinner {
      display: inline-block;
      width: 12px;
      height: 12px;
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: var(--gold);
      animation: spin 0.8s ease-in-out infinite;
    }

    /* Search Page Styles */
    .search-filter {
      padding: 8px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--muted);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      font-weight: 500;
    }

    .search-filter:hover {
      background: rgba(255,255,255,.1);
      border-color: var(--border-accent);
      color: var(--white);
    }

    .search-filter.active {
      background: var(--gradient-primary);
      border-color: var(--gold);
      color: var(--ink);
      font-weight: 600;
    }

    #search-page-input:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(218,165,32,.2);
    }

    .search-result-item {
      background: var(--card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 16px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .search-result-item:hover {
      border-color: var(--border-accent);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,.3);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      /* Tablet view - 2 columns for home grids */
      #home-projects-grid,
      #home-equipment-grid,
      #home-groups-grid,
      #home-blog-grid {
        grid-template-columns: repeat(2, 1fr) !important;
      }
    }

    @media (max-width: 768px) {
      .bar {
        flex-direction: row;
        flex-wrap: wrap;
        text-align: center;
        gap: 8px;
        padding: 12px;
      }
      
      .bar > div:first-child {
        width: 100%;
        margin-bottom: 8px;
      }
      
      .search-container {
        width: 100%;
        order: 3;
        margin-top: 8px;
      }
      
      .search-bar {
        width: 100%;
        font-size: 14px;
      }
      
      #auth-buttons, #user-menu {
        order: 2;
        margin-left: auto;
      }
      
      .grid {
        grid-template-columns: 1fr;
        gap: 16px;
        padding: 12px;
      }
      
      /* Override home page grids for mobile */
      #home-projects-grid,
      #home-equipment-grid,
      #home-groups-grid,
      #home-blog-grid {
        grid-template-columns: 1fr !important;
      }
      
      .card {
        padding: 16px;
      }
      
      .profile {
        grid-template-columns: 1fr;
        text-align: center;
        padding: 16px;
      }
      
      .profile-avatar {
        margin: 0 auto 16px;
      }
      
      .booking-inputs {
        grid-template-columns: 1fr !important;
      }
      
      .booking-btn {
        align-self: stretch;
        width: 100%;
      }
      
      /* Fix modals on mobile */
      .auth-modal-content,
      .create-modal-content {
        width: 90%;
        max-width: 400px;
        margin: 20px;
        max-height: 90vh;
        overflow-y: auto;
      }
      
      /* Mobile Navigation */
      .nav-sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 1001;
      }
      
      .nav-sidebar.mobile-open {
        transform: translateX(0);
      }
      
      .nav-sidebar::after {
        content: '';
        position: fixed;
        top: 0;
        left: 100%;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.5);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      
      .nav-sidebar.mobile-open::after {
        pointer-events: all;
        opacity: 1;
      }
      
      .mobile-nav-toggle {
        display: flex !important;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: none;
        border: none;
        color: var(--white);
        cursor: pointer;
        margin-right: 12px;
      }
      
      .mobile-nav-toggle span {
        display: block;
        width: 20px;
        height: 2px;
        background: var(--white);
        position: relative;
        transition: all 0.3s ease;
      }
      
      .mobile-nav-toggle span::before,
      .mobile-nav-toggle span::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 2px;
        background: var(--white);
        transition: all 0.3s ease;
      }
      
      .mobile-nav-toggle span::before {
        top: -6px;
      }
      
      .mobile-nav-toggle span::after {
        top: 6px;
      }
      
      .mobile-nav-toggle.active span {
        background: transparent;
      }
      
      .mobile-nav-toggle.active span::before {
        transform: rotate(45deg);
        top: 0;
      }
      
      .mobile-nav-toggle.active span::after {
        transform: rotate(-45deg);
        top: 0;
      }

      /* Improved focus indicators for accessibility */
      .mobile-nav-toggle:focus,
      .nav-item:focus,
      .btn:focus,
      .search-bar:focus {
        outline: 2px solid var(--gold);
        outline-offset: 2px;
      }

      .nav-item:focus {
        background: rgba(218,165,32,0.2);
      }

      /* Fix navigation */
      .tabs {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .tab {
        padding: 8px 12px;
        font-size: 14px;
        white-space: nowrap;
      }
      
      /* Fix buttons */
      .btn {
        padding: 10px 16px;
        font-size: 14px;
      }
      
      .btn-full {
        width: 100%;
      }
      
      /* Fix page sections */
      .section {
        padding: 16px;
      }
      
      .page-title {
        font-size: 24px;
        margin-bottom: 12px;
      }
      
      /* Fix toast on mobile */
      .toast-container {
        top: 60px;
        right: 10px;
        left: 10px;
      }
      
      .toast {
        min-width: auto;
        width: 100%;
      }
      
      /* Hide overflow on body to prevent horizontal scroll */
      body {
        overflow-x: hidden;
      }
      
      /* Fix header spacing */
      header {
        padding: 0;
      }
      
      /* Adjust font sizes for better readability */
      h1 { font-size: 24px; }
      h2 { font-size: 20px; }
      h3 { font-size: 18px; }
      
      /* Fix create button position */
      .create-section {
        padding: 12px;
      }
    }

    /* Loading States */
    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.2);
      border-top-color: var(--gold);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 8px;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(4px);
    }
    
    .loading-content {
      text-align: center;
      color: var(--white);
    }
    
    .loading-content .loading-spinner {
      width: 40px;
      height: 40px;
      margin: 0 auto 16px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Error/Success Toasts */
    .toast-container {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      pointer-events: none;
    }
    
    .toast {
      background: var(--card);
      border: 1px solid;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 300px;
      animation: slideIn 0.3s ease-out;
      pointer-events: auto;
    }
    
    .toast.success {
      border-color: #10b981;
      background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(5,150,105,0.05));
    }
    
    .toast.error {
      border-color: #ef4444;
      background: linear-gradient(135deg, rgba(239,68,68,0.1), rgba(220,38,38,0.05));
    }
    
    .toast.warning {
      border-color: #f59e0b;
      background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(217,119,6,0.05));
    }
    
    .toast.info {
      border-color: #3b82f6;
      background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(37,99,235,0.05));
    }
    
    .toast-icon {
      font-size: 20px;
    }
    
    .toast-message {
      flex: 1;
      color: var(--white);
    }
    
    .toast-close {
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
    }
    
    .toast-close:hover {
      opacity: 1;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    
    /* Skeleton Loading */
    .skeleton {
      background: linear-gradient(90deg, var(--card) 25%, rgba(255,255,255,0.05) 50%, var(--card) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 8px;
    }
    
    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    .skeleton-text {
      height: 16px;
      margin: 8px 0;
    }
    
    .skeleton-title {
      height: 24px;
      width: 60%;
      margin: 12px 0;
    }
    
    .skeleton-image {
      height: 200px;
      width: 100%;
      margin: 12px 0;
    }
    
    /* Button Loading State */
    .btn.loading {
      pointer-events: none;
      opacity: 0.7;
    }
    
    .btn.loading::after {
      content: '';
      display: inline-block;
      width: 14px;
      height: 14px;
      margin-left: 8px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: currentColor;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }
  </style>

  <!-- Favicon -->
  <link id="ico" rel="icon" type="image/png" href="/assets/logo.png">
</head>
<body>
  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>
  
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay" style="display: none;">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <div>Loading...</div>
    </div>
  </div>
  <div id="app">
    <!-- Fixed Left Navigation Sidebar -->
    <nav class="nav-sidebar" aria-label="Main navigation" role="navigation">
      <div class="nav-menu">
        <button id="nav-home" class="nav-item" onclick="setRoute('home')">
          <img src="/assets/tyton_home.png" alt="Home" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxwYXRoIGQ9Ik0zIDEyTDEyIDNMMjEgMTIiIHN0cm9rZT0iI0RBQTUyMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPHBhdGggZD0iTTUgMTJWMTlBMSAxIDAgMCAwIDYgMjBIMTBWMTZBMSAxIDAgMCAxIDExIDE1SDEzQTEgMSAwIDAgMSAxNCAxNlYyMEgxOEExIDEgMCAwIDAgMTkgMTlWMTIiIHN0cm9rZT0iI0RBQTUyMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+Cjwvc3ZnPg=='"> Home
        </button>
        <button id="nav-search" class="nav-item" onclick="setRoute('search')">
          <img src="/assets/tyton_search.png" alt="Search" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxjaXJjbGUgY3g9IjExIiBjeT0iMTEiIHI9IjYiIHN0cm9rZT0iI0RBQTUyMCIgc3Ryb2tlLXdpZHRoPSIyIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0xNiAxNkwyMCAyMCIgc3Ryb2tlPSIjREFBNTIwIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4KPC9zdmc+'"> Search
        </button>
        <button id="nav-projects" class="nav-item" onclick="setRoute('projects')">
          <img src="/assets/tyton_projects.png" alt="Projects" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxwYXRoIGQ9Ik04IDNINkM1IDMgNCA0IDQgNVYxOUM0IDIwIDUgMjEgNiAyMUgxOEMxOSAyMSAyMCAyMCAyMCAxOVY5SDE4VjE4SDZWNUg4VjNaIiBmaWxsPSIjREFBNTIwIi8+CjxjaXJjbGUgY3g9IjEyIiBjeT0iNiIgcj0iMyIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjREFBNTIwIiBzdHJva2Utd2lkdGg9IjEuNSIvPgo8cGF0aCBkPSJNMTIgOUwxNSAxMkwxMiAxNUw5IDEyWiIgZmlsbD0iI0RBQTUyMCIvPgo8cGF0aCBkPSJNOCAxMEgxNk04IDEzSDE2TTggMTZIMTYiIHN0cm9rZT0iIzA1MDgxNCIgc3Ryb2tlLXdpZHRoPSIxIi8+Cjwvc3ZnPgo8L3N2Zz4='"> Projects
        </button>
        <button id="nav-project-manager" class="nav-item" onclick="setRoute('project-manager')">
          <img src="/assets/tyton_project_manager.png" alt="Project Manager" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxwYXRoIGQ9Ik04IDRINkM1LjQ0NzcyIDQgNSA0LjQ0NzcyIDUgNVYxOUM1IDE5LjU1MjMgNS40NDc3MiAyMCA2IDIwSDhWNFoiIGZpbGw9IiNEQUE1MjAiLz4KPHBhdGggZD0iTTE4IDRIOFYyMEgxOEMxOC41NTIzIDIwIDE5IDE5LjU1MjMgMTkgMTlWNUMxOSA0LjQ0NzcyIDE4LjU1MjMgNCAxOCA0WiIgZmlsbD0iI0RBQTUyMCIvPgo8cGF0aCBkPSJNMTAgN0gxNiIgc3Ryb2tlPSIjMDUwODE0IiBzdHJva2Utd2lkdGg9IjEiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8cGF0aCBkPSJNMTAgMTBIMTYiIHN0cm9rZT0iIzA1MDgxNCIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPHBhdGggZD0iTTEwIDEzSDE0IiBzdHJva2U9IiMwNTA4MTQiIHN0cm9rZS13aWR0aD0iMSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjIiIGZpbGw9IiNEQUE1MjAiIHN0cm9rZT0iIzA1MDgxNCIgc3Ryb2tlLXdpZHRoPSIwLjUiLz4KPC9zdmc+Cjwvc3ZnPg=='"> Project Manager
        </button>
        <button id="nav-equipment" class="nav-item" onclick="setRoute('equipment')">
          <img src="/assets/tyton_equipment.png" alt="Marketplace" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxwYXRoIGQ9Ik01IDhMMy41IDEwVjIwSDIwLjVWMTBMMTkgOEg1WiIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjREFBNTIwIiBzdHJva2Utd2lkdGg9IjEuNSIvPgo8Y2lyY2xlIGN4PSIxMCIgY3k9IjEzIiByPSIyIiBmaWxsPSIjREFBNTIwIi8+CjxjaXJjbGUgY3g9IjE0IiBjeT0iMTMiIHI9IjIiIGZpbGw9IiNEQUE1MjAiLz4KPHBhdGggZD0iTTggOFY1QzggNCA5IDMgMTAgM0gxNEMxNSAzIDE2IDQgMTYgNVY4IiBzdHJva2U9IiNEQUE1MjAiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPHBhdGggZD0iTTYgMTdIMTgiIHN0cm9rZT0iI0RBQTUyMCIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4KPC9zdmc+'"> Tyton Marketplace
        </button>
        <button id="nav-groups" class="nav-item" onclick="setRoute('groups')">
          <img src="/assets/tyton_groups.png" alt="Groups" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxyZWN0IHg9IjQiIHk9IjQiIHdpZHRoPSIxNiIgaGVpZ2h0PSIxMiIgcng9IjMiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0RBQTUyMCIgc3Ryb2tlLXdpZHRoPSIxLjUiLz4KPGNpcmNsZSBjeD0iOSIgY3k9IjgiIHI9IjEuNSIgZmlsbD0iI0RBQTUyMCIvPgo8Y2lyY2xlIGN4PSIxNSIgY3k9IjgiIHI9IjEuNSIgZmlsbD0iI0RBQTUyMCIvPgo8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxLjUiIGZpbGw9IiNEQUE1MjAiLz4KPHBhdGggZD0iTTEyIDEwVjE0TTEwIDEySDlNMTAgMTJWMTBNMTAgMTJIMTJNMTQgMTJIMTVNMTQgMTJWMTBNMTQgMTJIMTIiIHN0cm9rZT0iI0RBQTUyMCIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPHJlY3QgeD0iNCIgeT0iMTgiIHdpZHRoPSIxNiIgaGVpZ2h0PSIyIiBmaWxsPSIjREFBNTIwIi8+Cjwvc3ZnPgo8L3N2Zz4='"> Groups
        </button>
        <button id="nav-discussions" class="nav-item" onclick="setRoute('discussions')">
          <img src="/assets/tyton_discussions.png" alt="Discussions" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxwYXRoIGQ9Ik04IDZDOCA1LjQ0NzcyIDguNDQ3NzIgNSA5IDVIMTdDMTcuNTUyMyA1IDE4IDUuNDQ3NzIgMTggNlYxNEMxOCAxNC41NTIzIDE3LjU1MjMgMTUgMTcgMTVIMTNMMTAgMThWMTVIOUM4LjQ0NzcyIDE1IDggMTQuNTUyMyA4IDE0VjZaIiBmaWxsPSIjREFBNTIwIi8+CjxwYXRoIGQ9Ik0xMSA5SDE1IiBzdHJva2U9IiMwNTA4MTQiIHN0cm9rZS13aWR0aD0iMSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxwYXRoIGQ9Ik0xMSAxMkgxNSIgc3Ryb2tlPSIjMDUwODE0IiBzdHJva2Utd2lkdGg9IjEiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4KPC9zdmc+'"> Discussions
        </button>
        <button id="nav-journal" class="nav-item" onclick="setRoute('journal')">
          <img src="/assets/tyton_journal.png" alt="Journal" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxwYXRoIGQ9Ik02IDJINEMyLjg5IDIgMiAyLjg5IDIgNFYyMEMyIDIxLjExIDIuODkgMjIgNCAyMkg2VjJaIiBmaWxsPSIjREFBNTIwIi8+CjxwYXRoIGQ9Ik0yMCAySDZWMjJIMjBDMjEuMTEgMjIgMjIgMjEuMTEgMjIgMjBWNEMyMiAyLjg5IDIxLjExIDIgMjAgMloiIGZpbGw9IiNEQUE1MjAiLz4KPHBhdGggZD0iTTkgN0gxOSIgc3Ryb2tlPSIjMDUwODE0IiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxwYXRoIGQ9Ik05IDEwSDE5IiBzdHJva2U9IiMwNTA4MTQiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPHBhdGggZD0iTTkgMTNIMTYiIHN0cm9rZT0iIzA1MDgxNCIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4KPC9zdmc+'"> Tyton Journal
        </button>
        <button id="nav-blog" class="nav-item" onclick="setRoute('blog')">
          <img src="/assets/tyton_blog.png" alt="News" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxwYXRoIGQ9Ik02IDNINEMzLjQ0IDMgMyAzLjQ0IDMgNFYyMEMzIDIwLjU2IDMuNDQgMjEgNCAyMUg2VjNaIiBmaWxsPSIjREFBNTIwIi8+CjxwYXRoIGQ9Ik0yMCAzSDZWMjFIMjBDMjAuNTYgMjEgMjEgMjAuNTYgMjEgMjBWNEMyMSAzLjQ0IDIwLjU2IDMgMjAgM1oiIGZpbGw9IiNEQUE1MjAiLz4KPHBhdGggZD0iTTkgNkgxOSIgc3Ryb2tlPSIjMDUwODE0IiBzdHJva2Utd2lkdGg9IjEuNSIvPgo8cGF0aCBkPSJNOSA5SDE3IiBzdHJva2U9IiMwNTA4MTQiIHN0cm9rZS13aWR0aD0iMS41Ii8+CjxwYXRoIGQ9Ik05IDEySDEzIiBzdHJva2U9IiMwNTA4MTQiIHN0cm9rZS13aWR0aD0iMS41Ii8+CjxjaXJjbGUgY3g9IjE3IiBjeT0iMTIiIHI9IjEuNSIgZmlsbD0iIzA1MDgxNCIvPgo8cGF0aCBkPSJNOSAxNUgxNiIgc3Ryb2tlPSIjMDUwODE0IiBzdHJva2Utd2lkdGg9IjEuNSIvPgo8cGF0aCBkPSJNOSAxOEgxNCIgc3Ryb2tlPSIjMDUwODE0IiBzdHJva2Utd2lkdGg9IjEuNSIvPgo8L3N2Zz4KPC9zdmc+'"> News
        </button>
        <button id="nav-profile" class="nav-item" onclick="setRoute('profile')">
          <img src="/assets/tyton_profile.png" alt="Profile" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxjaXJjbGUgY3g9IjEyIiBjeT0iOCIgcj0iMy41IiBmaWxsPSJub25lIiBzdHJva2U9IiNEQUE1MjAiIHN0cm9rZS13aWR0aD0iMS41Ii8+CjxjaXJjbGUgY3g9IjEyIiBjeT0iOCIgcj0iMS41IiBmaWxsPSIjREFBNTIwIi8+CjxwYXRoIGQ9Ik01IDE4QzUgMTQuNjg2MyA4LjEzNDAxIDEyIDEyIDEyUzE5IDE0LjY4NjMgMTkgMTgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI0RBQTUyMCIgc3Ryb2tlLXdpZHRoPSIxLjUiLz4KPHBhdGggZD0iTTggMTdIMTZNNyAxOUgxNyIgc3Ryb2tlPSIjREFBNTIwIiBzdHJva2Utd2lkdGg9IjEiLz4KPC9zdmc+Cjwvc3ZnPg=='"> Profile
        </button>
        <button id="nav-preferences" class="nav-item" onclick="setRoute('preferences')">
          <img src="/assets/tyton_preferences.png" alt="Preferences" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiIHN0cm9rZT0iI0RBQTUyMCIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIi8+CjxwYXRoIGQ9Ik0xMiAxVjNNMTIgMjFWMjNNNC4yMiA0LjIyTDUuNjQgNS42NU0xOC4zNiAxOC4zNUwxOS43OCAxOS43N000LjIyIDE5Ljc4TDUuNjQgMTguMzZNMTguMzYgNS42NUwxOS43OCA0LjIzTTEgMTJIM000MiAxMkgyM00xMiAxVjNNMTIgMjFWMjMiIHN0cm9rZT0iI0RBQTUyMCIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cjwvc3ZnPg=='"> Preferences
        </button>
        <button id="nav-theme" class="nav-item" onclick="setRoute('theme')">
          <img src="/assets/tyton_theme.png" alt="Theme" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxwYXRoIGQ9Ik0xMiA2VjJIMTNWNkgxMlpNNC45MyA1Ljc1TDQuMjIgNy4wNkw3LjQgOC45MUw4LjExIDcuNkw0LjkzIDUuNzVaTTQgMThIMlYxOUg0VjE4Wk02LjMgMTcuN0w1IDE4LjNMNy4xIDIwLjNMOC40IDE5LjdMNi4zIDE3LjdaTTEyIDIyVjE4SDEzVjIySDEyWk0xNy42IDE5LjdMMTguOSAyMC4zTDIxIDIwLjNMMTkuNyAxOC4zTDE3LjYgMTkuN1pNMjAgMThWMTlIMjJWMThIMjBaTTE5IDE2LjlMMjAuMjUgMTcuMTVMMjIuMjUgMTVMMjEgMTQuNjVMMTkgMTYuOVpNNyAxNi45TDUgMTQuNjVMMy43NSAxNUw1Ljc1IDE3LjE1TDcgMTYuOVpNMTYgMTNIMTNWMTZIMTZWMTNaTTEyIDEyQzEzLjEgMTIgMTQgMTEuMSAxNCAxMFYzQzE0IDIuNDUgMTMuNTUgMiAxMyAySEEwQzEyLjQ1IDIgMTIgMi40NSAxMiAzVjEwQzEyIDExLjEgMTIuOSAxMiAxMiAxMloiIGZpbGw9IiNEQUE1MjAiLz4KPC9zdmc+Cjwvc3ZnPg=='"> Theme
        </button>
        <button id="nav-help" class="nav-item" onclick="setRoute('help')">
          <img src="/assets/tyton_help.png" alt="Help" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIiBzdHJva2U9IiNEQUE1MjAiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIvPgo8cGF0aCBkPSJNMTIgMTZWMTJNMTIgOEgxMi4wMSIgc3Ryb2tlPSIjREFBNTIwIiBzdHJva2Utd2lkdGg9IjEiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4KPC9zdmc+'"> Help & Support
        </button>
        <button id="nav-about" class="nav-item" onclick="setRoute('about')">
          <img src="/assets/tyton_about.png" alt="About" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEwIiBzdHJva2U9IiNEQUE1MjAiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIvPgo8cGF0aCBkPSJNMTIgMTZWMTJNMTIgOEgxMi4wMSIgc3Ryb2tlPSIjREFBNTIwIiBzdHJva2Utd2lkdGg9IjEiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8L3N2Zz4KPC9zdmc+'"> About
        </button>
        <button id="nav-tyton-plus" class="nav-item" onclick="setRoute('tyton-plus')">
          <img src="/assets/tyton_plus.png" alt="Tyton+" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iMTAiIGZpbGw9IiMwNTA4MTQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeD0iOCIgeT0iOCI+CjxwYXRoIGQ9Ik0xMiAyTDE1LjA5IDguMjZMMjIgOUwxNyAxNEwxOC4xOCAyMUwxMiAxNy43N0w1LjgyIDIxTDcgMTRMMiA5TDguOTEgOC4yNkwxMiAyWiIgZmlsbD0iI0RBQTUyMCIgc3Ryb2tlPSIjMDUwODE0IiBzdHJva2Utd2lkdGg9IjAuNSIvPgo8dGV4dCB4PSIxMiIgeT0iMTQiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiMwNTA4MTQiIGZvbnQtc2l6ZT0iMTAiIGZvbnQtd2VpZ2h0PSJib2xkIj4rPC90ZXh0Pgo8L3N2Zz4KPC9zdmc+'"> Tyton+
        </button>
        
        <!-- Weather Widget in Sidebar -->
        <div class="sidebar-weather-widget" id="weather-widget">
          <div class="weather-location" id="weather-location">Loading...</div>
          <div class="weather-main-info">
            <div class="weather-temp-row">
              <div class="weather-icon" id="weather-icon">☀️</div>
              <div class="weather-temp" id="weather-temp">--°F</div>
            </div>
            <div class="weather-status" id="weather-status">--</div>
            <div class="weather-time" id="weather-time">--:--</div>
          </div>
          <div class="weather-details-sidebar">
            <div class="weather-detail-row">
              <span class="detail-label">UV</span>
              <span class="detail-value" id="uv-index">--</span>
            </div>
            <div class="weather-detail-row">
              <span class="detail-label">AQI</span>
              <span class="detail-value" id="air-quality">--</span>
            </div>
            <div class="weather-detail-row">
              <span class="detail-label">Humidity</span>
              <span class="detail-value" id="humidity">--%</span>
            </div>
            <div class="weather-detail-row">
              <span class="detail-label">Rain</span>
              <span class="detail-value" id="precip-chance">--%</span>
            </div>
          </div>
        </div>
        
        <!-- Copyright Notice -->
        <div class="sidebar-copyright" style="margin-top: 32px; padding: 16px; text-align: center; font-size: 11px; color: var(--muted); line-height: 1.4; opacity: 0.7;">
          © 2025 Tyton Systems<br>
          <span style="font-size: 10px; opacity: 0.8;">All rights reserved</span>
        </div>
      </div>
    </nav>
    
    <header>
      <div class="bar">
        <div class="header-left">
          <button class="mobile-nav-toggle" onclick="toggleMobileNav()" style="display: none;" 
                  aria-label="Toggle navigation menu" aria-expanded="false">
            <span></span>
          </button>
          <div class="logo-container">
            <div class="brand">
              <img id="header-logo" src="/assets/logo.png" alt="Tyton" onerror="this.src=generateFallbackLogo()" />
              <span style="font-family: 'Bebas Neue', 'Orbitron', cursive; font-size: 24px; font-weight: 400; letter-spacing: 2px; background: linear-gradient(135deg, var(--gold) 0%, #ffd700 50%, #fff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 0 10px rgba(218,165,32,0.3);">TYTON</span><span class="beta-text" style="font-family: 'Space Grotesk', 'Inter', italic; font-size: 16px; font-weight: 500; font-style: italic; margin-left: 8px; background: linear-gradient(90deg, #8b5cf6, #a855f7, #c084fc, #e879f9, #fbbf24, #f59e0b, #ef4444, #ec4899, #8b5cf6); background-size: 300% 100%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 0 15px rgba(139,92,246,0.6), 0 0 25px rgba(139,92,246,0.3); animation: betaGlow 4s ease-in-out infinite;">Beta</span>
            </div>
          </div>

        </div>

        <div class="right">
          <span class="badge" id="status-badge">📡 Checking connection...</span>
          <div id="auth-buttons" style="display: flex; gap: 8px;">
            <!-- TODO: Replace 🔑 emoji with proper icon -->
            <button class="btn" onclick="showAuthModal('login')">🔑 Login</button>
            <button class="btn gold" onclick="showAuthModal('register')">
              Sign Up
            </button>
          </div>
          <div id="user-menu" style="display: block; position: relative;">
            <button class="btn" id="user-menu-btn" onclick="toggleUserMenu()">
              <img id="user-avatar" src="" style="width: 20px; height: 20px; border-radius: 50%; margin-right: 6px;">
              <span id="user-name">User</span>
            </button>
            <div id="user-dropdown" style="display: none; position: fixed; top: 60px; right: 10px; background: #1e293b; border: 2px solid #daa520; border-radius: 8px; padding: 12px; min-width: 160px; z-index: 999999; box-shadow: 0 4px 20px rgba(0,0,0,.8);">
              <button class="btn" style="width: 100%; justify-content: flex-start; margin-bottom: 4px;" onclick="setRoute('profile'); toggleUserMenu();">👤 Profile</button>
              <button class="btn" style="width: 100%; justify-content: flex-start;" onclick="logout()">🚪 Logout</button>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="auth-modal">
      <div class="auth-modal-content">
        <div class="card auth-card">
          <button onclick="hideAuthModal()" class="auth-close">×</button>
          
          <div id="login-form" class="auth-form">
            <!-- TODO: Replace 🔑 emoji with proper icon -->
            <h2 class="auth-title">🔑 Login to Tyton</h2>
            <form onsubmit="handleLogin(event)">
              <div class="field">
                <label>Email</label>
                <input name="email" type="email" required placeholder="your@email.com" 
                       pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                       title="Please enter a valid email address">
              </div>
              <div class="field">
                <label>Password</label>
                <input name="password" type="password" required placeholder="••••••••"
                       minlength="6" title="Password must be at least 6 characters">
              </div>
              <!-- TODO: Replace 🔑 emoji with proper icon -->
              <button class="btn gold btn-full" type="submit">🔑 Login</button>
            </form>
            
            <div class="auth-divider">
              <span>or</span>
            </div>
            
            <!-- TODO: Replace 🔍 emoji with Google logo icon -->
            <a href="/auth/google" class="btn btn-full btn-google">
              🔍 Continue with Google
            </a>
            
            <p class="auth-link-text">
              Don't have an account? 
              <button onclick="showAuthModal('register')" class="auth-link-btn">Sign up</button>
            </p>
          </div>

          <div id="register-form" class="auth-form">
            <h2 class="auth-title">
              Join Tyton
            </h2>
            <form onsubmit="handleRegister(event)">
              <div class="field">
                <label>Full Name</label>
                <input name="name" required placeholder="Your full name" 
                       minlength="2" maxlength="100"
                       pattern="[a-zA-Z\s]+" title="Name should only contain letters and spaces">
              </div>
              <div class="field">
                <label>Email</label>
                <input name="email" type="email" required placeholder="your@email.com"
                       pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                       title="Please enter a valid email address">
              </div>
              <div class="field">
                <label>Handle (optional)</label>
                <input name="handle" placeholder="@username"
                       pattern="@?[a-zA-Z0-9_]+" maxlength="30"
                       title="Handle can contain letters, numbers, and underscores">
              </div>
              <div class="field">
                <label>Password</label>
                <input name="password" type="password" required placeholder="••••••••" 
                       minlength="6" maxlength="100"
                       title="Password must be at least 6 characters">
              </div>
              <button class="btn gold btn-full" type="submit">
                <img src="/assets/logo.png" alt="Tyton" style="width: 16px; height: 16px; margin-right: 6px;" onerror="this.style.display='none'">
                Create Account
              </button>
            </form>
            
            <div class="auth-divider">
              <span>or</span>
            </div>
            
            <!-- TODO: Replace 🔍 emoji with Google logo icon -->
            <a href="/auth/google" class="btn btn-full btn-google">
              🔍 Continue with Google
            </a>
            
            <p class="auth-link-text">
              Already have an account? 
              <button onclick="showAuthModal('login')" class="auth-link-btn">Login</button>
            </p>
          </div>
        </div>
      </div>
    </div>

    <main>


      <!-- HOME PAGE -->
      <section id="home-page">
        <div style="text-align: center; margin-bottom: 40px;">
          <img src="/assets/logo.png" 
               alt="Tyton Logo" 
               style="width: 80px; height: 80px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 8px 24px rgba(218,165,32,.3);"
               onerror="this.style.display='none'">
          <h1 class="page-title" style="font-size: 36px; font-weight: 700; margin: 0 0 16px 0;">
            Welcome to Tyton
          </h1>
          <p style="color: var(--muted); font-size: 18px; margin: 0;">
            Discover recommended projects, marketplace items, and research opportunities
          </p>
        </div>

        <!-- Recommended Projects Section -->
        <section class="card" style="margin-bottom: 32px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; font-size: 20px;">🔥 Trending Projects</h3>
            <button class="btn" onclick="setRoute('projects')" style="font-size: 14px;">View All</button>
          </div>
          <div class="grid" id="home-projects-grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px;">
            <div class="empty-state">
              <div class="spinner"></div>
              <p>Loading recommended projects...</p>
            </div>
          </div>
        </section>

        <!-- Recommended Marketplace Section -->
        <section class="card" style="margin-bottom: 32px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; font-size: 20px;">⚡ Featured Marketplace</h3>
            <button class="btn" onclick="setRoute('equipment')" style="font-size: 14px;">View All</button>
          </div>
          <div class="grid" id="home-equipment-grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px;">
            <div class="empty-state">
              <div class="spinner"></div>
              <p>Loading featured marketplace items...</p>
            </div>
          </div>
        </section>

        <!-- Top Groups Section -->
        <section class="card" style="margin-bottom: 32px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; font-size: 20px;">👥 Top Groups</h3>
            <button class="btn" onclick="setRoute('groups')" style="font-size: 14px;">View All</button>
          </div>
          <div class="grid" id="home-groups-grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px;">
            <div class="empty-state">
              <div class="spinner"></div>
              <p>Loading top groups...</p>
            </div>
          </div>
        </section>

        <!-- Recent News Section -->
        <section class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; font-size: 20px;">📰 Latest News</h3>
            <button class="btn" onclick="setRoute('blog')" style="font-size: 14px;">Read More</button>
          </div>
          <div class="grid" id="home-blog-grid" style="grid-template-columns: repeat(3, 1fr); gap: 20px;">
            <div class="empty-state">
              <div class="spinner"></div>
              <p>Loading recent blog posts...</p>
            </div>
          </div>
        </section>
      </section>

      <!-- SEARCH PAGE -->
      <section id="search-page" style="display:none;">
        <div class="page-header" style="text-align: center; margin-bottom: 32px;">
          <h2 class="page-title" style="display: flex; align-items: center; justify-content: center; gap: 12px;">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
              <path d="M16 16L20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Search Tyton
          </h2>
          <p style="color: var(--muted); margin-top: 8px;">Search for projects, equipment, discussions, and more</p>
        </div>

        <!-- Search Bar -->
        <div class="search-container" style="max-width: 800px; margin: 0 auto 40px;">
          <div style="position: relative;">
            <input 
              type="text" 
              id="search-page-input" 
              placeholder="Search projects, equipment, discussions, papers..." 
              style="
                width: 100%;
                padding: 16px 20px 16px 50px;
                font-size: 16px;
                background: var(--card);
                border: 2px solid var(--border-accent);
                border-radius: 12px;
                color: var(--white);
                outline: none;
                transition: all 0.3s ease;
              "
              onkeyup="handleSearchInput(event)"
            >
            <svg 
              style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); width: 24px; height: 24px; color: var(--muted);"
              viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
              <path d="M16 16L20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          
          <!-- Search Filters -->
          <div style="display: flex; gap: 12px; margin-top: 16px; flex-wrap: wrap;">
            <button class="search-filter active" data-filter="all" onclick="setSearchFilter('all')">All</button>
            <button class="search-filter" data-filter="projects" onclick="setSearchFilter('projects')">Projects</button>
            <button class="search-filter" data-filter="equipment" onclick="setSearchFilter('equipment')">Equipment</button>
            <button class="search-filter" data-filter="discussions" onclick="setSearchFilter('discussions')">Discussions</button>
            <button class="search-filter" data-filter="papers" onclick="setSearchFilter('papers')">Papers</button>
            <button class="search-filter" data-filter="users" onclick="setSearchFilter('users')">Users</button>
          </div>
        </div>

        <!-- Search Results -->
        <div id="search-results-container">
          <div id="search-results-loading" style="display: none; text-align: center; padding: 40px;">
            <div class="spinner"></div>
            <p style="color: var(--muted); margin-top: 16px;">Searching...</p>
          </div>
          
          <div id="search-results-empty" style="text-align: center; padding: 60px 20px;">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.3; margin-bottom: 16px;">
              <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
              <path d="M16 16L20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <h3 style="color: var(--muted); font-weight: 500;">Start typing to search</h3>
            <p style="color: var(--muted); opacity: 0.7; margin-top: 8px;">Enter keywords to find projects, equipment, discussions, and more</p>
          </div>
          
          <div id="search-results-list" style="display: none;">
            <!-- Results will be populated here -->
          </div>
        </div>
      </section>

      <!-- PROJECTS PAGE -->
      <section id="projects-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_projects.png" alt="Projects" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.style.display='none'">
          Research Projects
        </h2>
        
        <!-- Projects Stats -->
        <div class="pagination-info" id="projects-info" style="text-align: center; margin-bottom: 20px; color: var(--muted);">
          <p>Loading projects...</p>
        </div>
        
        <div class="grid" id="projects-grid">
          <div class="empty-state">
            <div class="spinner"></div>
            <p>Loading projects...</p>
          </div>
        </div>
        
        <!-- Projects Pagination -->
        <div class="pagination" id="projects-pagination" style="display: none;">
          <button class="btn" onclick="changePage('projects', -1)">← Previous</button>
          <span class="pagination-current" id="projects-page-info">Page 1 of 1</span>
          <button class="btn" onclick="changePage('projects', 1)">Next →</button>
        </div>
      </section>

      <!-- EQUIPMENT PAGE -->
      <section id="equipment-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_equipment.png" alt="Marketplace" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.style.display='none'">
          Tyton Marketplace
        </h2>
        
        <!-- Marketplace Stats -->
        <div class="pagination-info" id="equipment-info" style="text-align: center; margin-bottom: 20px; color: var(--muted);">
          <p>Loading marketplace items...</p>
        </div>
        
        <div class="grid" id="equipment-grid">
          <div class="empty-state">
            <div class="spinner"></div>
            <p>Loading marketplace items...</p>
          </div>
        </div>
        
        <!-- Marketplace Pagination -->
        <div class="pagination" id="equipment-pagination" style="display: none;">
          <button class="btn" onclick="changePage('equipment', -1)">← Previous</button>
          <span class="pagination-current" id="equipment-page-info">Page 1 of 1</span>
          <button class="btn" onclick="changePage('equipment', 1)">Next →</button>
        </div>
      </section>

      <!-- GROUPS PAGE -->
      <section id="groups-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_groups.png" alt="Groups" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.style.display='none'">
          Groups
        </h2>
        
        <div class="controls" style="margin-bottom: 24px;">
          <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
            <input type="text" id="groups-search" placeholder="Search groups..." style="flex: 1; min-width: 200px; padding: 12px; border: 1px solid rgba(255,255,255,.2); border-radius: 8px; background: rgba(255,255,255,.05); color: var(--white);">
            <select id="groups-type-filter" style="padding: 12px; border: 1px solid rgba(255,255,255,.2); border-radius: 8px; background: var(--card); color: var(--white);">
              <option value="">All Types</option>
              <option value="university">University</option>
              <option value="professional">Professional</option>
              <option value="research">Research Group</option>
              <option value="hobby">Hobby</option>
              <option value="nonprofit">Non-Profit</option>
            </select>
            <select id="groups-location-filter" style="padding: 12px; border: 1px solid rgba(255,255,255,.2); border-radius: 8px; background: var(--card); color: var(--white);">
              <option value="">All Locations</option>
              <option value="global">Global</option>
              <option value="north-america">North America</option>
              <option value="europe">Europe</option>
              <option value="asia">Asia</option>
              <option value="local">Local</option>
            </select>
            <button class="btn" onclick="filterGroups()" style="background: var(--gradient-primary);">
              🔍 Filter
            </button>
          </div>
        </div>

        <div class="grid" id="groups-grid" style="grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;">
          <div class="empty-state">
            <div class="spinner"></div>
            <p>Loading groups...</p>
          </div>
        </div>

        <div class="pagination" id="groups-pagination" style="display: none;">
          <button class="btn" onclick="changePage('groups', -1)">← Previous</button>
          <span class="pagination-current" id="groups-page-info">Page 1 of 1</span>
          <button class="btn" onclick="changePage('groups', 1)">Next →</button>
        </div>
      </section>

      <!-- GROUP DETAIL PAGE -->
      <section id="group-detail-page" style="display:none;">
        <div id="group-detail-content">
          <!-- Content will be dynamically generated -->
        </div>
      </section>

      <!-- DISCUSSIONS PAGE -->
      <section id="discussions-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_discussions.png" alt="Discussions" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzA1MDgxNCIvPgo8cGF0aCBkPSJNOCA5QzggOC40NDc3MiA4LjQ0NzcyIDggOSA4SDE5QzE5LjU1MjMgOCAyMCA4LjQ0NzcyIDIwIDlWMTVDMjAgMTUuNTUyMyAxOS41NTIzIDE2IDE5IDE2SDE0LjVMMTEgMTkuNVYxNkg5QzguNDQ3NzIgMTYgOCAxNS41NTIzIDggMTVWOVoiIGZpbGw9IiNEQUE1MjAiLz4KPHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeD0iMTIiIHk9IjEyIj4KPHBhdGggZD0iTTIgM0MyIDIuNDQ3NzIgMi40NDc3MiAyIDMgMkg5QzkuNTUyMjggMiAxMCAyLjQ0NzcyIDEwIDNWN0MxMCA3LjU1MjI4IDkuNTUyMjggOCA5IDhINi41TDQgMTAuNVY4SDNDMi40NDc3MiA4IDIgNy41NTIyOCAyIDdWM1oiIGZpbGw9IiNEQUE1MjAiLz4KPC9zdmc+Cjwvc3ZnPgo='">
          Discussions
        </h2>
        
        <!-- Add Discussion Button -->
        <div style="text-align: center; margin-bottom: 32px;">
          <button class="btn" onclick="openCreateDiscussionModal()" style="background: var(--gradient-primary); color: var(--ink); border: none; padding: 16px 32px; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 8px 32px var(--glow-primary);">
            + Start New Discussion
          </button>
        </div>
        
        <!-- Discussions Stats -->
        <div class="pagination-info" id="discussions-info" style="text-align: center; margin-bottom: 20px; color: var(--muted);">
          <p>Loading discussions...</p>
        </div>
        
        <!-- Discussions Grid -->
        <div class="grid" id="discussions-grid" style="grid-template-columns: 1fr; gap: 20px;">
          <div class="empty-state">
            <div class="spinner"></div>
            <p>Loading discussions...</p>
          </div>
        </div>
        
        <!-- Pagination -->
        <div class="pagination" id="discussions-pagination" style="display: none;">
          <button class="btn" onclick="changePage('discussions', -1)">← Previous</button>
          <span id="discussions-page-info"></span>
          <button class="btn" onclick="changePage('discussions', 1)">Next →</button>
        </div>
      </section>
      
      <!-- TYTON JOURNAL PAGE -->
      <section id="journal-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_journal.png" alt="Journal" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzA1MDgxNCIvPgo8cGF0aCBkPSJNNiAySDRDMi44OSAyIDIgMi44OSAyIDRWMjBDMiAyMS4xMSAyLjg5IDIyIDQgMjJINlYyWiIgZmlsbD0iI0RBQTUyMCIvPgo8cGF0aCBkPSJNMjAgMkg2VjIySDIwQzIxLjExIDIyIDIyIDIxLjExIDIyIDIwVjRDMjIgMi44OSAyMS4xMSAyIDIwIDJaIiBmaWxsPSIjREFBNTIwIi8+CjxwYXRoIGQ9Ik05IDdIMTkiIHN0cm9rZT0iIzA1MDgxNCIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8cGF0aCBkPSJNOSAxMEgxOSIgc3Ryb2tlPSIjMDUwODE0IiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxwYXRoIGQ9Ik05IDEzSDE2IiBzdHJva2U9IiMwNTA4MTQiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPC9zdmc+Cjwvc3ZnPgo='">
          Tyton Journal
        </h2>
        <p style="text-align: center; color: var(--muted); margin-bottom: 32px; max-width: 600px; margin-left: auto; margin-right: auto;">
          Share your unpublished research papers, working drafts, and posters with the research community. Get feedback before submission.
        </p>
        
        <!-- Add Paper Button -->
        <div style="text-align: center; margin-bottom: 32px;">
          <button class="btn" onclick="openCreatePaperModal()" style="background: var(--gradient-primary); color: var(--ink); border: none; padding: 16px 32px; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 8px 32px var(--glow-primary);">
            + Submit Paper
          </button>
        </div>

        <!-- Filter/Search Controls -->
        <div style="display: flex; gap: 16px; margin-bottom: 24px; align-items: center; flex-wrap: wrap;">
          <input type="text" id="journal-search" placeholder="Search papers..." style="flex: 1; min-width: 200px; padding: 12px 16px; background: var(--ring); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--white);">
          <select id="journal-category-filter" style="padding: 12px 16px; background: var(--ring); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--white);">
            <option value="">All Categories</option>
            <option value="physics">Physics</option>
            <option value="chemistry">Chemistry</option>
            <option value="biology">Biology</option>
            <option value="computer-science">Computer Science</option>
            <option value="mathematics">Mathematics</option>
            <option value="engineering">Engineering</option>
            <option value="medicine">Medicine</option>
            <option value="other">Other</option>
          </select>
          <select id="journal-status-filter" style="padding: 12px 16px; background: var(--ring); border: 1px solid var(--border-subtle); border-radius: 8px; color: var(--white);">
            <option value="">All Status</option>
            <option value="draft">Draft</option>
            <option value="review">Under Review</option>
            <option value="revision">Revision</option>
            <option value="final">Final</option>
          </select>
        </div>
        
        <!-- Papers Stats -->
        <div class="pagination-info" id="journal-info" style="text-align: center; margin-bottom: 20px; color: var(--muted);">
          <p>Loading papers...</p>
        </div>
        
        <!-- Papers Grid -->
        <div class="grid" id="journal-grid" style="grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px;">
          <div class="empty-state">
            <div class="spinner"></div>
            <p>Loading papers...</p>
          </div>
        </div>
        
        <!-- Pagination -->
        <div class="pagination" id="journal-pagination" style="display: none;">
          <button class="btn" onclick="changePage('journal', -1)">← Previous</button>
          <span id="journal-page-info"></span>
          <button class="btn" onclick="changePage('journal', 1)">Next →</button>
        </div>
      </section>
      
      <!-- PROJECT MANAGER PAGE -->
      <section id="project-manager-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_project_manager.png" alt="Project Manager" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzA1MDgxNCIvPgo8cGF0aCBkPSJNOCA0SDZDNS40NDc3MiA0IDUgNC40NDc3MiA1IDVWMTlDNSAxOS41NTIzIDUuNDQ3NzIgMjAgNiAyMEg4VjRaIiBmaWxsPSIjREFBNTIwIi8+CjxwYXRoIGQ9Ik0xOCA0SDhWMjBIMThDMTguNTUyMyAyMCAxOSAxOS41NTIzIDE5IDE5VjVDMTkgNC40NDc3MiAxOC41NTIzIDQgMTggNFoiIGZpbGw9IiNEQUE1MjAiLz4KPHBhdGggZD0iTTEwIDdIMTYiIHN0cm9rZT0iIzA1MDgxNCIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz4KPHBhdGggZD0iTTEwIDEwSDE2IiBzdHJva2U9IiMwNTA4MTQiIHN0cm9rZS13aWR0aD0iMSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+CjxwYXRoIGQ9Ik0xMCAxM0gxNCIgc3Ryb2tlPSIjMDUwODE0IiBzdHJva2Utd2lkdGg9IjEiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPgo8Y2lyY2xlIGN4PSIxNiIgY3k9IjE2IiByPSIyIiBmaWxsPSIjREFBNTIwIiBzdHJva2U9IiMwNTA4MTQiIHN0cm9rZS13aWR0aD0iMC41Ii8+Cjwvc3ZnPgo='">
          Tyton Project Manager
        </h2>
        
        <!-- Tyton+ Feature Notice -->
        <div style="text-align: center; margin: 60px auto; max-width: 800px;">
          <div style="background: linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.9) 100%), linear-gradient(135deg, rgba(255,107,53,.08) 0%, rgba(139,92,246,.05) 50%, rgba(0,212,170,.07) 100%); border: 1px solid var(--border-subtle); border-radius: 20px; padding: 60px 40px; box-shadow: 0 20px 40px rgba(0,0,0,.3), 0 8px 16px rgba(0,0,0,.2), inset 0 1px 0 rgba(241,245,249,.08); backdrop-filter: blur(16px) saturate(180%); position: relative; overflow: hidden;">
            
            <!-- Tyton+ Badge -->
            <div style="display: inline-flex; align-items: center; gap: 8px; background: var(--gradient-primary); color: var(--ink); padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 14px; margin-bottom: 24px; box-shadow: 0 4px 12px var(--glow-primary);">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
              </svg>
              Tyton+
            </div>
            
            <!-- AI Icon -->
            <div style="margin-bottom: 24px;">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" style="color: var(--gold); margin: 0 auto; display: block;">
                <path d="M12 2L13.09 8.26L20 9L14 14L15.09 21L12 18L8.91 21L10 14L4 9L10.91 8.26L12 2Z" fill="currentColor" opacity="0.3"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                <path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
            
            <!-- Content -->
            <h3 style="color: var(--gold); font-size: 28px; font-weight: 700; margin-bottom: 16px; letter-spacing: 1px;">
              AI-Powered Project Builder
            </h3>
            
            <p style="color: var(--muted); font-size: 18px; line-height: 1.6; margin-bottom: 32px;">
              Our advanced AI assistant will help you plan, organize, and manage research projects from conception to completion. Get intelligent suggestions, automated workflows, and collaborative tools powered by cutting-edge artificial intelligence.
            </p>
            
            <!-- Features List -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 24px; margin-bottom: 40px; text-align: left;">
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 32px; height: 32px; border-radius: 8px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="var(--ink)">
                    <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z"/>
                  </svg>
                </div>
                <span style="color: var(--white); font-weight: 500;">Smart Project Planning</span>
              </div>
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 32px; height: 32px; border-radius: 8px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="var(--ink)">
                    <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89317 18.7122 8.75608 18.1676 9.45768C17.623 10.1593 16.8604 10.6597 16 10.88"/>
                  </svg>
                </div>
                <span style="color: var(--white); font-weight: 500;">Team Collaboration</span>
              </div>
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 32px; height: 32px; border-radius: 8px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="var(--ink)">
                    <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z"/>
                  </svg>
                </div>
                <span style="color: var(--white); font-weight: 500;">Automated Workflows</span>
              </div>
              <div style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 32px; height: 32px; border-radius: 8px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="var(--ink)">
                    <path d="M9 19C-2 19 2 3 2 3S6 1 13 1 24 3 24 3-5 19 9 19ZM20 12C20 16 16 20 12 20"/>
                  </svg>
                </div>
                <span style="color: var(--white); font-weight: 500;">AI Insights & Analytics</span>
              </div>
            </div>
            
            <!-- Construction Notice -->
            <div style="background: rgba(218,165,32,.1); border: 1px solid var(--border-accent); border-radius: 12px; padding: 24px; margin-bottom: 32px;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="var(--gold)">
                  <path d="M12 2L2 7L12 12L22 7L12 2Z"/>
                  <path d="M2 17L12 22L22 17M2 12L12 17L22 12"/>
                </svg>
                <span style="color: var(--gold); font-weight: 700; font-size: 18px;">Under Construction</span>
              </div>
              <p style="color: var(--muted); margin: 0; font-size: 16px;">
                This Tyton+ feature is currently under development. Our team is working hard to bring you the most advanced AI-powered project management tools for research collaboration.
              </p>
            </div>
            
            <!-- Coming Soon -->
            <p style="color: var(--white); font-weight: 600; font-size: 16px; margin: 0;">
              🚀 Coming Soon to Tyton+
            </p>
          </div>
        </div>
      </section>

      <!-- PROFILE PAGE -->
      <section id="profile-page" style="display:none;">
        <!-- Page Title at Top -->
        <h2 class="page-title">
          <img src="/assets/tyton_profile.png" alt="Profile" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.style.display='none'">
          User Profile
        </h2>
        
        <!-- Profile Information Box -->
        <section id="profile-info-section-content" style="margin-bottom:24px;">
          <article class="card profile-card" style="position: relative !important; overflow: visible !important;">
            <div class="profile">
              <img class="avatar" id="profile-avatar" src="/assets/logo.png" alt="avatar" onerror="this.src=generateFallbackLogo()">
              <div style="flex: 1; padding-right: 120px;">
                <h3 id="profile-display-name">Loading...</h3>
                <div class="meta" id="profile-display-handle">@loading</div>
                <div class="meta" style="margin-top: 8px;">
                  <span id="profile-display-institution"></span>
                  <span id="profile-display-level"></span>
                </div>
                <p id="profile-display-bio" style="margin-top: 12px;">Loading bio...</p>
                <div style="margin-top: 12px;">
                  <span id="profile-display-research-area" class="tag"></span>
                  <span id="profile-display-location" style="color: var(--muted); font-size: 12px;"></span>
                </div>
              </div>
            </div>
            
            <!-- Profile Action Buttons -->
            <div class="profile-actions">
              <button id="edit-profile-btn" onclick="toggleEditMode()" class="edit-profile-button">
                <span class="edit-icon">✏️</span>
                <span class="edit-text">Edit Profile</span>
              </button>
              <button id="post-btn" onclick="showCreateModal()" class="edit-profile-button">
                <span class="edit-icon">＋</span>
                <span class="edit-text">Post</span>
              </button>
            </div>
            
            <hr id="profile-divider" style="border:none;border-top:1px solid rgba(255,255,255,.12); margin:20px 0; display: none;">
            
            <form id="profileForm" class="grid" style="grid-template-columns:1fr 1fr; gap:16px; display: none;">
              <div class="field">
                <label>First Name</label>
                <input name="firstName" id="profile-first-name" placeholder="Enter your first name">
              </div>
              <div class="field">
                <label>Last Name</label>
                <input name="lastName" id="profile-last-name" placeholder="Enter your last name">
              </div>
              <div class="field">
                <label>Handle</label>
                <input name="handle" id="profile-handle" placeholder="@username">
              </div>
              <div class="field">
                <label>Research Area</label>
                <select name="researchArea" id="profile-research-area">
                  <option value="">Select your primary research area</option>
                  <option value="bioengineering">Bioengineering</option>
                  <option value="computer-science">Computer Science</option>
                  <option value="electrical-engineering">Electrical Engineering</option>
                  <option value="mechanical-engineering">Mechanical Engineering</option>
                  <option value="materials-science">Materials Science</option>
                  <option value="chemistry">Chemistry</option>
                  <option value="physics">Physics</option>
                  <option value="mathematics">Mathematics</option>
                  <option value="environmental-science">Environmental Science</option>
                  <option value="neuroscience">Neuroscience</option>
                  <option value="robotics">Robotics & Automation</option>
                  <option value="ai-ml">AI & Machine Learning</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="field">
                <label>Institution</label>
                <input name="institution" id="profile-institution" placeholder="University, Company, or Organization">
              </div>
              <div class="field">
                <label>Academic Level</label>
                <select name="academicLevel" id="profile-academic-level">
                  <option value="">Select your current level</option>
                  <option value="undergraduate">Undergraduate Student</option>
                  <option value="graduate">Graduate Student</option>
                  <option value="phd">PhD Student</option>
                  <option value="postdoc">Postdoctoral Researcher</option>
                  <option value="faculty">Faculty/Professor</option>
                  <option value="industry">Industry Professional</option>
                  <option value="independent">Independent Researcher</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="field" style="grid-column: span 2;">
                <label>Bio</label>
                <textarea name="bio" id="profile-bio" rows="3" placeholder="Tell others about your research interests"></textarea>
              </div>
              <div class="field">
                <label>Location</label>
                <input name="location" id="profile-location" placeholder="City, State/Country">
              </div>
              <div class="field">
                <label>Photo URL</label>
                <input name="photo" id="profile-photo" placeholder="https://example.com/avatar.jpg">
              </div>
              <div class="field" style="grid-column: span 2; display:flex; gap:12px; justify-content:flex-end;">
                <button type="button" class="btn" onclick="cancelEditMode()">Cancel</button>
                <button class="btn gold" type="submit" id="profile-save-btn">💾 Save Changes</button>
              </div>
            </form>
          </article>
        </section>
        
        <!-- Profile Posts/Listings/Following Tabs -->
        <article class="card" style="margin-bottom:24px;">
          <div class="tabs">
            <!-- TODO: Replace 📊 emoji with proper icon -->
            <button id="tab-posts" onclick="setProfileTab('posts')">📊 My Posts</button>
            <!-- TODO: Replace 🔧 emoji with proper icon -->
            <button id="tab-listings" onclick="setProfileTab('listings')">🔧 My Listings</button>
            <!-- TODO: Replace 👁️ emoji with proper icon -->
            <button id="tab-following" onclick="setProfileTab('following')">👁️ Following</button>
          </div>
          
          <div class="grid" id="profile-content">
            <div class="empty-state">Loading profile data...</div>
          </div>
        </article>
        
      </section>

      <!-- NEWS PAGE -->
      <section id="blog-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_blog.png" alt="News" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.style.display='none'">
          Tyton News
        </h2>
        
        <!-- News Stats -->
        <div class="pagination-info" id="news-info" style="text-align: center; margin-bottom: 20px; color: var(--muted);">
          <p>Loading news articles...</p>
        </div>
        
        <button id="new-post-btn" class="btn gold" onclick="showCreatePostModal()" style="display: none; margin-bottom: 20px;">
          ✍️ New Article
        </button>

        <!-- News Articles Grid -->
        <div class="grid" id="blog-grid" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
          <div class="empty-state">
            <div class="spinner"></div>
            <p>Loading news articles...</p>
          </div>
        </div>
      </section>
      
      <!-- TYTON+ PREMIUM PAGE -->
      <section id="tyton-plus-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_plus.png" alt="Tyton+" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.style.display='none'">
          Tyton+
        </h2>
        
        <!-- Hero Section -->
        <div style="text-align: center; margin: 40px auto 60px; max-width: 1000px;">
          <div style="background: linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.95) 100%), linear-gradient(135deg, rgba(255,107,53,.1) 0%, rgba(139,92,246,.08) 50%, rgba(218,165,32,.12) 100%); border: 1px solid var(--border-accent); border-radius: 24px; padding: 60px 40px; box-shadow: 0 20px 60px rgba(0,0,0,.4), 0 8px 24px rgba(0,0,0,.3), inset 0 1px 0 rgba(241,245,249,.1); backdrop-filter: blur(20px) saturate(180%); position: relative; overflow: hidden;">
            
            <!-- Decorative Background Elements -->
            <div style="position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle at 30% 40%, rgba(218,165,32,.15) 0%, transparent 50%), radial-gradient(circle at 70% 60%, rgba(255,107,53,.1) 0%, transparent 50%), radial-gradient(circle at 50% 80%, rgba(139,92,246,.1) 0%, transparent 50%); opacity: 0.6; z-index: -1;"></div>
            
            <!-- Premium Badge -->
            <div style="display: inline-flex; align-items: center; gap: 8px; background: var(--gradient-primary); color: var(--ink); padding: 12px 24px; border-radius: 30px; font-weight: 800; font-size: 16px; margin-bottom: 32px; box-shadow: 0 8px 32px var(--glow-primary); transform: scale(1.05);">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L15.09 8.26L22 9L17 14L18.18 21L12 17.77L5.82 21L7 14L2 9L8.91 8.26L12 2Z"/>
              </svg>
              PREMIUM MEMBERSHIP
            </div>
            
            <!-- Main Heading -->
            <h1 style="color: var(--white); font-size: clamp(32px, 5vw, 48px); font-weight: 800; margin-bottom: 24px; letter-spacing: 2px; line-height: 1.2;">
              Supercharge Your Research
            </h1>
            
            <p style="color: var(--muted); font-size: 20px; line-height: 1.6; margin-bottom: 40px; max-width: 700px; margin-left: auto; margin-right: auto;">
              Unlock AI-powered tools, advanced analytics, priority support, and exclusive features designed for serious researchers and institutions.
            </p>
            
            <!-- CTA Buttons -->
            <div style="display: flex; gap: 20px; justify-content: center; align-items: center; flex-wrap: wrap; margin-bottom: 40px;">
              <button style="background: var(--gradient-primary); color: var(--ink); border: none; padding: 18px 36px; border-radius: 16px; font-weight: 700; font-size: 18px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 12px 36px var(--glow-primary); transform: translateY(-2px);">
                🚀 Start Free Trial
              </button>
              <button style="background: rgba(255,255,255,.1); color: var(--white); border: 1px solid rgba(255,255,255,.2); padding: 18px 36px; border-radius: 16px; font-weight: 600; font-size: 18px; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px);">
                📋 Compare Plans
              </button>
            </div>
            
            <!-- Trust Indicators -->
            <div style="display: flex; gap: 32px; justify-content: center; align-items: center; flex-wrap: wrap; opacity: 0.8;">
              <div style="text-align: center;">
                <div style="color: var(--gold); font-size: 24px; font-weight: 700;">500+</div>
                <div style="color: var(--muted); font-size: 14px;">Research Groups</div>
              </div>
              <div style="text-align: center;">
                <div style="color: var(--gold); font-size: 24px; font-weight: 700;">10K+</div>
                <div style="color: var(--muted); font-size: 14px;">Active Projects</div>
              </div>
              <div style="text-align: center;">
                <div style="color: var(--gold); font-size: 24px; font-weight: 700;">99.9%</div>
                <div style="color: var(--muted); font-size: 14px;">Uptime</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Feature Highlights -->
        <div style="margin-bottom: 80px;">
          <h2 style="text-align: center; margin-bottom: 48px; font-size: 32px; color: var(--white);">Premium Features</h2>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 32px; max-width: 1200px; margin: 0 auto;">
            <!-- AI Project Manager -->
            <div style="background: linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.9) 100%); border: 1px solid var(--border-subtle); border-radius: 20px; padding: 32px; box-shadow: 0 12px 32px rgba(0,0,0,.2); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
              <div style="width: 64px; height: 64px; border-radius: 16px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; margin-bottom: 24px;">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="var(--ink)">
                  <path d="M12 2L13.09 8.26L20 9L14 14L15.09 21L12 18L8.91 21L10 14L4 9L10.91 8.26L12 2Z"/>
                  <circle cx="12" cy="12" r="3" stroke="var(--ink)" stroke-width="1"/>
                </svg>
              </div>
              <h3 style="color: var(--white); font-size: 20px; margin-bottom: 16px;">AI Project Manager</h3>
              <p style="color: var(--muted); line-height: 1.6; margin-bottom: 20px;">Intelligent project planning, automated workflows, and AI-powered insights to accelerate your research timeline.</p>
              <div style="color: var(--gold); font-weight: 600; font-size: 14px;">Coming Soon</div>
            </div>
            
            <!-- Advanced Analytics -->
            <div style="background: linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.9) 100%); border: 1px solid var(--border-subtle); border-radius: 20px; padding: 32px; box-shadow: 0 12px 32px rgba(0,0,0,.2); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
              <div style="width: 64px; height: 64px; border-radius: 16px; background: var(--gradient-secondary); display: flex; align-items: center; justify-content: center; margin-bottom: 24px;">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                  <path d="M3 3V21H21V19H5V3H3ZM21 7H19V17H21V7ZM17 9H15V17H17V9ZM13 11H11V17H13V11ZM9 13H7V17H9V13Z"/>
                </svg>
              </div>
              <h3 style="color: var(--white); font-size: 20px; margin-bottom: 16px;">Advanced Analytics</h3>
              <p style="color: var(--muted); line-height: 1.6; margin-bottom: 20px;">Deep insights into collaboration patterns, research trends, and productivity metrics with beautiful dashboards.</p>
              <div style="color: var(--atomic-cyan); font-weight: 600; font-size: 14px;">Available Now</div>
            </div>
            
            <!-- Priority Support -->
            <div style="background: linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.9) 100%); border: 1px solid var(--border-subtle); border-radius: 20px; padding: 32px; box-shadow: 0 12px 32px rgba(0,0,0,.2); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='translateY(0)'">
              <div style="width: 64px; height: 64px; border-radius: 16px; background: var(--gradient-mystical); display: flex; align-items: center; justify-content: center; margin-bottom: 24px;">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                  <path d="M21 6H3C2.45 6 2 6.45 2 7S2.45 8 3 8H21C21.55 8 22 7.55 22 7S21.55 6 21 6ZM21 10H3C2.45 10 2 10.45 2 11S2.45 12 3 12H21C21.55 12 22 11.55 22 11S21.55 10 21 10ZM21 14H3C2.45 14 2 14.45 2 15S2.45 16 3 16H21C21.55 16 22 15.55 22 15S21.55 14 21 14ZM21 18H3C2.45 18 2 18.45 2 19S2.45 20 3 20H21C21.55 20 22 19.55 22 19S21.55 18 21 18Z"/>
                </svg>
              </div>
              <h3 style="color: var(--white); font-size: 20px; margin-bottom: 16px;">Priority Support</h3>
              <p style="color: var(--muted); line-height: 1.6; margin-bottom: 20px;">24/7 dedicated support, direct access to our research team, and priority feature requests.</p>
              <div style="color: var(--cosmic-purple); font-weight: 600; font-size: 14px;">Available Now</div>
            </div>
          </div>
        </div>
        
        <!-- Pricing Section -->
        <div style="margin-bottom: 80px;">
          <h2 style="text-align: center; margin-bottom: 48px; font-size: 32px; color: var(--white);">Choose Your Plan</h2>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 32px; max-width: 1000px; margin: 0 auto;">
            <!-- Free Plan -->
            <div style="background: linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.9) 100%); border: 1px solid var(--border-subtle); border-radius: 20px; padding: 32px; box-shadow: 0 8px 24px rgba(0,0,0,.2); position: relative;">
              <h3 style="color: var(--white); font-size: 24px; margin-bottom: 8px;">Free</h3>
              <div style="color: var(--muted); margin-bottom: 24px;">Perfect for getting started</div>
              <div style="margin-bottom: 32px;">
                <span style="color: var(--white); font-size: 48px; font-weight: 700;">$0</span>
                <span style="color: var(--muted); font-size: 16px;">/month</span>
              </div>
              <ul style="list-style: none; padding: 0; margin: 0 0 32px 0;">
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--atomic-cyan);">✓</span> Basic project management
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--atomic-cyan);">✓</span> Community discussions
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--atomic-cyan);">✓</span> Equipment marketplace
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--atomic-cyan);">✓</span> 5GB storage
                </li>
              </ul>
              <button style="width: 100%; background: rgba(255,255,255,.1); color: var(--white); border: 1px solid rgba(255,255,255,.2); padding: 16px; border-radius: 12px; font-weight: 600; cursor: pointer;">
                Current Plan
              </button>
            </div>
            
            <!-- Plus Plan -->
            <div style="background: linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.9) 100%), linear-gradient(135deg, rgba(218,165,32,.1) 0%, rgba(255,107,53,.05) 100%); border: 2px solid var(--border-accent); border-radius: 20px; padding: 32px; box-shadow: 0 16px 48px rgba(218,165,32,.2), 0 8px 24px rgba(0,0,0,.3); position: relative; transform: scale(1.05);">
              <!-- Popular Badge -->
              <div style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--gradient-primary); color: var(--ink); padding: 8px 24px; border-radius: 20px; font-weight: 700; font-size: 14px; box-shadow: 0 4px 12px var(--glow-primary);">
                MOST POPULAR
              </div>
              <h3 style="color: var(--gold); font-size: 24px; margin-bottom: 8px; font-weight: 700;">Tyton+</h3>
              <div style="color: var(--muted); margin-bottom: 24px;">For serious researchers</div>
              <div style="margin-bottom: 32px;">
                <span style="color: var(--gold); font-size: 48px; font-weight: 700;">$9.99</span>
                <span style="color: var(--muted); font-size: 16px;">/month</span>
              </div>
              <ul style="list-style: none; padding: 0; margin: 0 0 32px 0;">
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--gold);">⭐</span> Everything in Free
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--gold);">⭐</span> AI Project Manager
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--gold);">⭐</span> Advanced analytics
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--gold);">⭐</span> Priority support
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--gold);">⭐</span> 100GB storage
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--gold);">⭐</span> Custom integrations
                </li>
              </ul>
              <button style="width: 100%; background: var(--gradient-primary); color: var(--ink); border: none; padding: 16px; border-radius: 12px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 24px var(--glow-primary);">
                Start Free Trial
              </button>
            </div>
            
            <!-- Enterprise Plan -->
            <div style="background: linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.9) 100%); border: 1px solid var(--border-subtle); border-radius: 20px; padding: 32px; box-shadow: 0 8px 24px rgba(0,0,0,.2); position: relative;">
              <h3 style="color: var(--white); font-size: 24px; margin-bottom: 8px;">Enterprise</h3>
              <div style="color: var(--muted); margin-bottom: 24px;">For institutions & teams</div>
              <div style="margin-bottom: 32px;">
                <span style="color: var(--white); font-size: 24px; font-weight: 700;">Custom</span>
                <span style="color: var(--muted); font-size: 16px;"> pricing</span>
              </div>
              <ul style="list-style: none; padding: 0; margin: 0 0 32px 0;">
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--cosmic-purple);">💎</span> Everything in Plus
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--cosmic-purple);">💎</span> Unlimited storage
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--cosmic-purple);">💎</span> Dedicated account manager
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--cosmic-purple);">💎</span> On-premise deployment
                </li>
                <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: var(--white);">
                  <span style="color: var(--cosmic-purple);">💎</span> Custom SLA
                </li>
              </ul>
              <button style="width: 100%; background: var(--gradient-mystical); color: var(--white); border: none; padding: 16px; border-radius: 12px; font-weight: 600; cursor: pointer;">
                Contact Sales
              </button>
            </div>
          </div>
        </div>
        
        <!-- FAQ Section -->
        <div style="margin-bottom: 60px; max-width: 800px; margin-left: auto; margin-right: auto;">
          <h2 style="text-align: center; margin-bottom: 48px; font-size: 32px; color: var(--white);">Frequently Asked Questions</h2>
          
          <div style="space-y: 16px;">
            <div style="background: var(--card); border: 1px solid var(--border-subtle); border-radius: 16px; padding: 24px; margin-bottom: 16px;">
              <h4 style="color: var(--white); margin-bottom: 12px;">What's included in the free trial?</h4>
              <p style="color: var(--muted); margin: 0; line-height: 1.6;">You get full access to all Tyton+ features for 14 days, including the AI Project Manager, advanced analytics, and priority support. No credit card required.</p>
            </div>
            
            <div style="background: var(--card); border: 1px solid var(--border-subtle); border-radius: 16px; padding: 24px; margin-bottom: 16px;">
              <h4 style="color: var(--white); margin-bottom: 12px;">Can I cancel anytime?</h4>
              <p style="color: var(--muted); margin: 0; line-height: 1.6;">Yes! You can cancel your subscription at any time. Your access to premium features will continue until the end of your current billing period.</p>
            </div>
            
            <div style="background: var(--card); border: 1px solid var(--border-subtle); border-radius: 16px; padding: 24px; margin-bottom: 16px;">
              <h4 style="color: var(--white); margin-bottom: 12px;">Is my research data secure?</h4>
              <p style="color: var(--muted); margin: 0; line-height: 1.6;">Absolutely. We use enterprise-grade encryption, regular security audits, and comply with research data protection standards. Your intellectual property is always protected.</p>
            </div>
            
            <div style="background: var(--card); border: 1px solid var(--border-subtle); border-radius: 16px; padding: 24px;">
              <h4 style="color: var(--white); margin-bottom: 12px;">Do you offer student discounts?</h4>
              <p style="color: var(--muted); margin: 0; line-height: 1.6;">Yes! Students with valid .edu email addresses receive 50% off Tyton+ subscriptions. Contact our support team to verify your student status.</p>
            </div>
          </div>
        </div>
        
        <!-- Final CTA -->
        <div style="text-align: center; margin-bottom: 40px;">
          <div style="background: linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.95) 100%); border: 1px solid var(--border-accent); border-radius: 20px; padding: 48px 32px; max-width: 600px; margin: 0 auto; box-shadow: 0 12px 32px rgba(0,0,0,.2);">
            <h3 style="color: var(--gold); font-size: 28px; margin-bottom: 16px; font-weight: 700;">Ready to upgrade your research?</h3>
            <p style="color: var(--muted); font-size: 18px; margin-bottom: 32px; line-height: 1.6;">Join thousands of researchers who are already using Tyton+ to accelerate their discoveries.</p>
            <button style="background: var(--gradient-primary); color: var(--ink); border: none; padding: 20px 40px; border-radius: 16px; font-weight: 700; font-size: 18px; cursor: pointer; box-shadow: 0 12px 36px var(--glow-primary); margin-right: 16px;">
              🚀 Start Your Free Trial
            </button>
            <div style="color: var(--muted); font-size: 14px; margin-top: 16px;">
              No credit card required • 14-day free trial • Cancel anytime
            </div>
          </div>
        </div>
      </section>


      <!-- PREFERENCES PAGE -->
      <section id="preferences-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_preferences.png" alt="Preferences" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.style.display='none'">
          Preferences
        </h2>
        
        <!-- Account Settings Section -->
        <div class="card" style="margin-bottom: 24px;">
          <h3>Account Settings</h3>
          <p>Manage your account details, security settings, and login preferences.</p>
          
          <div style="margin-top: 24px;">
            <h4>Email & Password</h4>
            <p style="color: var(--muted);">Update your email address and password settings.</p>
            
            <h4 style="margin-top: 24px;">Two-Factor Authentication</h4>
            <p style="color: var(--muted);">Add an extra layer of security to your account.</p>
            
            <h4 style="margin-top: 24px;">Connected Accounts</h4>
            <p style="color: var(--muted);">Manage your Google and other connected social accounts.</p>
          </div>
        </div>
        
        <!-- User Preferences Section -->
        <div class="card">
          <h3>User Preferences</h3>
          <p>Customize your Tyton experience to match your workflow and preferences.</p>
          
          <div style="margin-top: 24px;">
            <h4>Notifications</h4>
            <p style="color: var(--muted);">Choose which emails and in-app notifications you receive.</p>
            
            <h4 style="margin-top: 24px;">Display Settings</h4>
            <p style="color: var(--muted);">Adjust timezone, date formats, and language preferences.</p>
            
            <h4 style="margin-top: 24px;">Privacy</h4>
            <p style="color: var(--muted);">Control who can see your profile and activity.</p>
          </div>
        </div>
      </section>

      <!-- THEME PAGE -->
      <section id="theme-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_theme.png" alt="Theme" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.style.display='none'">
          Theme Settings
        </h2>
        
        <div class="card">
          <h3>Appearance</h3>
          <p>Customize the visual appearance of Tyton to match your style.</p>
          
          <div style="margin-top: 24px;">
            <h4>Color Theme</h4>
            <p style="color: var(--muted);">Choose between dark mode, light mode, or automatic based on system preferences.</p>
            
            <h4 style="margin-top: 24px;">Interface Density</h4>
            <p style="color: var(--muted);">Adjust the spacing and sizing of interface elements.</p>
            
            <h4 style="margin-top: 24px;">Custom Colors</h4>
            <p style="color: var(--muted);">Personalize accent colors and highlighting (Tyton+ feature).</p>
          </div>
        </div>
      </section>

      <!-- HELP & SUPPORT PAGE -->
      <section id="help-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_help.png" alt="Help" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.style.display='none'">
          Help & Support
        </h2>
        
        <div class="card">
          <h3>Get Help</h3>
          <p>Find answers to your questions and get support when you need it.</p>
          
          <div style="margin-top: 24px;">
            <h4>Documentation</h4>
            <p style="color: var(--muted);">Browse our comprehensive guides and tutorials.</p>
            
            <h4 style="margin-top: 24px;">Contact Support</h4>
            <p style="color: var(--muted);">Get help from our support team via email or live chat.</p>
            
            <h4 style="margin-top: 24px;">Community Forum</h4>
            <p style="color: var(--muted);">Ask questions and get help from other Tyton users.</p>
            
            <h4 style="margin-top: 24px;">Video Tutorials</h4>
            <p style="color: var(--muted);">Watch step-by-step video guides for common tasks.</p>
          </div>
        </div>
      </section>

      <!-- ABOUT PAGE -->
      <section id="about-page" style="display:none;">
        <h2 class="page-title">
          <img src="/assets/tyton_about.png" alt="About" style="width: 32px; height: 32px; margin-right: 12px; vertical-align: middle;" onerror="this.style.display='none'">
          About Tyton
        </h2>
        
        <div class="card">
          <h3>About This Platform</h3>
          <p>Tyton is a research collaboration platform designed to connect researchers and accelerate scientific discovery.</p>
          
          <div style="margin-top: 24px;">
            <h4>Version Information</h4>
            <p style="color: var(--muted);">Tyton Platform v2.1.0 - Last updated: December 2024</p>
            
            <h4 style="margin-top: 24px;">Terms of Service</h4>
            <p style="color: var(--muted);">Read our terms of service and privacy policy.</p>
            
            <h4 style="margin-top: 24px;">Credits & Acknowledgments</h4>
            <p style="color: var(--muted);">Built with modern web technologies and open-source libraries.</p>
            
            <h4 style="margin-top: 24px;">Contact Information</h4>
            <p style="color: var(--muted);">Email: support@tyton.com | Website: www.tyton.com</p>
          </div>
        </div>
      </section>

      <!-- Create News Article Modal -->
      <div id="create-post-modal" class="auth-modal">
        <div class="auth-modal-content">
          <div class="card auth-card" style="max-width: 600px;">
            <button onclick="hideCreatePostModal()" class="auth-close">×</button>
            
            <h2 class="auth-title">✍️ Create News Article</h2>
            <form id="create-post-form">
              <div class="field">
                <label>Title</label>
                <input name="title" required placeholder="Enter post title">
              </div>
              <div class="field">
                <label>Category</label>
                <select name="category" required>
                  <option value="">Select category</option>
                  <option value="announcement">📢 Announcement</option>
                  <option value="research">🔬 Research Update</option>
                  <option value="team">👥 Team News</option>
                  <option value="tutorial">📚 Tutorial</option>
                  <option value="story">📖 User Story</option>
                  <option value="technical">⚙️ Technical</option>
                </select>
              </div>
              <div class="field">
                <label>Content</label>
                <textarea name="content" rows="12" required placeholder="Write your blog post content here... (Markdown supported)"></textarea>
              </div>
              <div class="field">
                <label>Tags (optional)</label>
                <input name="tags" placeholder="research, announcement, tutorial">
              </div>
              <div style="display: flex; gap: 12px; margin-top: 24px;">
                <button type="button" class="btn" onclick="hideCreatePostModal()">Cancel</button>
                <button type="submit" class="btn gold btn-full">Publish Post</button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <!-- Diagnostics -->
      <section class="card" style="margin-top:32px;">
        <!-- TODO: Replace 🔍 emoji with proper icon -->
        <h3>🔍 System Diagnostics</h3>
        <pre class="diag" id="diagnostics">System initializing...</pre>
      </section>
    </main>
  </div>

  <script src="/auth-utils.js"></script>
  <script src="/error-handling.js"></script>
  <script>
    // App State
    let appState = {
      route: 'home',
      profileTab: 'posts',
      createType: 'project',
      items: [],
      followers: {},
      profile: {},
      currentUser: null,
      authToken: localStorage.getItem('tyton_auth_token'),
      diag: [],
      isOnline: false,
      blogPosts: [],
      discussions: [],
      // Pagination state
      pagination: {
        projects: { currentPage: 1, itemsPerPage: 8 },
        equipment: { currentPage: 1, itemsPerPage: 8 },
        discussions: { currentPage: 1, itemsPerPage: 8 }
      }
    };

    // API Configuration
    const API_BASE = window.location.origin + '/api';

    // Security Functions for XSS Prevention
    function escapeHtml(unsafe) {
      if (typeof unsafe !== 'string') return '';
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function escapeAttribute(unsafe) {
      if (typeof unsafe !== 'string') return '';
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#x27;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");
    }

    // Toast Notification System
    function showToast(message, type = 'info', duration = 4000) {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      
      const icons = {
        success: '✅',
        error: '❌',
        warning: '⚠️',
        info: 'ℹ️'
      };
      
      toast.innerHTML = `
        <span class="toast-icon">${icons[type]}</span>
        <span class="toast-message">${escapeHtml(message)}</span>
        <span class="toast-close" onclick="this.parentElement.remove()">×</span>
      `;
      
      container.appendChild(toast);
      
      // Auto-remove after duration
      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => toast.remove(), 300);
      }, duration);
    }
    
    // Loading State Management
    function showLoading(message = 'Loading...') {
      const overlay = document.getElementById('loading-overlay');
      const content = overlay.querySelector('.loading-content div:last-child');
      content.textContent = message;
      overlay.style.display = 'flex';
    }
    
    function hideLoading() {
      document.getElementById('loading-overlay').style.display = 'none';
    }
    
    // Button Loading State
    function setButtonLoading(button, loading = true) {
      if (loading) {
        button.classList.add('loading');
        button.disabled = true;
      } else {
        button.classList.remove('loading');
        button.disabled = false;
      }
    }
    
    // Form Validation Helper
    function validateForm(form) {
      const inputs = form.querySelectorAll('input[required]');
      for (const input of inputs) {
        if (!input.validity.valid) {
          // Show custom validation message
          if (input.validity.valueMissing) {
            showToast(`${input.previousElementSibling?.textContent || 'Field'} is required`, 'warning');
          } else if (input.validity.typeMismatch) {
            showToast(`Please enter a valid ${input.type}`, 'warning');
          } else if (input.validity.tooShort) {
            showToast(`${input.previousElementSibling?.textContent || 'Field'} must be at least ${input.minLength} characters`, 'warning');
          } else if (input.validity.patternMismatch) {
            showToast(input.title || 'Please check the format', 'warning');
          }
          input.focus();
          return false;
        }
      }
      return true;
    }
    
    // Add real-time validation feedback
    document.addEventListener('DOMContentLoaded', () => {
      // Add validation styling on blur
      document.querySelectorAll('input').forEach(input => {
        input.addEventListener('blur', () => {
          if (input.required && !input.validity.valid) {
            input.style.borderColor = '#ef4444';
          } else if (input.value) {
            input.style.borderColor = '#10b981';
          } else {
            input.style.borderColor = '';
          }
        });
        
        // Clear error styling on input
        input.addEventListener('input', () => {
          if (input.validity.valid && input.value) {
            input.style.borderColor = '#10b981';
          } else {
            input.style.borderColor = '';
          }
        });
      });
    });

    // Fallback logo SVG for if the image file doesn't load
    function generateFallbackLogo() {
      return `data:image/svg+xml,` + encodeURIComponent(`
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400">
          <defs>
            <radialGradient id="bg" cx="50%" cy="30%">
              <stop offset="0%" stop-color="#17233b"/>
              <stop offset="100%" stop-color="#0e1a2b"/>
            </radialGradient>
            <linearGradient id="owl" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#f3bd4b"/>
              <stop offset="100%" stop-color="#d69c2f"/>
            </linearGradient>
            <linearGradient id="body" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#8B4513"/>
              <stop offset="100%" stop-color="#7a263a"/>
            </linearGradient>
          </defs>
          
          <!-- Background -->
          <rect width="400" height="400" rx="64" fill="url(#bg)"/>
          
          <!-- Owl Body -->
          <ellipse cx="200" cy="250" rx="100" ry="120" fill="url(#body)"/>
          
          <!-- Owl Head -->
          <circle cx="200" cy="150" r="80" fill="url(#owl)"/>
          
          <!-- Eyes -->
          <circle cx="175" cy="135" r="25" fill="#0e1a2b"/>
          <circle cx="225" cy="135" r="25" fill="#0e1a2b"/>
          <circle cx="175" cy="135" r="15" fill="#d69c2f"/>
          <circle cx="225" cy="135" r="15" fill="#d69c2f"/>
          <circle cx="180" cy="130" r="6" fill="#0e1a2b"/>
          <circle cx="230" cy="130" r="6" fill="#0e1a2b"/>
          
          <!-- Beak -->
          <path d="M200 155 L190 170 L210 170 Z" fill="#7a263a"/>
          
          <!-- Ear Tufts -->
          <path d="M140 90 Q150 60 170 70 Q160 85 150 100" fill="url(#owl)"/>
          <path d="M260 90 Q250 60 230 70 Q240 85 250 100" fill="url(#owl)"/>
          
          <!-- Wings -->
          <ellipse cx="150" cy="260" rx="30" ry="60" fill="#7a263a" opacity="0.8"/>
          <ellipse cx="250" cy="260" rx="30" ry="60" fill="#7a263a" opacity="0.8"/>
          
          <!-- Chest -->
          <ellipse cx="200" cy="230" rx="40" ry="30" fill="url(#owl)" opacity="0.6"/>
        </svg>
      `);
    }

    // API Functions
    async function apiCall(endpoint, options = {}) {
      try {
        const headers = {
          'Content-Type': 'application/json',
          ...options.headers
        };
        
        if (appState.authToken) {
          headers.Authorization = `Bearer ${appState.authToken}`;
        }
        
        const response = await fetch(API_BASE + endpoint, {
          headers,
          credentials: 'include', // This allows session-based auth to work
          ...options
        });
        
        // Read the response body once and determine if it's JSON or HTML
        const responseText = await response.text();
        
        if (!response.ok) {
          let errorMessage = 'API request failed';
          try {
            const error = JSON.parse(responseText);
            errorMessage = error.error || errorMessage;
          } catch (jsonError) {
            // Response is not JSON (probably HTML error page)
            console.error('Server returned HTML instead of JSON:', responseText.substring(0, 200));
            errorMessage = `Server error (${response.status}): ${response.statusText}`;
          }
          
          if (response.status === 401 && appState.authToken) {
            // Token expired or invalid, try to refresh auth
            await checkAuth();
          }
          throw new Error(errorMessage);
        }
        
        // For successful responses, parse as JSON
        try {
          return JSON.parse(responseText);
        } catch (jsonError) {
          // Response is not JSON even though it's 200 OK
          console.error('Server returned HTML for successful response:', responseText.substring(0, 200));
          throw new Error('Server returned HTML instead of JSON');
        }
      } catch (error) {
        log(`API Error: ${error.message}`);
        throw error;
      }
    }

    // Authentication API calls
    async function authCall(endpoint, options = {}) {
      try {
        const response = await fetch(window.location.origin + endpoint, {
          headers: {
            'Content-Type': 'application/json',
            ...options.headers
          },
          credentials: 'include',
          ...options
        });
        
        if (!response.ok) {
          const error = await response.json();
          // Include status code information for better error handling
          const errorMessage = error.error || 'Request failed';
          if (response.status === 409 && error.code === 'EMAIL_EXISTS') {
            throw new Error('EMAIL_EXISTS: ' + errorMessage);
          }
          throw new Error(errorMessage);
        }
        
        return await response.json();
      } catch (error) {
        log(`Auth Error: ${error.message}`);
        throw error;
      }
    }

    // Authentication Functions
    async function checkAuth() {
      // First try to get user info using session (works after OAuth redirect)
      try {
        const response = await authCall('/auth/me');
        appState.currentUser = response.user;
        
        // Check if user needs to complete profile setup
        if (appState.currentUser && !appState.currentUser.profileComplete) {
          // Redirect to profile setup page for incomplete profiles
          log(`User ${appState.currentUser.email || appState.currentUser.handle} needs profile completion`);
          // Generate a token for the session if we don't have one
          const token = appState.authToken || 'session-based'; 
          window.location.href = `/profile-setup.html?token=${encodeURIComponent(token)}`;
          return false;
        }
        
        // If we got user data but don't have a token, we're likely in a session-based flow
        if (appState.currentUser && !appState.authToken) {
          // Generate or get token for API calls
          log(`Authenticated via session as ${appState.currentUser.handle}`);
        } else if (appState.authToken) {
          log(`Authenticated via token as ${appState.currentUser.handle}`);
        }
        
        updateAuthUI();
        return true;
      } catch (error) {
        // If we have a token but the request failed, clear invalid token
        if (appState.authToken) {
          appState.authToken = null;
          localStorage.removeItem('tyton_auth_token');
          log('Invalid token cleared');
        }
        
        appState.currentUser = null;
        updateAuthUI();
        return false;
      }
    }

    async function handleLogin(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const submitBtn = event.target.querySelector('button[type="submit"]');
      
      setButtonLoading(submitBtn, true);
      
      try {
        const response = await authCall('/auth/login', {
          method: 'POST',
          body: JSON.stringify({
            email: formData.get('email'),
            password: formData.get('password')
          })
        });
        
        appState.authToken = response.token;
        appState.currentUser = response.user;
        localStorage.setItem('tyton_auth_token', response.token);
        
        hideAuthModal();
        
        // Check if user needs to complete profile setup
        if (!response.user.profileComplete) {
          log(`Redirecting ${response.user.email} to profile setup`);
          window.location.href = `/profile-setup.html?token=${encodeURIComponent(response.token)}`;
          return;
        }
        
        updateAuthUI();
        await loadData();
        showToast(`Welcome back, ${response.user.name || response.user.handle}!`, 'success');
        log(`Logged in as ${response.user.handle}`);
        
      } catch (error) {
        showToast(`Login failed: ${error.message}`, 'error');
      } finally {
        setButtonLoading(submitBtn, false);
      }
    }

    async function handleRegister(event) {
      event.preventDefault();
      const formData = new FormData(event.target);
      const submitBtn = event.target.querySelector('button[type="submit"]');
      
      setButtonLoading(submitBtn, true);
      
      try {
        const response = await authCall('/auth/register', {
          method: 'POST',
          body: JSON.stringify({
            name: formData.get('name'),
            email: formData.get('email'),
            handle: formData.get('handle'),
            password: formData.get('password')
          })
        });
        
        appState.authToken = response.token;
        appState.currentUser = response.user;
        localStorage.setItem('tyton_auth_token', response.token);
        
        hideAuthModal();
        
        // Check if user needs to complete profile setup
        if (response.requiresProfileSetup || !response.user.profileComplete) {
          log(`Redirecting ${response.user.email} to profile setup`);
          window.location.href = `/profile-setup.html?token=${encodeURIComponent(response.token)}`;
          return;
        }
        
        updateAuthUI();
        await loadData();
        showToast(`Welcome to Tyton, ${response.user.name || response.user.handle}!`, 'success');
        log(`Registered as ${response.user.handle}`);
        
      } catch (error) {
        // Handle duplicate email error specifically
        if (error.message.includes('already exists') || error.message.includes('EMAIL_EXISTS')) {
          showToast('An account already exists with this email. Please login instead.', 'error');
          // Switch to login form
          showAuthModal('login');
          // Pre-fill email in login form
          const loginEmailField = document.querySelector('#login-form input[name="email"]');
          if (loginEmailField) {
            loginEmailField.value = formData.get('email');
          }
        } else {
          showToast(`Registration failed: ${error.message}`, 'error');
        }
      } finally {
        setButtonLoading(submitBtn, false);
      }
    }

    async function logout() {
      showLoading('Logging out...');
      try {
        await authCall('/auth/logout', { method: 'POST' });
      } catch (error) {
        // Ignore logout errors
      } finally {
        hideLoading();
      }
      
      appState.authToken = null;
      appState.currentUser = null;
      localStorage.removeItem('tyton_auth_token');
      
      // Clear user-specific data
      appState.followers = {};
      appState.profile = {};
      
      updateAuthUI();
      await loadData();
      log('Logged out');
    }

    function showAuthModal(type) {
      const modal = document.getElementById('auth-modal');
      const loginForm = document.getElementById('login-form');
      const registerForm = document.getElementById('register-form');
      
      modal.style.display = 'block';
      loginForm.style.display = type === 'login' ? 'block' : 'none';
      registerForm.style.display = type === 'register' ? 'block' : 'none';
      
      // Focus first input
      setTimeout(() => {
        const firstInput = document.querySelector(`#${type}-form input`);
        if (firstInput) firstInput.focus();
      }, 100);
    }

    function hideAuthModal() {
      document.getElementById('auth-modal').style.display = 'none';
    }

    function toggleUserMenu() {
      const dropdown = document.getElementById('user-dropdown');
      
      if (!dropdown) {
        console.error('User dropdown not found');
        return;
      }
      
      // Close all other dropdowns first
      
      // Toggle user dropdown using classes for better CSS control
      const isVisible = dropdown.classList.contains('visible');
      
      if (isVisible) {
        dropdown.classList.remove('visible');
        dropdown.style.display = 'none';
      } else {
        dropdown.classList.add('visible');
        dropdown.style.display = 'block';
      }
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
      const userDropdown = document.getElementById('user-dropdown');
      const userMenuButton = document.querySelector('[onclick="toggleUserMenu()"]');
      
      if (userDropdown && userMenuButton && 
          !userDropdown.contains(event.target) && 
          !userMenuButton.contains(event.target)) {
        userDropdown.classList.remove('visible');
        userDropdown.style.display = 'none';
      }
    });

    // Mobile navigation toggle
    function toggleMobileNav() {
      const sidebar = document.querySelector('.nav-sidebar');
      const toggleBtn = document.querySelector('.mobile-nav-toggle');
      
      const isOpen = sidebar.classList.contains('mobile-open');
      
      sidebar.classList.toggle('mobile-open');
      toggleBtn.classList.toggle('active');
      
      // Update ARIA attributes
      toggleBtn.setAttribute('aria-expanded', !isOpen);
      sidebar.setAttribute('aria-hidden', isOpen);
      
      // Prevent body scroll when menu is open
      if (!isOpen) {
        document.body.style.overflow = 'hidden';
      } else {
        document.body.style.overflow = '';
      }
    }

    // Close mobile nav when clicking on nav items
    document.addEventListener('click', function(event) {
      if (event.target.classList.contains('nav-item')) {
        const sidebar = document.querySelector('.nav-sidebar');
        const toggleBtn = document.querySelector('.mobile-nav-toggle');
        
        if (sidebar.classList.contains('mobile-open')) {
          sidebar.classList.remove('mobile-open');
          toggleBtn.classList.remove('active');
          document.body.style.overflow = '';
        }
      }
    });

    // Close mobile nav when clicking on overlay
    document.addEventListener('click', function(event) {
      const sidebar = document.querySelector('.nav-sidebar');
      const toggleBtn = document.querySelector('.mobile-nav-toggle');
      
      if (sidebar.classList.contains('mobile-open') && 
          event.target === sidebar && 
          event.target.tagName !== 'BUTTON') {
        sidebar.classList.remove('mobile-open');
        toggleBtn.classList.remove('active');
        toggleBtn.setAttribute('aria-expanded', 'false');
        sidebar.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }
    });

    // Keyboard navigation support
    document.addEventListener('keydown', function(event) {
      const sidebar = document.querySelector('.nav-sidebar');
      const toggleBtn = document.querySelector('.mobile-nav-toggle');
      
      // Close mobile nav with ESC key
      if (event.key === 'Escape' && sidebar.classList.contains('mobile-open')) {
        sidebar.classList.remove('mobile-open');
        toggleBtn.classList.remove('active');
        toggleBtn.setAttribute('aria-expanded', 'false');
        sidebar.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
        toggleBtn.focus(); // Return focus to toggle button
      }
    });
    

    // Weather Widget Functions
    class WeatherWidget {
      constructor() {
        this.userAgent = 'TytonAPI/1.0 (Research Collaboration Platform, contact@tyton.edu)';
        this.defaultLocation = { lat: 37.8715, lon: -122.2730, name: 'Berkeley, CA' }; // Berkeley, CA
        this.weatherIcons = {
          'clear': '☀️',
          'sunny': '☀️',
          'partly cloudy': '⛅',
          'mostly cloudy': '☁️',
          'cloudy': '☁️',
          'overcast': '☁️',
          'rain': '🌧️',
          'showers': '🌦️',
          'thunderstorms': '⛈️',
          'snow': '❄️',
          'fog': '🌫️',
          'windy': '💨',
          'default': '🌤️'
        };
        this.init();
      }

      async init() {
        this.updateTime();
        setInterval(() => this.updateTime(), 60000); // Update time every minute
        await this.requestLocation();
        
        // Auto-refresh weather every 10 minutes
        setInterval(() => {
          console.log('Auto-refreshing weather data...');
          this.requestLocation();
        }, 10 * 60 * 1000); // 10 minutes
      }

      updateTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit',
          hour12: true 
        });
        document.getElementById('weather-time').textContent = timeString;
      }

      async requestLocation() {
        // Show loading state
        this.updateWeatherDisplay({
          location: 'Updating...',
          temperature: '--',
          status: 'Loading',
          humidity: null,
          precipChance: null,
          uvIndex: null,
          airQuality: null
        });
        
        if (navigator.geolocation) {
          try {
            const position = await new Promise((resolve, reject) => {
              navigator.geolocation.getCurrentPosition(resolve, reject, {
                timeout: 10000,
                enableHighAccuracy: true
              });
            });
            
            const { latitude, longitude } = position.coords;
            await this.getWeatherData(latitude, longitude);
          } catch (error) {
            console.log('Location permission denied or unavailable, using default location');
            await this.getWeatherData(this.defaultLocation.lat, this.defaultLocation.lon, this.defaultLocation.name);
          }
        } else {
          console.log('Geolocation not supported, using default location');
          await this.getWeatherData(this.defaultLocation.lat, this.defaultLocation.lon, this.defaultLocation.name);
        }
      }

      async getWeatherData(lat, lon, defaultName = null) {
        try {
          // Try to get city name from coordinates using reverse geocoding
          let cityName = defaultName || 'Berkeley';
          
          // Get location name using reverse geocoding
          if (!defaultName) {
            try {
              const geocodeResponse = await fetch(
                `https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`,
                { mode: 'cors', cache: 'default' }
              );
              
              if (geocodeResponse.ok) {
                const geocodeData = await geocodeResponse.json();
                const city = geocodeData.city || geocodeData.locality || geocodeData.principalSubdivision;
                const region = geocodeData.principalSubdivisionCode || geocodeData.countryCode;
                
                if (city) {
                  cityName = region ? `${city}, ${region}` : city;
                } else if (geocodeData.countryName) {
                  cityName = geocodeData.countryName;
                }
              }
            } catch (geocodeError) {
              console.log('Reverse geocoding failed, using coordinates');
              cityName = `${lat.toFixed(2)}°, ${lon.toFixed(2)}°`;
            }
          }
          
          // Use Open-Meteo free weather API (no key required)
          try {
            const response = await fetch(
              `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&temperature_unit=fahrenheit&windspeed_unit=mph&precipitation_unit=inch`,
              { 
                mode: 'cors',
                cache: 'default'
              }
            );
            
            if (response.ok) {
              const data = await response.json();
              const current = data.current_weather;
              
              // Map weather codes to conditions
              const weatherCodeMap = {
                0: 'Clear',
                1: 'Mostly Clear',
                2: 'Partly Cloudy',
                3: 'Overcast',
                45: 'Foggy',
                48: 'Foggy',
                51: 'Light Drizzle',
                53: 'Drizzle',
                55: 'Heavy Drizzle',
                61: 'Light Rain',
                63: 'Rain',
                65: 'Heavy Rain',
                71: 'Light Snow',
                73: 'Snow',
                75: 'Heavy Snow',
                80: 'Light Showers',
                81: 'Showers',
                82: 'Heavy Showers',
                95: 'Thunderstorm',
                96: 'Thunderstorm with Hail',
                99: 'Thunderstorm with Heavy Hail'
              };
              
              const weatherStatus = weatherCodeMap[current.weathercode] || 'Unknown';
              
              const weatherInfo = {
                location: cityName,
                temperature: Math.round(current.temperature),
                status: weatherStatus,
                description: weatherStatus.toLowerCase(),
                humidity: 65, // Open-Meteo doesn't provide humidity in basic tier
                precipChance: current.weathercode >= 51 ? 60 : 20,
                uvIndex: this.estimateUVIndex(weatherStatus),
                airQuality: this.generatePlaceholderAQI(),
                windSpeed: Math.round(current.windspeed),
                icon: this.getWeatherIcon(weatherStatus)
              };
              
              this.updateWeatherDisplay(weatherInfo);
              
              // Store successful fetch
              localStorage.setItem('lastWeatherUpdate', Date.now());
              localStorage.setItem('lastWeatherData', JSON.stringify(weatherInfo));
              return;
            }
          } catch (apiError) {
            console.log('Weather API unavailable, checking cache');
            
            // Try to use cached weather data if recent (within 30 minutes)
            const lastUpdate = localStorage.getItem('lastWeatherUpdate');
            const lastData = localStorage.getItem('lastWeatherData');
            
            if (lastUpdate && lastData) {
              const timeDiff = Date.now() - parseInt(lastUpdate);
              if (timeDiff < 30 * 60 * 1000) { // 30 minutes
                const cachedWeather = JSON.parse(lastData);
                this.updateWeatherDisplay(cachedWeather);
                return;
              }
            }
          }
          
          // Fallback to simulated data if API fails and no cache
          const weatherInfo = {
            location: defaultName || 'Berkeley, CA',
            temperature: this.generateSimulatedTemperature(),
            status: this.generateSimulatedConditions(),
            humidity: Math.floor(Math.random() * 40) + 30,
            precipChance: Math.floor(Math.random() * 100),
            uvIndex: Math.floor(Math.random() * 10) + 1,
            airQuality: Math.floor(Math.random() * 150) + 50
          };
          
          this.updateWeatherDisplay(weatherInfo);
          
        } catch (error) {
          console.error('Weather widget error:', error);
          this.updateWeatherDisplay({
            location: 'Weather Unavailable',
            temperature: '--',
            status: 'Error',
            humidity: null,
            precipChance: null,
            uvIndex: null,
            airQuality: null
          });
        }
      }

      generateSimulatedTemperature() {
        // Generate temperature based on current time and season
        const now = new Date();
        const hour = now.getHours();
        const month = now.getMonth();
        
        // Base temperature varies by season
        let baseTemp = 65; // Spring/Fall
        if (month >= 5 && month <= 8) baseTemp = 75; // Summer
        if (month >= 11 || month <= 2) baseTemp = 45; // Winter
        
        // Vary by time of day
        const timeVariation = Math.sin((hour - 6) * Math.PI / 12) * 15;
        const randomVariation = (Math.random() - 0.5) * 10;
        
        return Math.round(baseTemp + timeVariation + randomVariation);
      }

      generateSimulatedConditions() {
        const conditions = ['Clear', 'Partly Cloudy', 'Cloudy', 'Partly Sunny', 'Fair'];
        const rareConditions = ['Light Rain', 'Showers', 'Thunderstorms'];
        
        // 80% chance of normal conditions, 20% chance of rain
        if (Math.random() < 0.8) {
          return conditions[Math.floor(Math.random() * conditions.length)];
        } else {
          return rareConditions[Math.floor(Math.random() * rareConditions.length)];
        }
      }

      estimateUVIndex(forecast) {
        const lowerForecast = forecast.toLowerCase();
        if (lowerForecast.includes('sunny') || lowerForecast.includes('clear')) return Math.floor(Math.random() * 3) + 6; // 6-8
        if (lowerForecast.includes('partly')) return Math.floor(Math.random() * 3) + 4; // 4-6
        if (lowerForecast.includes('cloudy') || lowerForecast.includes('overcast')) return Math.floor(Math.random() * 3) + 2; // 2-4
        return Math.floor(Math.random() * 2) + 1; // 1-2
      }

      generatePlaceholderAQI() {
        // Generate a realistic AQI value (typically 20-150)
        return Math.floor(Math.random() * 80) + 30;
      }

      getWeatherIcon(status) {
        const lowerStatus = status.toLowerCase();
        for (const [key, icon] of Object.entries(this.weatherIcons)) {
          if (lowerStatus.includes(key)) {
            return icon;
          }
        }
        return this.weatherIcons.default;
      }

      updateWeatherDisplay(weatherInfo) {
        // Update main weather info
        document.getElementById('weather-location').textContent = weatherInfo.location;
        document.getElementById('weather-temp').textContent = `${weatherInfo.temperature}°F`;
        document.getElementById('weather-status').textContent = weatherInfo.status;
        
        // Update weather icon
        const weatherIcon = this.getWeatherIcon(weatherInfo.status);
        document.getElementById('weather-icon').textContent = weatherIcon;
        
        // Update detailed weather info
        document.getElementById('uv-index').textContent = weatherInfo.uvIndex || '--';
        document.getElementById('air-quality').textContent = weatherInfo.airQuality || '--';
        document.getElementById('humidity').textContent = weatherInfo.humidity ? `${Math.round(weatherInfo.humidity)}%` : '--%';
        document.getElementById('precip-chance').textContent = weatherInfo.precipChance ? `${weatherInfo.precipChance}%` : '--%';
      }
    }


    function updateAuthUI() {
      const authButtons = document.getElementById('auth-buttons');
      const userMenu = document.getElementById('user-menu');
      const profileActions = document.querySelector('.profile-actions');
      
      if (appState.currentUser) {
        // Show user menu, hide auth buttons
        authButtons.style.display = 'none';
        userMenu.style.display = 'block';
        
        // Show profile actions when user is authenticated
        if (profileActions) {
          profileActions.style.display = 'flex';
        }
        
        // Update user menu
        document.getElementById('user-name').textContent = appState.currentUser.name || appState.currentUser.handle;
        const userAvatar = document.getElementById('user-avatar');
        userAvatar.src = appState.currentUser.photo || '/assets/logo.png';
        userAvatar.onerror = () => userAvatar.src = generateFallbackLogo();
        
        // Update profile display
        updateProfileDisplay();
        
      } else {
        // Show auth buttons, hide user menu
        authButtons.style.display = 'flex';
        userMenu.style.display = 'none';
        
        // Hide profile actions when not authenticated
        if (profileActions) {
          profileActions.style.display = 'none';
        }
      }
    }

    async function loadData() {
      try {
        const data = await apiCall('/data');
        appState.items = data.items || [];
        appState.followers = data.followers || {};
        appState.profile = data.profile || {};
        appState.currentUser = data.currentUser;
        appState.communities = data.communities || [];
        appState.isOnline = true;
        updateConnectionStatus();
        log('Data loaded from server');
        
        // Load discussions and journal papers separately
        await loadDiscussions();
        await loadJournalPapers();
      } catch (error) {
        // Don't set offline if we're authenticated but just had a data loading issue
        if (appState.currentUser) {
          // We're authenticated, just use default empty data and stay online
          appState.items = [];
          appState.followers = {};
          appState.profile = {};
          appState.isOnline = true;
          log('Authenticated user - using empty data, staying online');
        } else {
          // Fallback to localStorage if server is unavailable
          try {
            const localData = JSON.parse(localStorage.getItem('tyton_demo') || '{}');
            if (localData.items) appState.items = localData.items;
            if (localData.followers) appState.followers = localData.followers;
            if (localData.profile) Object.assign(appState.profile, localData.profile);
            log('Loaded data from localStorage (offline mode)');
          } catch (e) {
            log('Failed to load any data');
          }
          appState.isOnline = false;
        }
        updateConnectionStatus();
      }
    }

    async function loadDiscussions() {
      try {
        console.log('Loading discussions...');
        const discussions = await apiCall('/discussions');
        console.log('Received discussions:', discussions);
        appState.discussions = discussions || [];
        log('Discussions loaded from server:', appState.discussions.length, 'discussions');
      } catch (error) {
        console.error('Failed to load discussions:', error);
        log('Failed to load discussions:', error);
        appState.discussions = [];
      }
    }

    function getBookingSection(item) {
      return `
        <details class="booking-list">
          <summary style="cursor: pointer; font-weight: 500; margin-bottom: 8px;">📅 View Bookings (${(item.bookings || []).length})</summary>
          <ul style="margin:8px 0 0 16px;">
            ${(item.bookings || []).map(b => 
              `<li>${b.date} • ${b.slot} • ${b.by}</li>`
            ).join('') || '<li style="color: var(--muted);">No bookings yet</li>'}
          </ul>
        </details>

        <div style="margin: 16px 0;">
          <button class="btn gold" onclick="window.location.href='/marketplace.html?id=${item.id}'" style="width: 100%;">
            📋 View Details & Book
          </button>
        </div>
      `;
    }

    function updateGrid(gridId, items) {
      const grid = document.getElementById(gridId);
      if (!grid) {
        console.error('Grid element not found:', gridId);
        return;
      }
      
      if (items.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <h3>No items yet</h3>
            <p>Items will appear here once they're loaded.</p>
          </div>`;
        return;
      }

      grid.innerHTML = items.map(item => `
        <article class="card ${item.type === 'project' ? 'clickable-project' : item.type === 'equipment' ? 'clickable-equipment' : ''}" 
                 ${item.type === 'project' ? `onclick="openProject('${escapeAttribute(item.id)}')"` : 
                   item.type === 'equipment' ? `onclick="openEquipment('${escapeAttribute(item.id)}')"` : ''}>
          <h3>${escapeHtml(item.title)}</h3>
          <div class="meta">${formatMeta(item)}</div>
          <p>${escapeHtml(item.description || 'No description provided.')}</p>
          ${item.tags ? `<div style="margin: 12px 0;">${formatTags(item.tags)}</div>` : ''}
          
          ${item.type === 'equipment' ? getBookingSection(item) : ''}
          
          <div class="actions" ${item.type === 'project' || item.type === 'equipment' ? 'onclick="event.stopPropagation()"' : ''}>
            <button class="btn" onclick="handleLike('${escapeAttribute(item.id)}')">
              ❤️ ${item.likes || 0}
            </button>
            <button class="btn ghost" onclick="handleFollow('${escapeAttribute(item.id)}')">
              ${appState.followers[item.id] ? '👁️ Following' : '👀 Follow'}
            </button>
          </div>
        </article>
      `).join('');
    }

    function loadHomeContent() {
      // Load trending projects (top 3 by likes)
      const trendingProjects = appState.items
        .filter(item => item.type === 'project')
        .sort((a, b) => (b.likes || 0) - (a.likes || 0))
        .slice(0, 3);
      updateGrid('home-projects-grid', trendingProjects);
      
      // Load featured marketplace items (top 3 by likes)
      const featuredEquipment = appState.items
        .filter(item => item.type === 'equipment')
        .sort((a, b) => (b.likes || 0) - (a.likes || 0))
        .slice(0, 3);
      updateGrid('home-equipment-grid', featuredEquipment);
      
      // Load top groups (top 3 by member count)
      const topGroups = appState.communities
        ? appState.communities
          .sort((a, b) => (b.memberCount || 0) - (a.memberCount || 0))
          .slice(0, 3)
        : [];
      
      const groupsGrid = document.getElementById('home-groups-grid');
      if (topGroups.length === 0) {
        groupsGrid.innerHTML = `
          <div class="card" style="padding: 20px;">
            <h4 style="margin: 0 0 12px 0; color: var(--gold);">No Groups Yet</h4>
            <p style="margin: 0; color: var(--muted);">Groups will appear here once they're added!</p>
          </div>
        `;
      } else {
        groupsGrid.innerHTML = topGroups.map(group => `
          <article class="card" style="cursor: pointer; transition: transform 0.3s ease;" onclick="viewGroup('${group.id}')">
            <div style="display: flex; align-items: center; margin-bottom: 12px;">
              <div style="width: 40px; height: 40px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 16px; flex-shrink: 0;">
                ${group.avatar || '🏛️'}
              </div>
              <div style="flex: 1; min-width: 0;">
                <h4 style="margin: 0; font-size: 16px; color: var(--white); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${group.name}</h4>
                <div style="color: var(--muted); font-size: 12px;">
                  <span style="background: rgba(218,165,32,.2); padding: 1px 6px; border-radius: 8px; font-size: 10px;">${group.type}</span>
                  <span style="margin-left: 6px;">👥 ${group.memberCount || 0}</span>
                </div>
              </div>
            </div>
            <p style="margin: 0; color: var(--muted); font-size: 14px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${group.description || 'No description provided.'}</p>
          </article>
        `).join('');
      }
      
      // Load recent blog posts
      const recentBlogPosts = appState.blogPosts ? appState.blogPosts.slice(0, 3) : [];
      const blogGrid = document.getElementById('home-blog-grid');
      
      if (recentBlogPosts.length === 0) {
        blogGrid.innerHTML = `
          <div class="card" style="padding: 20px;">
            <h4 style="margin: 0 0 12px 0; color: var(--gold);">Coming Soon!</h4>
            <p style="margin: 0; color: var(--muted);">News articles will appear here once content is loaded.</p>
          </div>
        `;
      } else {
        blogGrid.innerHTML = recentBlogPosts.map(post => `
          <article class="card" style="cursor: pointer; transition: transform 0.3s ease;" onclick="window.location.href='/blog-post.html?id=${post.id}'"
            <h4 style="margin: 0 0 8px 0; font-size: 16px; color: var(--white);">
              ${post.title}
            </h4>
            <div class="meta" style="margin-bottom: 8px; font-size: 11px;">
              ${formatDate(post.publishedAt)} • ${post.readTime} min read • ${post.author} (${post.handle})
            </div>
            <p style="margin: 0; font-size: 14px; line-height: 1.4; color: var(--muted);">
              ${post.excerpt}
            </p>
          </article>
        `).join('');
      }
    }

    function loadBlogContent() {
      // Update news stats
      const newsCount = appState.blogPosts ? appState.blogPosts.length : 0;
      document.getElementById('news-info').innerHTML = `<p>Showing ${newsCount} news articles</p>`;
      
      // Show new post button for admin users (placeholder logic)
      const newPostBtn = document.getElementById('new-post-btn');
      if (appState.currentUser && appState.currentUser.isAdmin) {
        newPostBtn.style.display = 'block';
      } else {
        newPostBtn.style.display = 'none';
      }
      
      // Load blog posts
      const blogGrid = document.getElementById('blog-grid');
      
      if (appState.blogPosts && appState.blogPosts.length > 0) {
        blogGrid.innerHTML = appState.blogPosts.map(post => `
          <article class="card" style="cursor: pointer; transition: transform 0.3s ease;" onclick="window.location.href='/blog-post.html?id=${post.id}'"
            <h3 style="margin: 0 0 12px 0; font-size: 20px; line-height: 1.3; color: var(--white);">
              ${post.title}
            </h3>
            <div class="meta" style="margin-bottom: 16px;">
              ${formatDate(post.publishedAt)} • ${post.readTime} min read • ${post.author} (${post.handle})
            </div>
            <p style="margin: 0 0 16px 0; line-height: 1.6; color: var(--muted);">
              ${post.excerpt}
            </p>
            <div style="margin-top: 16px;">
              ${post.tags.map(tag => `<span class="tag" style="background: rgba(218,165,32,.2); color: var(--gold); padding: 4px 8px; border-radius: 6px; font-size: 12px; margin-right: 8px;">${tag}</span>`).join('')}
            </div>
          </article>
        `).join('');
      } else {
        document.getElementById('news-info').innerHTML = `<p>No news articles available</p>`;
        blogGrid.innerHTML = `
          <div class="card" style="padding: 40px; text-align: center;">
            <h3 style="margin: 0 0 16px 0; color: var(--gold);">No News Articles Yet</h3>
            <p style="margin: 0; color: var(--muted);">News articles will appear here once content is loaded.</p>
          </div>
        `;
      }
    }

    function showCreatePostModal() {
      document.getElementById('create-post-modal').style.display = 'block';
    }

    function hideCreatePostModal() {
      document.getElementById('create-post-modal').style.display = 'none';
    }

    async function createItem(itemData) {
      if (appState.isOnline) {
        try {
          const newItem = await apiCall('/items', {
            method: 'POST',
            body: JSON.stringify(itemData)
          });
          appState.items.unshift(newItem);
          log(`Created ${newItem.type}: ${newItem.title}`);
          return newItem;
        } catch (error) {
          throw error;
        }
      } else {
        // Offline fallback
        const newItem = {
          id: generateId(),
          ...itemData,
          owner: appState.profile.handle || '@anon',
          likes: 0,
          createdAt: Date.now()
        };
        if (itemData.type === 'equipment') {
          newItem.bookings = [];
        }
        appState.items.unshift(newItem);
        saveToLocalStorage();
        log(`Created ${newItem.type} (offline): ${newItem.title}`);
        return newItem;
      }
    }

    async function likeItem(itemId) {
      const item = appState.items.find(i => i.id === itemId);
      if (!item) return;

      if (appState.isOnline) {
        try {
          const result = await apiCall(`/items/${itemId}/like`, { method: 'PUT' });
          item.likes = result.likes;
          log(`Liked item: ${item.title}`);
        } catch (error) {
          // Fallback to local update
          item.likes = (item.likes || 0) + 1;
          saveToLocalStorage();
        }
      } else {
        item.likes = (item.likes || 0) + 1;
        saveToLocalStorage();
        log(`Liked item (offline): ${item.title}`);
      }
    }

    async function toggleFollow(itemId) {
      if (appState.isOnline) {
        try {
          const result = await apiCall(`/items/${itemId}/follow`, { method: 'PUT' });
          if (result.following) {
            appState.followers[itemId] = true;
          } else {
            delete appState.followers[itemId];
          }
          log(`Follow toggled for item: ${itemId}`);
        } catch (error) {
          // Fallback to local update
          toggleFollowLocal(itemId);
        }
      } else {
        toggleFollowLocal(itemId);
      }
    }

    function toggleFollowLocal(itemId) {
      if (appState.followers[itemId]) {
        delete appState.followers[itemId];
        log(`Unfollowed item (offline): ${itemId}`);
      } else {
        appState.followers[itemId] = true;
        log(`Following item (offline): ${itemId}`);
      }
      saveToLocalStorage();
    }

    async function bookEquipment(itemId, bookingData) {
      if (appState.isOnline) {
        try {
          await apiCall(`/equipment/${itemId}/book`, {
            method: 'POST',
            body: JSON.stringify(bookingData)
          });
          
          const item = appState.items.find(i => i.id === itemId);
          if (item) {
            item.bookings = item.bookings || [];
            item.bookings.push({
              ...bookingData,
              by: appState.profile.handle || '@anon'
            });
          }
          log(`Booked equipment: ${bookingData.date} ${bookingData.slot}`);
        } catch (error) {
          throw error;
        }
      } else {
        // Offline fallback
        const item = appState.items.find(i => i.id === itemId);
        if (item) {
          item.bookings = item.bookings || [];
          const hasConflict = item.bookings.some(b => 
            b.date === bookingData.date && b.slot === bookingData.slot
          );
          if (hasConflict) {
            throw new Error('Time slot is already booked');
          }
          item.bookings.push({
            ...bookingData,
            by: appState.profile.handle || '@anon'
          });
          saveToLocalStorage();
          log(`Booked equipment (offline): ${bookingData.date} ${bookingData.slot}`);
        }
      }
    }

    async function saveProfile(profileData) {
      if (appState.isOnline) {
        try {
          const updatedProfile = await apiCall('/profile', {
            method: 'PUT',
            body: JSON.stringify(profileData)
          });
          Object.assign(appState.profile, updatedProfile);
          log(`Profile saved: ${appState.profile.handle}`);
        } catch (error) {
          throw error;
        }
      } else {
        Object.assign(appState.profile, profileData);
        saveToLocalStorage();
        log(`Profile saved (offline): ${appState.profile.handle}`);
      }
    }

    async function seedData() {
      if (appState.isOnline) {
        try {
          const result = await apiCall('/seed', { method: 'POST' });
          appState.items = [...result.items, ...appState.items];
          log(`Seeded ${result.items.length} items from server`);
        } catch (error) {
          seedDataLocal();
        }
      } else {
        seedDataLocal();
      }
    }

    function seedDataLocal() {
      const now = Date.now();
      const sample = [
        {
          id: generateId(),
          type: 'project',
          title: 'Open Microfluidics Platform',
          description: 'Developing parametric chip designs for affordable microfluidics research. Target cost: under $30 per kit with open-source CAD files.',
          tags: 'bio,microfluidics,open-source',
          owner: '@josh',
          location: 'Remote',
          likes: 12,
          createdAt: now - 86400000 * 3
        },
        {
          id: generateId(),
          type: 'equipment',
          title: 'CNC Mill (Tormach PCNC 770M)',
          description: 'Precision CNC mill available for student projects. Includes automatic tool changer and coolant system.',
          tags: 'cnc,machining,precision',
          owner: '@makerspace',
          location: 'On-site (Berkeley Lab)',
          likes: 8,
          bookings: [
            { date: '2025-08-20', slot: '09:00–11:00', by: '@alice' },
            { date: '2025-08-22', slot: '13:00–15:00', by: '@bob' }
          ],
          createdAt: now - 86400000 * 7
        },
        {
          id: generateId(),
          type: 'project',
          title: 'Neural Network Hardware Accelerator',
          description: 'Custom FPGA-based accelerator for edge AI applications. Focus on power efficiency and real-time inference.',
          tags: 'ai,fpga,hardware,edge-computing',
          owner: '@alex_researcher',
          location: 'Hybrid',
          likes: 24,
          createdAt: now - 86400000 * 5
        }
      ];

      appState.items = [...sample, ...appState.items];
      saveToLocalStorage();
      log(`Seeded ${sample.length} demo items (offline)`);
    }

    async function resetDemo() {
      if (appState.isOnline) {
        try {
          await apiCall('/reset', { method: 'DELETE' });
          appState.items = [];
          appState.followers = {};
          appState.profile = { name: '', handle: '@josh', bio: '', photo: '' };
          log('Demo data reset on server');
        } catch (error) {
          resetDemoLocal();
        }
      } else {
        resetDemoLocal();
      }
    }

    function resetDemoLocal() {
      localStorage.removeItem('tyton_demo');
      appState.items = [];
      appState.followers = {};
      appState.profile = { name: '', handle: '@josh', bio: '', photo: '' };
      log('Demo data reset (offline)');
    }

    function saveToLocalStorage() {
      try {
        localStorage.setItem('tyton_demo', JSON.stringify({
          items: appState.items,
          followers: appState.followers,
          profile: appState.profile
        }));
      } catch(e) {
        log('Failed to save to localStorage: ' + e.message);
      }
    }

    function updateConnectionStatus() {
      const badge = document.getElementById('status-badge');
      if (appState.isOnline) {
        badge.textContent = '🌐 Online';
        badge.className = 'badge online';
      } else {
        badge.textContent = '📱 Offline mode';
        badge.className = 'badge offline';
      }
    }

    // Utility functions
    function log(message) {
      const timestamp = new Date().toLocaleTimeString();
      appState.diag.push(`[${timestamp}] ${message}`);
      const diagElement = document.getElementById('diagnostics');
      if (diagElement) {
        diagElement.textContent = appState.diag.slice(-10).join('\n'); // Keep last 10 messages
      }
    }

    function generateId() {
      return Math.random().toString(36).slice(2,11) + Date.now().toString(36);
    }

    function formatMeta(item) {
      const ts = new Date(item.createdAt || Date.now()).toLocaleDateString();
      const who = escapeHtml(item.owner || '@anon');
      const where = item.location ? ` • ${escapeHtml(item.location)}` : '';
      return `${who} • ${ts}${where}`;
    }

    function formatTags(tagsStr) {
      if (!tagsStr) return '';
      return tagsStr.split(',').map(tag => 
        `<span class="tag">${escapeHtml(tag.trim())}</span>`
      ).join('');
    }

    function formatDate(timestamp) {
      return new Date(timestamp).toLocaleDateString('en-US', { 
        year: 'numeric', 
        month: 'short', 
        day: 'numeric' 
      });
    }

    // Navigation
    function setRoute(route) {
      appState.route = route;
      updateRoute();
    }

    function updateRoute() {
      // Hide all pages
      document.getElementById('home-page').style.display = 'none';
      document.getElementById('search-page').style.display = 'none';
      document.getElementById('projects-page').style.display = 'none';
      document.getElementById('equipment-page').style.display = 'none';
      document.getElementById('groups-page').style.display = 'none';
      document.getElementById('group-detail-page').style.display = 'none';
      document.getElementById('discussions-page').style.display = 'none';
      document.getElementById('journal-page').style.display = 'none';
      document.getElementById('project-manager-page').style.display = 'none';
      document.getElementById('blog-page').style.display = 'none';
      document.getElementById('tyton-plus-page').style.display = 'none';
      document.getElementById('profile-page').style.display = 'none';
      document.getElementById('preferences-page').style.display = 'none';
      document.getElementById('theme-page').style.display = 'none';
      document.getElementById('help-page').style.display = 'none';
      document.getElementById('about-page').style.display = 'none';
      
      // Profile info section is now part of the profile page, so no separate handling needed
      
      // Update create section visibility based on route
      updateAuthUI();
      
      // Show current page
      document.getElementById(appState.route + '-page').style.display = 'block';
      
      // Load page-specific content
      if (appState.route === 'home') {
        loadHomeContent();
      } else if (appState.route === 'blog') {
        loadBlogContent();
      }
      
      // Update nav buttons
      document.querySelectorAll('.nav-item').forEach(btn => {
        btn.removeAttribute('aria-current');
      });
      
      // Set active nav button
      const activeNavButton = document.getElementById('nav-' + appState.route);
      if (activeNavButton) {
        activeNavButton.setAttribute('aria-current', 'page');
      } else {
        console.warn('Could not find nav button for route:', appState.route);
      }
      
      // Update content
      if (appState.route === 'projects') {
        renderProjects();
      } else if (appState.route === 'equipment') {
        renderEquipment();
      } else if (appState.route === 'groups') {
        renderGroups();
      } else if (appState.route === 'group-detail') {
        renderGroupDetail(appState.currentGroupId);
      } else if (appState.route === 'discussions') {
        renderDiscussions();
      } else if (appState.route === 'journal') {
        renderJournal();
      } else if (appState.route === 'profile') {
        renderProfile();
        updateProfileDisplay();
      }
    }

    // Create form
    // Modal functions
    function showCreateModal() {
      document.getElementById('createModal').style.display = 'flex';
      // Reset form
      document.getElementById('createModalForm').reset();
      // Set default type to project
      setCreateType('project');
      // Focus on title field
      setTimeout(() => {
        document.querySelector('#createModalForm input[name="title"]').focus();
      }, 100);
    }

    function hideCreateModal() {
      document.getElementById('createModal').style.display = 'none';
    }

    // Discussion modal functions
    function openCreateDiscussionModal() {
      // Create modal if it doesn't exist
      if (!document.getElementById('createDiscussionModal')) {
        createDiscussionModal();
      }
      document.getElementById('createDiscussionModal').style.display = 'flex';
      setTimeout(() => {
        document.getElementById('discussion-title').focus();
      }, 100);
    }

    function closeCreateDiscussionModal() {
      document.getElementById('createDiscussionModal').style.display = 'none';
      document.getElementById('create-discussion-form').reset();
    }

    function createDiscussionModal() {
      const modal = document.createElement('div');
      modal.id = 'createDiscussionModal';
      modal.className = 'modal-overlay';
      modal.style.display = 'none';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <h3>Start New Discussion</h3>
            <button class="modal-close" onclick="closeCreateDiscussionModal()">×</button>
          </div>
          
          <form id="create-discussion-form">
            <div class="modal-form-grid">
              <div class="field field-full">
                <label>Title</label>
                <input name="title" id="discussion-title" placeholder="What would you like to discuss?" required>
              </div>
              
              <div class="field field-full">
                <label>Content</label>
                <textarea name="content" id="discussion-content" rows="6" placeholder="Share your thoughts, questions, or ideas..." required></textarea>
              </div>
              
              <div class="field field-full">
                <label>Tags (optional)</label>
                <input name="tags" id="discussion-tags" placeholder="research, AI, collaboration (comma-separated)">
              </div>
            </div>
            
            <div class="modal-actions">
              <button type="button" class="btn" onclick="closeCreateDiscussionModal()">Cancel</button>
              <button type="submit" class="btn gold">💬 Post Discussion</button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(modal);

      // Add form submit handler
      document.getElementById('create-discussion-form').addEventListener('submit', handleCreateDiscussion);
      
      // Close modal when clicking outside
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          closeCreateDiscussionModal();
        }
      });
    }

    async function handleCreateDiscussion(e) {
      e.preventDefault();
      
      const title = document.getElementById('discussion-title').value.trim();
      const content = document.getElementById('discussion-content').value.trim();
      const tags = document.getElementById('discussion-tags').value.trim();
      
      if (!title || !content) {
        showToast('Title and content are required.', 'error');
        return;
      }
      
      // Check if user is authenticated
      if (!appState.currentUser) {
        showToast('Please log in to create a discussion.', 'error');
        return;
      }
      
      // Add loading state to submit button
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="spinner"></span> Creating...';
      submitBtn.disabled = true;
      
      try {
        console.log('Creating discussion with data:', { title, content, tags: tags || undefined });
        console.log('Current user:', appState.currentUser);
        console.log('Auth token:', appState.authToken);
        
        const response = await apiCall('/discussions', {
          method: 'POST',
          body: JSON.stringify({
            title,
            content,
            tags: tags || undefined
          })
        });
        
        console.log('Discussion creation response:', response);
        
        if (response && response.message) {
          closeCreateDiscussionModal();
          await loadDiscussions(); // Reload discussions
          if (appState.route === 'discussions') {
            renderDiscussions(); // Re-render if on discussions page
          }
          showToast('Discussion created successfully!');
        } else {
          showToast('Failed to create discussion: Invalid response', 'error');
        }
      } catch (error) {
        console.error('Error creating discussion:', error);
        console.error('Error details:', error.message);
        
        if (error.message && error.message.includes('<!DOCTYPE')) {
          showToast('Authentication error. Please try logging in again.', 'error');
        } else {
          showToast('Failed to create discussion: ' + (error.message || 'Unknown error'), 'error');
        }
      } finally {
        // Restore button state
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    }

    function openDiscussionThread(discussionId) {
      window.open(`/discussion-thread.html?id=${discussionId}`, '_blank');
    }

    // Journal functionality
    async function loadJournalPapers() {
      try {
        console.log('Loading journal papers...');
        const response = await apiCall('/journal');
        console.log('Received journal papers:', response);
        appState.journalPapers = response || [];
        log('Journal papers loaded from server:', appState.journalPapers.length, 'papers');
      } catch (error) {
        console.error('Failed to load journal papers:', error);
        log('Failed to load journal papers:', error);
        appState.journalPapers = [];
      }
    }

    function renderJournal() {
      const papers = appState.journalPapers || [];
      const grid = document.getElementById('journal-grid');
      const info = document.getElementById('journal-info');
      
      info.innerHTML = `<p>Showing ${papers.length} paper${papers.length !== 1 ? 's' : ''}</p>`;
      
      if (papers.length === 0) {
        grid.innerHTML = '<div class="empty-state">No papers yet. Be the first to submit your research!</div>';
        return;
      }
      
      grid.innerHTML = papers.map(paper => `
        <div class="card" style="cursor: pointer; transition: all 0.3s ease; position: relative;">
          <div style="position: absolute; top: 16px; right: 16px;">
            <span style="background: ${getStatusColor(paper.status)}; color: var(--ink); padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">
              ${paper.status.charAt(0).toUpperCase() + paper.status.slice(1)}
            </span>
          </div>
          
          <div style="margin-bottom: 16px; padding-right: 80px;">
            <h3 style="margin: 0 0 8px 0; font-size: 1.3rem; color: var(--white); line-height: 1.4;">${escapeHtml(paper.title)}</h3>
            <div style="display: flex; align-items: center; gap: 16px; color: var(--muted); font-size: 14px; margin-bottom: 12px;">
              <span style="color: var(--gold); font-weight: 600;">@${escapeHtml(paper.submittedBy)}</span>
              <span>${formatTime(paper.createdAt)}</span>
              <span style="color: var(--atomic-cyan);">${escapeHtml(paper.category)}</span>
            </div>
            <div style="color: var(--muted); font-size: 13px; margin-bottom: 8px;">
              Authors: ${escapeHtml(Array.isArray(paper.authors) ? paper.authors.join(', ') : paper.authors)}
            </div>
          </div>
          
          <div style="color: var(--muted); margin-bottom: 16px; line-height: 1.6;">
            ${escapeHtml(paper.abstract.length > 200 ? paper.abstract.substring(0, 200) + '...' : paper.abstract)}
          </div>
          
          <div style="display: flex; gap: 24px; color: var(--muted); font-size: 14px; margin-bottom: 16px;">
            <div style="display: flex; align-items: center; gap: 6px;">
              <span>👍</span>
              <span>${paper.likes || 0}</span>
            </div>
            <div style="display: flex; align-items: center; gap: 6px;">
              <span>👁️</span>
              <span>${paper.views || 0}</span>
            </div>
            <div style="display: flex; align-items: center; gap: 6px;">
              <span>📥</span>
              <span>${paper.downloads || 0}</span>
            </div>
          </div>
          
          ${paper.keywords && paper.keywords.length > 0 ? `
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              ${paper.keywords.map(keyword => `
                <span style="background: rgba(139,92,246,.15); color: var(--cosmic-purple); padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; border: 1px solid rgba(139,92,246,.3);">
                  ${keyword}
                </span>
              `).join('')}
            </div>
          ` : ''}
        </div>
      `).join('');
    }

    function getStatusColor(status) {
      switch(status) {
        case 'draft': return '#6b7280';
        case 'review': return '#f59e0b';
        case 'revision': return '#ef4444';
        case 'final': return '#10b981';
        default: return '#6b7280';
      }
    }

    function openCreatePaperModal() {
      if (!appState.currentUser) {
        showToast('Please sign in to submit a paper', 'error');
        return;
      }
      // TODO: Implement paper submission modal
      showToast('Paper submission modal coming soon!', 'info');
    }

    function formatTime(timestamp) {
      const date = new Date(timestamp);
      const now = new Date();
      const diff = now - date;
      
      if (diff < 60000) return 'just now';
      if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
      if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
      if (diff < 604800000) return Math.floor(diff / 86400000) + 'd ago';
      
      return date.toLocaleDateString();
    }

    function showToast(message, type = 'success') {
      // Create toast if it doesn't exist
      let toast = document.getElementById('toast');
      if (!toast) {
        toast = document.createElement('div');
        toast.id = 'toast';
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 16px 24px;
          border-radius: 8px;
          color: white;
          font-weight: 600;
          z-index: 10000;
          transform: translateX(100%);
          transition: transform 0.3s ease;
        `;
        document.body.appendChild(toast);
      }
      
      toast.textContent = message;
      toast.style.background = type === 'error' ? '#ef4444' : '#10b981';
      toast.style.transform = 'translateX(0)';
      
      setTimeout(() => {
        toast.style.transform = 'translateX(100%)';
      }, 3000);
    }

    // Close modal when clicking outside
    document.addEventListener('click', function(event) {
      const modal = document.getElementById('createModal');
      if (event.target === modal) {
        hideCreateModal();
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        hideCreateModal();
      }
    });

    function setCreateType(type) {
      appState.createType = type;
      updateCreateType();
    }

    function updateCreateType() {
      // Update modal tab buttons
      const projectTab = document.getElementById('modal-tab-project');
      const equipmentTab = document.getElementById('modal-tab-equipment');
      
      if (projectTab && equipmentTab) {
        projectTab.setAttribute('aria-selected', appState.createType === 'project');
        equipmentTab.setAttribute('aria-selected', appState.createType === 'equipment');
      }
    }

    async function handleCreateSubmit(e) {
      e.preventDefault();
      
      const btn = e.target.querySelector('button[type="submit"]');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span class="spinner"></span> Creating...';
      btn.disabled = true;

      try {
        const formData = new FormData(e.target);
        const title = formData.get('title').trim();
        
        if (!title) {
          showToast('Title is required', 'warning');
          return;
        }

        const itemData = {
          type: appState.createType,
          title: title,
          description: formData.get('description').trim(),
          tags: formData.get('tags').trim(),
          location: formData.get('location').trim()
        };

        await createItem(itemData);
        
        // Reset form and close modal
        e.target.reset();
        hideCreateModal();
        updateRoute(); // Refresh current view
        
        // Show success message
        showToast('Item created successfully!', 'success');
        
      } catch (error) {
        showToast(`Failed to create item: ${error.message}`, 'error');
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    // Pagination Functions
    function changePage(type, direction) {
      const paginationState = appState.pagination[type];
      const newPage = paginationState.currentPage + direction;
      const maxPage = Math.ceil(getItemsByType(type).length / paginationState.itemsPerPage);
      
      if (newPage >= 1 && newPage <= maxPage) {
        paginationState.currentPage = newPage;
        if (type === 'projects') {
          renderProjects();
        } else if (type === 'equipment') {
          renderEquipment();
        }
      }
    }

    function getItemsByType(type) {
      return appState.items.filter(item => item.type === (type === 'equipment' ? 'equipment' : 'project'));
    }

    function getPaginatedItems(type) {
      const allItems = getItemsByType(type);
      const paginationState = appState.pagination[type];
      const startIndex = (paginationState.currentPage - 1) * paginationState.itemsPerPage;
      const endIndex = startIndex + paginationState.itemsPerPage;
      return allItems.slice(startIndex, endIndex);
    }

    function updatePaginationInfo(type, typeName) {
      const allItems = getItemsByType(type);
      const paginationState = appState.pagination[type];
      const totalPages = Math.ceil(allItems.length / paginationState.itemsPerPage);
      
      // Update info section
      const infoElement = document.getElementById(`${type}-info`);
      const startItem = (paginationState.currentPage - 1) * paginationState.itemsPerPage + 1;
      const endItem = Math.min(paginationState.currentPage * paginationState.itemsPerPage, allItems.length);
      
      infoElement.innerHTML = `<p>Showing ${startItem}-${endItem} of ${allItems.length} ${typeName.toLowerCase()}</p>`;
      
      // Update pagination controls
      const paginationElement = document.getElementById(`${type}-pagination`);
      const pageInfoElement = document.getElementById(`${type}-page-info`);
      
      if (totalPages > 1) {
        paginationElement.style.display = 'flex';
        pageInfoElement.textContent = `Page ${paginationState.currentPage} of ${totalPages}`;
        
        // Update button states
        const prevBtn = paginationElement.querySelector('button:first-child');
        const nextBtn = paginationElement.querySelector('button:last-child');
        
        prevBtn.disabled = paginationState.currentPage === 1;
        nextBtn.disabled = paginationState.currentPage === totalPages;
      } else {
        paginationElement.style.display = 'none';
      }
    }

    // Render functions
    function renderProjects() {
      const allProjects = appState.items.filter(item => item.type === 'project');
      const projects = getPaginatedItems('projects');
      const grid = document.getElementById('projects-grid');
      
      if (allProjects.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <h3>No projects yet</h3>
            <p>Create your first project above to get started!</p>
          </div>`;
        document.getElementById('projects-pagination').style.display = 'none';
        document.getElementById('projects-info').innerHTML = '<p>No projects available</p>';
        return;
      }

      grid.innerHTML = projects.map(item => `
        <article class="card clickable-project" onclick="openProject('${item.id}')">
          <h3>${item.title}</h3>
          <div class="meta">${formatMeta(item)}</div>
          <p>${item.description || 'No description provided.'}</p>
          ${item.tags ? `<div style="margin: 12px 0;">${formatTags(item.tags)}</div>` : ''}
          <div class="actions" onclick="event.stopPropagation()">
            <button class="btn" onclick="handleLike('${item.id}')">
              ❤️ ${item.likes || 0}
            </button>
            <button class="btn ghost" onclick="handleFollow('${item.id}')">
              ${appState.followers[item.id] ? '👁️ Following' : '👀 Follow'}
            </button>
          </div>
        </article>
      `).join('');
      
      updatePaginationInfo('projects', 'Projects');
    }

    function renderEquipment() {
      const allEquipment = appState.items.filter(item => item.type === 'equipment');
      const equipment = getPaginatedItems('equipment');
      const grid = document.getElementById('equipment-grid');
      
      if (allEquipment.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <h3>No marketplace items yet</h3>
            <p>Add marketplace items above to start sharing resources!</p>
          </div>`;
        document.getElementById('equipment-pagination').style.display = 'none';
        document.getElementById('equipment-info').innerHTML = '<p>No marketplace items available</p>';
        return;
      }

      grid.innerHTML = equipment.map(item => `
        <article class="card">
          <h3>${item.title}</h3>
          <div class="meta">${formatMeta(item)}</div>
          <p>${item.description || 'No description provided.'}</p>
          ${item.tags ? `<div style="margin: 12px 0;">${formatTags(item.tags)}</div>` : ''}
          
          <details class="booking-list">
            <summary style="cursor: pointer; font-weight: 500; margin-bottom: 8px;">📅 View Bookings (${(item.bookings || []).length})</summary>
            <ul style="margin:8px 0 0 16px;">
              ${(item.bookings || []).map(b => 
                `<li>${b.date} • ${b.slot} • ${b.by}</li>`
              ).join('') || '<li style="color: var(--muted);">No bookings yet</li>'}
            </ul>
          </details>

          <div class="actions">
            <button class="btn gold" onclick="window.location.href='/marketplace.html?id=${item.id}'">
              📋 View Details & Book
            </button>
            <button class="btn" onclick="handleLike('${item.id}')">
              ❤️ ${item.likes || 0}
            </button>
            <button class="btn ghost" onclick="handleFollow('${item.id}')">
              ${appState.followers[item.id] ? '👁️ Following' : '👀 Follow'}
            </button>
          </div>
        </article>
      `).join('');
      
      updatePaginationInfo('equipment', 'Marketplace Items');
    }

    function renderGroups() {
      if (!appState.communities) {
        appState.communities = [];
      }
      
      const allGroups = appState.communities;
      const grid = document.getElementById('groups-grid');
      
      if (allGroups.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <h3>No groups yet</h3>
            <p>Groups will appear here once they're added!</p>
          </div>`;
        return;
      }

      // Apply filters
      let filteredGroups = [...allGroups];
      
      const searchTerm = document.getElementById('groups-search')?.value?.toLowerCase() || '';
      const typeFilter = document.getElementById('groups-type-filter')?.value || '';
      const locationFilter = document.getElementById('groups-location-filter')?.value || '';
      
      if (searchTerm) {
        filteredGroups = filteredGroups.filter(group => 
          group.name?.toLowerCase().includes(searchTerm) ||
          group.description?.toLowerCase().includes(searchTerm) ||
          group.tags?.toLowerCase().includes(searchTerm)
        );
      }
      
      if (typeFilter) {
        filteredGroups = filteredGroups.filter(group => group.type === typeFilter);
      }
      
      if (locationFilter) {
        filteredGroups = filteredGroups.filter(group => group.location === locationFilter);
      }

      grid.innerHTML = filteredGroups.map(group => `
        <article class="card" style="cursor: pointer; transition: transform 0.3s ease;" onclick="viewGroup('${group.id}')">
          <div style="display: flex; align-items: center; margin-bottom: 12px;">
            <div style="width: 50px; height: 50px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 20px; flex-shrink: 0;">
              ${group.avatar || '🏛️'}
            </div>
            <div>
              <h3 style="margin: 0; font-size: 18px;">${group.name}</h3>
              <div style="color: var(--muted); font-size: 14px;">
                <span style="background: rgba(218,165,32,.2); padding: 2px 8px; border-radius: 12px; font-size: 12px;">${group.type}</span>
                <span style="margin-left: 8px;">📍 ${group.location}</span>
              </div>
            </div>
          </div>
          
          <p style="margin: 12px 0; color: var(--muted);">${group.description || 'No description provided.'}</p>
          
          <div style="margin: 12px 0;">
            <div style="color: var(--muted); font-size: 14px; margin-bottom: 8px;">
              👥 <strong>${group.memberCount || 0}</strong> members
              ${group.tags ? `• 🏷️ ${group.tags}` : ''}
            </div>
          </div>
          
          <div style="display: flex; gap: 8px; margin-top: 16px;">
            <button class="btn" onclick="event.stopPropagation(); joinGroup('${group.id}')" style="flex: 1; background: var(--gradient-secondary);">
              ${group.joined ? '✓ Joined' : '+ Join Group'}
            </button>
          </div>
        </article>
      `).join('');
    }

    function filterGroups() {
      renderGroups();
    }

    async function joinGroup(groupId) {
      if (!appState.currentUser) {
        showAuthModal();
        return;
      }
      
      try {
        const response = await apiCall(`/communities/${groupId}/join`, { method: 'PUT' });
        
        // Update local state
        const group = appState.communities.find(c => c.id === groupId);
        if (group) {
          group.joined = response.joined;
          group.memberCount = response.memberCount;
          
          // Update UI based on current page
          if (appState.route === 'groups') {
            renderGroups();
          } else if (appState.route === 'group-detail') {
            renderGroupDetail(groupId);
          }
        }
      } catch (error) {
        console.error('Failed to join/leave group:', error);
        showToast('Failed to update group membership. Please try again.', 'error');
      }
    }

    function viewGroup(groupId) {
      appState.currentGroupId = groupId;
      appState.route = 'group-detail';
      updateRoute();
    }

    function renderGroupDetail(groupId) {
      const group = appState.communities?.find(c => c.id === groupId);
      const container = document.getElementById('group-detail-content');
      
      if (!group) {
        container.innerHTML = `
          <div class="card">
            <h2>Group not found</h2>
            <p>The requested group could not be found.</p>
            <button class="btn" onclick="setRoute('groups')">Back to Groups</button>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <div class="card" style="margin-bottom: 24px;">
          <button class="btn" onclick="setRoute('groups')" style="margin-bottom: 20px;">← Back to Groups</button>
          
          <div style="display: flex; align-items: center; margin-bottom: 24px;">
            <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; margin-right: 20px; font-size: 32px; flex-shrink: 0;">
              ${group.avatar || '🏛️'}
            </div>
            <div style="flex: 1;">
              <h1 style="margin: 0; font-size: 28px; color: var(--white);">${group.name}</h1>
              <div style="color: var(--muted); font-size: 16px; margin-top: 8px;">
                <span style="background: rgba(218,165,32,.2); padding: 4px 12px; border-radius: 12px; margin-right: 12px;">${group.type}</span>
                <span>📍 ${group.location}</span>
                <span style="margin-left: 12px;">👥 ${group.memberCount || 0} members</span>
              </div>
            </div>
            <button class="btn" onclick="joinGroup('${group.id}')" style="background: var(--gradient-secondary); min-width: 150px;">
              ${group.joined ? '✓ Joined' : '+ Join Group'}
            </button>
          </div>

          <div style="border-top: 1px solid rgba(255,255,255,.1); padding-top: 20px; margin-top: 0;">
            <h3 style="margin: 0 0 12px 0; color: var(--gold); font-size: 18px;">About</h3>
            <p style="color: var(--muted); line-height: 1.6; margin: 0 0 16px 0;">${group.description || 'No description available.'}</p>
            ${group.tags ? `
              <div style="margin-top: 16px;">
                <strong style="color: var(--white);">Tags:</strong>
                <span style="color: var(--muted); margin-left: 8px;">${group.tags}</span>
              </div>
            ` : ''}
          </div>
        </div>

        <div class="card">
          <h3 style="margin: 0 0 20px 0; color: var(--gold);">Group Activity</h3>
          <div class="empty-state">
            <p>Group discussions and activities coming soon!</p>
          </div>
        </div>
      `;
      
      // Show the page
      document.getElementById('group-detail-page').style.display = 'block';
    }

    // Profile functions
    function setProfileTab(tab) {
      appState.profileTab = tab;
      renderProfile();
    }

    function updateProfile() {
      // Use currentUser data if available, otherwise fall back to profile data
      const userData = appState.currentUser || appState.profile;
      
      document.getElementById('profile-display-name').textContent = userData.name || 'Your Name';
      document.getElementById('profile-display-handle').textContent = userData.handle || '@handle';
      document.getElementById('profile-display-bio').textContent = userData.bio || 'Add a short bio describing your research or making interests.';
      
      // Institution and level
      const institution = userData.institution || '';
      const level = userData.academicLevel || '';
      document.getElementById('profile-display-institution').textContent = institution;
      document.getElementById('profile-display-level').textContent = level ? ` • ${level}` : '';
      
      // Research area
      const researchAreaEl = document.getElementById('profile-display-research-area');
      if (userData.researchArea) {
        researchAreaEl.textContent = userData.researchArea.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        researchAreaEl.style.display = 'inline-block';
      } else {
        researchAreaEl.style.display = 'none';
      }
      
      // Location
      const locationEl = document.getElementById('profile-display-location');
      if (userData.location) {
        locationEl.textContent = ` • ${userData.location}`;
        locationEl.style.display = 'inline';
      } else {
        locationEl.style.display = 'none';
      }
      
      const avatar = userData.photo || '/assets/logo.png';
      const avatarEl = document.getElementById('profile-avatar');
      avatarEl.src = avatar;
      avatarEl.onerror = () => avatarEl.src = generateFallbackLogo();
      
      // Update form with current user data
      const nameParts = (userData.name || '').split(' ');
      document.getElementById('profile-first-name').value = nameParts[0] || '';
      document.getElementById('profile-last-name').value = nameParts.slice(1).join(' ') || '';
      document.getElementById('profile-handle').value = userData.handle || '';
      document.getElementById('profile-research-area').value = userData.researchArea || '';
      document.getElementById('profile-institution').value = userData.institution || '';
      document.getElementById('profile-academic-level').value = userData.academicLevel || '';
      document.getElementById('profile-bio').value = userData.bio || '';
      document.getElementById('profile-location').value = userData.location || '';
      document.getElementById('profile-photo').value = userData.photo || '';
    }

    function renderProfile() {
      updateProfile();
      
      // Update tab buttons
      document.querySelectorAll('#profile-page .tabs button').forEach(btn => {
        btn.removeAttribute('aria-selected');
      });
      document.getElementById('tab-' + appState.profileTab).setAttribute('aria-selected', 'true');
      
      const content = document.getElementById('profile-content');
      
      if (appState.profileTab === 'posts') {
        const myPosts = appState.items.filter(item => 
          item.type === 'project' && item.owner === appState.profile.handle
        );
        
        if (myPosts.length === 0) {
          content.innerHTML = '<div class="empty-state">No posts yet. Create a project to see it here!</div>';
        } else {
          content.innerHTML = myPosts.map(item => `
            <div class="card ${item.type === 'project' ? 'clickable-project' : ''}" 
                 ${item.type === 'project' ? `onclick="openProject('${item.id}')"` : ''}>
              <h3>${item.title}</h3>
              <div class="meta">${formatMeta(item)}</div>
              <p>${item.description || 'No description'}</p>
            </div>
          `).join('');
        }
      } else if (appState.profileTab === 'listings') {
        const myListings = appState.items.filter(item => 
          item.type === 'equipment' && item.owner === appState.profile.handle
        );
        
        if (myListings.length === 0) {
          content.innerHTML = '<div class="empty-state">No marketplace listings yet. Add marketplace items to see them here!</div>';
        } else {
          content.innerHTML = myListings.map(item => `
            <div class="card">
              <h3>${item.title}</h3>
              <div class="meta">${formatMeta(item)}</div>
              <p>${item.description || 'No description'}</p>
            </div>
          `).join('');
        }
      } else if (appState.profileTab === 'following') {
        const following = appState.items.filter(item => appState.followers[item.id]);
        
        if (following.length === 0) {
          content.innerHTML = '<div class="empty-state">You\'re not following anything yet. Follow projects or marketplace items to see them here!</div>';
        } else {
          content.innerHTML = following.map(item => `
            <div class="card ${item.type === 'project' ? 'clickable-project' : ''}" 
                 ${item.type === 'project' ? `onclick="openProject('${item.id}')"` : ''}>
              <h3>${item.title}</h3>
              <div class="meta">${formatMeta(item)}</div>
              <p>${item.description || 'No description'}</p>
            </div>
          `).join('');
        }
      }
    }

    function renderDiscussions() {
      const discussions = appState.discussions || [];
      const grid = document.getElementById('discussions-grid');
      const info = document.getElementById('discussions-info');
      
      info.innerHTML = `<p>Showing ${discussions.length} discussion${discussions.length !== 1 ? 's' : ''}</p>`;
      
      if (discussions.length === 0) {
        grid.innerHTML = '<div class="empty-state">No discussions yet. Start the first discussion!</div>';
        return;
      }
      
      grid.innerHTML = discussions.map(discussion => `
        <div class="card" onclick="openDiscussionThread('${escapeAttribute(discussion.id)}')" style="cursor: pointer; transition: all 0.3s ease;">
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px;">
            <div style="flex: 1;">
              <h3 style="margin: 0 0 8px 0; font-size: 1.4rem; color: var(--white);">${escapeHtml(discussion.title)}</h3>
              <div style="display: flex; align-items: center; gap: 16px; color: var(--muted); font-size: 14px;">
                <span style="color: var(--gold); font-weight: 600;">@${escapeHtml(discussion.owner)}</span>
                <span>${formatTime(discussion.createdAt)}</span>
              </div>
            </div>
          </div>
          
          <div style="color: var(--muted); margin-bottom: 16px; line-height: 1.6;">
            ${escapeHtml(discussion.content.length > 200 ? discussion.content.substring(0, 200) + '...' : discussion.content)}
          </div>
          
          <div style="display: flex; gap: 24px; color: var(--muted); font-size: 14px;">
            <div style="display: flex; align-items: center; gap: 6px;">
              <span>💬</span>
              <span>${discussion.replies || 0} replies</span>
            </div>
            <div style="display: flex; align-items: center; gap: 6px;">
              <span>👁️</span>
              <span>${discussion.views || 0} views</span>
            </div>
            <div style="display: flex; align-items: center; gap: 6px;">
              <span>👍</span>
              <span>${discussion.likes || 0} likes</span>
            </div>
          </div>
          
          ${discussion.tags ? `
            <div style="display: flex; gap: 8px; margin-top: 16px; flex-wrap: wrap;">
              ${discussion.tags.split(',').map(tag => `
                <span style="background: rgba(218,165,32,.15); color: var(--gold); padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; border: 1px solid rgba(218,165,32,.3);">
                  ${tag.trim()}
                </span>
              `).join('')}
            </div>
          ` : ''}
        </div>
      `).join('');
    }

    function updateProfileDisplay() {
      if (!appState.currentUser) return;
      
      const user = appState.currentUser;
      
      // Sync appState.profile with currentUser to ensure consistency
      appState.profile = {
        name: user.name || '',
        handle: user.handle || '',
        bio: user.bio || '',
        photo: user.photo || '',
        researchArea: user.researchArea || '',
        institution: user.institution || '',
        academicLevel: user.academicLevel || '',
        location: user.location || ''
      };
      
      // Update display elements
      document.getElementById('profile-display-name').textContent = user.name || 'Unknown User';
      document.getElementById('profile-display-handle').textContent = user.handle || '@user';
      document.getElementById('profile-display-bio').textContent = user.bio || 'No bio provided yet.';
      
      // Institution and level
      const institution = user.institution || '';
      const level = user.academicLevel || '';
      document.getElementById('profile-display-institution').textContent = institution;
      document.getElementById('profile-display-level').textContent = level ? ` • ${level}` : '';
      
      // Research area tag
      const researchAreaEl = document.getElementById('profile-display-research-area');
      if (user.researchArea) {
        researchAreaEl.textContent = user.researchArea.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
        researchAreaEl.style.display = 'inline-block';
      } else {
        researchAreaEl.style.display = 'none';
      }
      
      // Location
      const locationEl = document.getElementById('profile-display-location');
      if (user.location) {
        locationEl.textContent = ` 📍 ${user.location}`;
      } else {
        locationEl.textContent = '';
      }
      
      // Avatar
      const avatar = document.getElementById('profile-avatar');
      avatar.src = user.photo || '/assets/logo.png';
      avatar.onerror = () => avatar.src = generateFallbackLogo();
      
      // Update form fields
      document.getElementById('profile-first-name').value = user.firstName || '';
      document.getElementById('profile-last-name').value = user.lastName || '';
      document.getElementById('profile-handle').value = user.handle || '';
      document.getElementById('profile-research-area').value = user.researchArea || '';
      document.getElementById('profile-institution').value = user.institution || '';
      document.getElementById('profile-academic-level').value = user.academicLevel || '';
      document.getElementById('profile-bio').value = user.bio || '';
      document.getElementById('profile-location').value = user.location || '';
      document.getElementById('profile-photo').value = user.photo || '';
    }

    async function handleProfileSubmit(e) {
      e.preventDefault();
      
      const btn = document.getElementById('profile-save-btn');
      const originalText = btn.innerHTML;
      btn.innerHTML = '<span class="spinner"></span> Saving...';
      btn.disabled = true;

      try {
        const formData = new FormData(e.target);
        const firstName = formData.get('firstName').trim();
        const lastName = formData.get('lastName').trim();
        
        const profileData = {
          name: `${firstName} ${lastName}`.trim(),
          firstName: firstName,
          lastName: lastName,
          handle: formData.get('handle').trim(),
          researchArea: formData.get('researchArea'),
          institution: formData.get('institution').trim(),
          academicLevel: formData.get('academicLevel'),
          bio: formData.get('bio').trim(),
          location: formData.get('location').trim(),
          photo: formData.get('photo').trim()
        };
        
        // Ensure handle starts with @
        if (profileData.handle && !profileData.handle.startsWith('@')) {
          profileData.handle = '@' + profileData.handle;
        }
        
        const response = await apiCall('/profile', {
          method: 'PUT',
          body: JSON.stringify(profileData)
        });
        
        // Update current user data
        appState.currentUser = response;
        updateProfileDisplay();
        
        // Exit edit mode
        isEditMode = false;
        hideEditMode();
        
        showToast('Profile saved successfully!', 'success');
      } catch (error) {
        showToast(`Failed to save profile: ${error.message}`, 'error');
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }

    // Action handlers
    async function handleLike(itemId) {
      try {
        await likeItem(itemId);
        updateRoute();
      } catch (error) {
        showToast(`Failed to like item: ${error.message}`, 'error');
      }
    }

    async function handleFollow(itemId) {
      try {
        await toggleFollow(itemId);
        updateRoute();
      } catch (error) {
        showToast(`Failed to toggle follow: ${error.message}`, 'error');
      }
    }

    function openProject(projectId) {
      // Open project page in same tab
      window.location.href = `/project.html?id=${projectId}`;
    }

    function openEquipment(equipmentId) {
      // Open equipment page in same tab
      window.location.href = `/marketplace.html?id=${equipmentId}`;
    }

    async function handleBooking(e, itemId) {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="spinner"></span> Booking...';
      submitBtn.disabled = true;

      try {
        const formData = new FormData(e.target);
        const date = formData.get('date');
        const slot = formData.get('slot');
        
        if (!date || !slot) {
          showToast('Please select both date and time slot', 'warning');
          return;
        }

        await bookEquipment(itemId, { date, slot });
        e.target.reset();
        showToast('Marketplace item booked successfully!', 'success');
        updateRoute();
      } catch (error) {
        showToast(`Failed to book marketplace item: ${error.message}`, 'error');
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    }

    async function handleCreatePost(e) {
      e.preventDefault();
      
      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<span class="spinner"></span> Publishing...';
      submitBtn.disabled = true;

      try {
        const formData = new FormData(e.target);
        const postData = {
          title: formData.get('title'),
          category: formData.get('category'),
          content: formData.get('content'),
          tags: formData.get('tags')
        };

        // TODO: Implement blog post creation API
        // const newPost = await apiCall('/blog/posts', {
        //   method: 'POST',
        //   body: JSON.stringify(postData)
        // });

        // For now, just show success message
        showToast('News article created successfully! (Feature coming soon)', 'success');
        hideCreatePostModal();
        e.target.reset();
        
      } catch (error) {
        showToast(`Failed to create blog post: ${error.message}`, 'error');
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    }

    // Blog Posts Initialization
    function initializeBlogPosts() {
      appState.blogPosts = [
        {
          id: "google-willow-quantum-chip-2024",
          title: "Google's Willow Quantum Chip Breaks Through Error Correction Barrier",
          excerpt: "Google's latest quantum processor demonstrates exponential error reduction, marking a historic milestone in quantum computing development.",
          content: `Google unveiled its revolutionary Willow quantum chip this December, achieving a breakthrough that has been decades in the making: quantum error correction that actually reduces errors as more qubits are added to the system.

The 105-qubit superconducting processor represents a fundamental shift in quantum computing. Unlike previous systems where adding more qubits typically introduced more errors, Willow demonstrates "below threshold" error correction—each additional qubit actually makes the system more reliable rather than less.

**A Historic Achievement**

"This is the moment we've been working toward for 30 years," explained Dr. Hartmut Neven, head of Google Quantum AI. "We've crossed the threshold where quantum error correction becomes exponentially beneficial rather than exponentially costly."

The breakthrough centers on Google's novel approach to logical qubits—virtual qubits made from multiple physical qubits that can detect and correct their own errors in real-time. Willow's logical qubits demonstrated error rates that decreased by a factor of 2 each time the system size doubled, achieving a 10^-6 error rate with their largest logical qubit arrays.

**Real-World Implications**

Perhaps most remarkably, Willow solved a computational benchmark problem in under 5 minutes that would take today's fastest supercomputers 10 septillion years—a number that exceeds the age of the universe. This demonstrates "quantum advantage" on a scale never before achieved.

The technology has immediate implications for drug discovery, financial modeling, and climate simulation. Pharmaceutical companies including Roche and Biogen are already partnering with Google to explore molecular simulation applications that could accelerate drug development by decades.

**Beyond Computing**

Willow's error correction breakthrough also validates quantum computing's potential for artificial intelligence. The chip's ability to maintain quantum coherence while performing complex calculations opens pathways for quantum machine learning algorithms that could revolutionize how AI systems process information.

The achievement earned recognition from Physics World as their 2024 Breakthrough of the Year, shared with MIT and Harvard researchers who demonstrated similar error correction breakthroughs on atomic processors.

**Looking Forward**

Google plans to scale Willow's architecture to 1,000+ logical qubits by 2030, targeting applications in fusion energy simulation, drug discovery, and optimization problems that are intractable for classical computers. The company estimates that practical quantum advantage for commercial applications is now just 3-5 years away rather than decades.

As quantum computing transitions from laboratory curiosity to practical technology, Willow represents the foundation upon which the quantum future will be built.`,
          publishedAt: Date.now() - 86400000 * 3,
          readTime: 4,
          author: "Tyton Systems",
          handle: "@Tyton",
          tags: ["quantum computing", "Google", "error correction", "breakthrough"]
        },
        {
          id: "china-zuchongzhi-quantum-2025",
          title: "China Unveils Zuchongzhi 3.0: 105-Qubit Quantum Processor Achieves Quadrillion-Fold Speedup",
          excerpt: "Chinese scientists demonstrate quantum supremacy with their latest superconducting processor, rivaling global quantum computing leaders.",
          content: `Chinese researchers unveiled Zuchongzhi 3.0 this week, a 105-qubit superconducting quantum processor that achieved computational speeds quadrillions of times faster than leading supercomputers for quantum random circuit sampling tasks.

The breakthrough, announced by a team from the University of Science and Technology of China (USTC), represents a significant leap in China's quantum computing capabilities and positions the nation as a major competitor in the global quantum race.

**Technical Achievement**

Zuchongzhi 3.0 builds upon previous iterations with dramatically improved coherence times and gate fidelities. The processor maintains quantum states for over 100 microseconds—sufficient for complex quantum algorithms that require thousands of quantum operations.

"Our results demonstrate that China has achieved quantum computational advantage comparable to the world's leading systems," said Professor Pan Jianwei, who leads the quantum research team at USTC. The system performed quantum random circuit sampling in just 200 seconds, a task that would require classical supercomputers millions of years to complete.

**Strategic Implications**

The announcement comes as the United Nations declared 2025 the International Year of Quantum Science and Technology, highlighting the field's growing importance for national competitiveness. China's quantum achievements span multiple technological approaches, including superconducting circuits, trapped ions, and photonic systems.

Unlike Google's Willow chip, which focuses on error correction, Zuchongzhi 3.0 prioritizes quantum advantage demonstrations through specialized sampling problems. This approach validates China's strategy of pursuing multiple quantum computing pathways simultaneously.

**Applications and Partnerships**

Chinese technology giants including Alibaba, Baidu, and Tencent are integrating quantum computing research into their cloud platforms. Early applications focus on optimization problems in logistics, financial modeling, and artificial intelligence training.

The processor's architecture is particularly suited for machine learning applications, with quantum neural networks showing promise for pattern recognition tasks that exceed classical computer capabilities.

**Global Competition**

Zuchongzhi 3.0's capabilities place China alongside the United States and European Union in the quantum computing leadership tier. The achievement demonstrates that quantum computing development is increasingly becoming a multi-polar field rather than dominated by a single nation or company.

International collaboration remains strong despite geopolitical tensions, with Chinese researchers continuing to publish in leading journals and participate in global quantum science conferences.

**Future Roadmap**

China plans to achieve fault-tolerant quantum computing by 2030 through its national quantum development strategy. Investment in quantum research exceeds $15 billion annually, supporting both fundamental research and practical application development.

The Zuchongzhi series represents just one component of China's comprehensive quantum technology ecosystem, which includes quantum communication networks, quantum sensing systems, and quantum cryptography infrastructure already deployed in major cities.

As the global quantum computing race intensifies, achievements like Zuchongzhi 3.0 ensure that quantum advantage will emerge from multiple technological approaches and international research communities.`,
          publishedAt: Date.now() - 86400000 * 7,
          readTime: 5,
          author: "Tyton Systems",
          handle: "@Tyton",
          tags: ["quantum computing", "China", "Zuchongzhi", "technology competition"]
        },
        {
          id: "west-tokamak-fusion-record-2025",
          title: "WEST Tokamak Achieves 1,337-Second Fusion Record, Bringing Clean Energy Closer to Reality",
          excerpt: "French research facility maintains plasma for over 22 minutes, setting new world record and demonstrating fusion energy's commercial viability.",
          content: `The WEST (Tungsten Environment in Steady-state Tokamak) facility in France achieved a groundbreaking milestone this month, maintaining nuclear fusion plasma for 1,337 seconds—over 22 minutes—setting a new world record for sustained fusion reactions.

The achievement represents a 25% improvement over previous duration records and brings commercial fusion energy significantly closer to reality. WEST's success demonstrates that long-duration fusion reactions can be maintained with the stability and control necessary for power generation.

**Technical Breakthrough**

WEST's tokamak design uses superconducting magnets cooled to -269°C to contain plasma heated to 100 million degrees Celsius. The facility's tungsten-lined walls can withstand the extreme conditions while maintaining vacuum integrity for extended periods.

"This result validates our approach to steady-state fusion operation," explained Dr. Jérôme Bucalossi, WEST project leader at CEA (French Alternative Energies and Atomic Energy Commission). "We've proven that fusion reactors can operate continuously rather than in short pulses."

The 22-minute duration represents a critical threshold for commercial viability. Power plants require continuous operation to feed electricity into the grid, making WEST's achievement a crucial step toward practical fusion energy.

**Engineering Excellence**

WEST's success stems from advanced plasma control systems that use artificial intelligence to predict and counteract instabilities before they terminate the fusion reaction. Machine learning algorithms analyze plasma behavior in real-time, adjusting magnetic fields and heating systems with microsecond precision.

The facility's tungsten divertor—components that handle exhaust heat and particles—demonstrated exceptional durability under prolonged fusion conditions. This addresses a major challenge for future power plants, which must operate continuously for years without component failure.

**Global Impact**

WEST's record directly benefits ITER, the international fusion project under construction in southern France. ITER aims to achieve 500 MW of fusion power output, and WEST's operational experience provides crucial data for ITER's design optimization.

"WEST's achievements validate the physics and engineering approaches ITER will use," said Dr. Bernard Bigot, ITER Director-General. "This brings us confidence that ITER will achieve its goals when operations begin in 2036."

**Commercial Applications**

Private fusion companies are closely monitoring WEST's progress. Commonwealth Fusion Systems, TAE Technologies, and other ventures developing compact fusion reactors can apply WEST's control methodologies to their own designs.

The record also demonstrates fusion's potential for grid-scale electricity generation. A commercial fusion plant based on WEST's technology could generate 400-600 MW of continuous power—enough electricity for 300,000-450,000 homes.

**Future Milestones**

WEST plans to extend operation duration to one hour by late 2025, with ultimate goals of 1000-second operations at higher power levels. These achievements would prove fusion's readiness for commercial deployment.

France's fusion program, supported by €7 billion in government funding through 2030, positions Europe as a leader in fusion energy development alongside competitors in the United States, China, and Japan.

**Clean Energy Revolution**

Fusion energy produces no long-lived radioactive waste, no carbon emissions, and uses abundant fuel sources. WEST's record demonstrates that this clean energy source is transitioning from scientific curiosity to engineering reality.

As climate change accelerates the need for clean baseload power, WEST's achievement provides hope that fusion energy can complement renewable sources to decarbonize global electricity generation within the next two decades.`,
          publishedAt: Date.now() - 86400000 * 12,
          readTime: 6,
          author: "Tyton Systems",
          handle: "@Tyton",
          tags: ["nuclear fusion", "WEST tokamak", "clean energy", "France"]
        },
        {
          id: "k2-18b-biosignatures-2025",
          title: "James Webb Space Telescope Discovers Potential Life Signatures on Exoplanet K2-18b",
          excerpt: "Atmospheric analysis reveals dimethyl sulfide compounds that, on Earth, are only produced by living organisms, marking a potential breakthrough in astrobiology.",
          content: `The James Webb Space Telescope has detected compelling evidence of potential biological activity on K2-18b, a sub-Neptune exoplanet located 124 light-years away in the habitable zone of its red dwarf star.

Spectroscopic analysis of K2-18b's atmosphere revealed large quantities of dimethyl sulfide (DMS) and dimethyl disulfide (DMDS)—two compounds that, on Earth, are exclusively produced by living organisms. This discovery represents the strongest evidence yet for potential extraterrestrial life.

**A Water World with Promise**

K2-18b is 8.6 times more massive than Earth with an atmosphere rich in hydrogen and water vapor. Previous observations suggested the presence of water clouds and potentially a global ocean beneath its thick atmosphere—conditions that could support life as we know it.

"The detection of these sulfur compounds is extraordinary," said Dr. Nikku Madhusudhan, lead researcher at Cambridge University's Institute of Astronomy. "On Earth, DMS is produced by phytoplankton, bacteria, and other microorganisms. Finding it on K2-18b suggests we may be looking at our first glimpse of extraterrestrial biology."

**Biosignature Analysis**

Webb's near-infrared spectrometer detected the characteristic absorption lines of dimethyl sulfide at multiple wavelengths, confirming its presence throughout K2-18b's atmosphere. The compound's abundance and distribution patterns align with biological production rather than geological processes.

Computer models of K2-18b's atmospheric chemistry show that known non-biological processes cannot account for the observed DMS concentrations. This makes biological production the most plausible explanation for these compounds' presence.

**Technical Achievement**

The detection required Webb's unprecedented infrared sensitivity and spectral resolution. K2-18b's atmospheric signals are incredibly faint—the telescope had to observe the planet for over 40 hours across multiple transits to achieve sufficient signal-to-noise ratios.

"This pushes Webb to its absolute limits," explained Dr. Sarah Seager, atmospheric scientist at MIT. "We're detecting trace gases in an alien atmosphere 124 light-years away with precision that seemed impossible just a decade ago."

**Cautious Optimism**

While the results are promising, researchers emphasize the need for additional observations and alternative explanations. Unknown atmospheric chemistry or geological processes could potentially produce these compounds without biology.

The team plans follow-up observations with Webb's mid-infrared instrument to search for additional biosignatures including phosphine, methane, and oxygen. Confirming multiple biosignatures would strengthen the case for biological activity.

**Broader Implications**

K2-18b belongs to a class of exoplanets called "Hycean worlds"—hot, ocean-covered planets with hydrogen-rich atmospheres. These worlds are more common than Earth-like planets and may represent the most promising targets for detecting extraterrestrial life.

If confirmed, K2-18b would become the first known inhabited world beyond our solar system, fundamentally changing our understanding of life's prevalence in the universe.

**Next Steps**

NASA and ESA are developing next-generation space telescopes specifically designed for atmospheric characterization of potentially habitable worlds. The Habitable Worlds Observatory, planned for the 2040s, will have the sensitivity to directly image Earth-like exoplanets and analyze their atmospheres for signs of life.

**Scientific Revolution**

The discovery comes as astrobiology transitions from theoretical science to observational discipline. Webb's capabilities enable systematic surveys of exoplanet atmospheres, transforming the search for extraterrestrial life from speculation to empirical investigation.

Whether K2-18b harbors life remains to be definitively proven, but the detection of potential biosignatures represents a historic step toward answering one of humanity's most profound questions: Are we alone in the universe?

As Webb continues its observations and new telescopes come online, the next decade may finally provide the answer.`,
          publishedAt: Date.now() - 86400000 * 18,
          readTime: 7,
          author: "Tyton Systems",
          handle: "@Tyton",
          tags: ["exoplanets", "astrobiology", "James Webb", "K2-18b", "biosignatures"]
        },
        {
          id: "ligo-massive-black-hole-merger-2025",
          title: "LIGO Detects Most Massive Black Hole Merger Ever Observed, Challenges Formation Models",
          excerpt: "Gravitational wave detection reveals black hole collision producing final object of 225+ solar masses, providing new insights into cosmic evolution.",
          content: `The LIGO-Virgo-KAGRA Collaboration announced the detection of the most massive black hole merger ever observed through gravitational waves, producing a final black hole exceeding 225 solar masses and challenging existing models of black hole formation.

The detection, designated GW241205, was simultaneously observed by LIGO's two detectors in Louisiana and Washington, along with the European Virgo detector in Italy. The collision occurred approximately 8 billion years ago when the universe was roughly half its current age.

**Unprecedented Scale**

The merger involved two black holes with masses of approximately 100 and 85 solar masses—both in the "intermediate mass" category that has proven difficult to explain through conventional stellar evolution. Their collision released energy equivalent to 15 solar masses converted entirely to gravitational waves.

"This detection pushes the boundaries of what we thought possible for black hole formation," said Professor Mark Hannam of Cardiff University, member of the LIGO Scientific Collaboration. "Objects this massive challenge our understanding of how stars live and die."

**Formation Mystery**

Traditional stellar evolution cannot easily produce black holes exceeding 50-60 solar masses. Stars massive enough to collapse into such black holes typically lose too much mass through stellar winds before their final collapse. This has created the "mass gap" problem in black hole physics.

The detection of GW241205 suggests several possible formation mechanisms:
- **Primordial black holes** formed in the early universe before star formation began
- **Hierarchical mergers** where previous black hole collisions created these massive objects
- **Population III stars** from the universe's first generation of stars, which may have been much more massive than modern stars

**Technical Achievement**

The detection required extraordinary sensitivity from the LIGO-Virgo network. The gravitational waves from GW241205 were among the faintest ever detected, stretching and compressing space by less than 1/10,000th the width of a proton.

Advanced data analysis techniques using artificial intelligence helped extract the signal from background noise. Machine learning algorithms trained on thousands of simulated black hole mergers identified the characteristic "chirp" pattern as the two objects spiraled together over millions of years before their final collision.

**Cosmic Archaeology**

GW241205 provides a window into the early universe when black holes were forming through processes that no longer occur today. The 8-billion-year journey of these gravitational waves carries information about cosmic conditions when the universe was young and star formation was dramatically different.

"We're using gravitational waves as a time machine," explained Dr. Gabriela González, LIGO spokesperson and professor at Louisiana State University. "These waves carry pristine information about events that occurred before Earth even existed."

**Dark Matter Connections**

Some theoretical models suggest that intermediate-mass black holes could form from dark matter accumulation in the early universe. If confirmed, objects like those in GW241205 could provide indirect evidence for specific dark matter models and help explain the mysterious substance that comprises 85% of all matter.

**Future Observations**

Next-generation gravitational wave detectors currently under development will detect similar mergers at much greater distances and with higher precision. The Einstein Telescope in Europe and Cosmic Explorer in the United States will observe the entire universe for black hole mergers, potentially detecting thousands annually.

**Multimessenger Astronomy**

While GW241205 produced no detectable electromagnetic radiation—as expected for black hole mergers—future observations may detect associated phenomena such as accretion disk disruption or relativistic jets. Coordinated observations across the electromagnetic spectrum will provide comprehensive views of these extreme events.

**Fundamental Physics**

The detection also tests Einstein's general theory of relativity under the most extreme conditions in the universe. The gravitational waves' properties precisely match Einstein's predictions, confirming relativity's validity even for objects 100+ times more massive than the Sun moving at significant fractions of light speed.

**Scientific Impact**

GW241205 represents a new class of gravitational wave sources that will help astronomers understand:
- How the first black holes formed in the early universe
- The role of black holes in galaxy evolution
- The connection between dark matter and black hole formation
- The ultimate fate of the most massive stars

As gravitational wave astronomy matures from discovery science to precision measurement, detections like GW241205 open new chapters in our understanding of the cosmos and the extreme physics governing its most massive objects.`,
          publishedAt: Date.now() - 86400000 * 25,
          readTime: 8,
          author: "Tyton Systems",
          handle: "@Tyton",
          tags: ["gravitational waves", "LIGO", "black holes", "astrophysics", "cosmology"]
        }
      ];
    }

    // Initialize
    async function init() {
      log('System initializing...');
      
      // Initialize blog posts first
      initializeBlogPosts();
      
      // Initialize weather widget
      window.weatherWidget = new WeatherWidget();
      
      // Check authentication first
      await checkAuth();
      
      // Set up event listeners
      document.getElementById('createModalForm').addEventListener('submit', handleCreateSubmit);
      document.getElementById('profileForm').addEventListener('submit', handleProfileSubmit);
      document.getElementById('create-post-form').addEventListener('submit', handleCreatePost);
      
      // Close menus when clicking outside
      document.addEventListener('click', (e) => {
        // Close user menu
        const userMenu = document.getElementById('user-menu');
        const userDropdown = document.getElementById('user-dropdown');
        if (userMenu && userDropdown && !userMenu.contains(e.target)) {
          userDropdown.style.display = 'none';
          userDropdown.classList.remove('visible');
        }

      });
      
      // Handle auth redirect
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('auth') === 'success') {
        // Google auth success, reload to get session
        window.history.replaceState({}, document.title, window.location.pathname);
        await checkAuth();
      } else if (urlParams.get('error') === 'auth_failed') {
        showToast('Authentication failed. Please try again.', 'error');
        window.history.replaceState({}, document.title, window.location.pathname);
      } else if (urlParams.get('welcome') === 'true') {
        // User just completed profile setup
        window.history.replaceState({}, document.title, window.location.pathname);
        // Show welcome message or highlight features
        setTimeout(() => {
          showToast('Welcome to Tyton! Your profile has been set up successfully. You can now create projects and share marketplace items!', 'success', 6000);
        }, 500);
      }
      
      // Load data and update UI
      showLoading('Loading data...');
      try {
        await loadData();
      } finally {
        hideLoading();
      }
      
      // Ensure DOM is ready before updating route
      setTimeout(() => {
        updateRoute();
      }, 10);
      
      updateCreateType();
      updateProfile();
      updateAuthUI();
      
      log(`System initialized - Items: ${appState.items.length}, Following: ${Object.keys(appState.followers).length}`);
    }

    // Profile Edit Mode Functions
    let isEditMode = false;

    function toggleEditMode() {
      isEditMode = !isEditMode;
      
      if (isEditMode) {
        showEditMode();
      } else {
        hideEditMode();
      }
    }

    function showEditMode() {
      // Show form and divider
      const profileForm = document.getElementById('profileForm');
      const profileDivider = document.getElementById('profile-divider');
      const profileActions = document.querySelector('.profile-actions');
      
      if (profileForm) profileForm.style.display = 'grid';
      if (profileDivider) profileDivider.style.display = 'block';
      
      // Hide all profile action buttons during edit
      if (profileActions) {
        profileActions.style.setProperty('display', 'none', 'important');
        console.log('Profile actions hidden during edit mode');
      } else {
        console.log('Warning: profile-actions container not found');
      }
      
      // Populate form with current user data
      populateEditForm();
    }

    function hideEditMode() {
      // Hide form and divider
      const profileForm = document.getElementById('profileForm');
      const profileDivider = document.getElementById('profile-divider');
      const profileActions = document.querySelector('.profile-actions');
      
      if (profileForm) profileForm.style.display = 'none';
      if (profileDivider) profileDivider.style.display = 'none';
      
      // Show all profile action buttons again
      if (profileActions) profileActions.style.setProperty('display', 'flex', 'important');
    }

    function cancelEditMode() {
      isEditMode = false;
      hideEditMode();
    }

    function populateEditForm() {
      if (!appState.currentUser) return;
      
      const user = appState.currentUser;
      
      // Split name into first and last
      const nameParts = (user.name || '').split(' ');
      const firstName = nameParts[0] || '';
      const lastName = nameParts.slice(1).join(' ') || '';
      
      // Populate form fields
      document.getElementById('profile-first-name').value = firstName;
      document.getElementById('profile-last-name').value = lastName;
      document.getElementById('profile-handle').value = user.handle || '';
      document.getElementById('profile-research-area').value = user.researchArea || '';
      document.getElementById('profile-institution').value = user.institution || '';
      document.getElementById('profile-academic-level').value = user.academicLevel || '';
      document.getElementById('profile-bio').value = user.bio || '';
      document.getElementById('profile-location').value = user.location || '';
      document.getElementById('profile-photo').value = user.photo || '';
    }

    // Search functionality
    async function handleSearchKeyPress(event) {
      if (event.key === 'Enter') {
        const query = event.target.value.trim();
        if (query) {
          await performSearch(query);
        }
      }
    }
    
    async function performSearch(query) {
      showLoading('Searching...');
      try {
        const response = await apiCall(`/search?q=${encodeURIComponent(query)}`);
        
        if (response.count === 0) {
          showToast('No results found', 'info');
        } else {
          // Display search results
          displaySearchResults(response);
          showToast(`Found ${response.count} results`, 'success');
        }
      } catch (error) {
        showToast('Search failed: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }
    
    function displaySearchResults(searchResponse) {
      // Switch to search view
      appState.route = 'search';
      appState.searchResults = searchResponse.results;
      
      // Hide all pages
      document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
      
      // Create or update search results page
      let searchPage = document.getElementById('search-page');
      if (!searchPage) {
        searchPage = document.createElement('div');
        searchPage.id = 'search-page';
        searchPage.className = 'page';
        document.getElementById('app').appendChild(searchPage);
      }
      
      searchPage.innerHTML = `
        <div class="section">
          <h2 class="page-title">Search Results</h2>
          <p style="color: var(--muted); margin-bottom: 24px;">
            Found ${searchResponse.count} results for "${escapeHtml(searchResponse.query)}"
          </p>
          <div class="grid">
            ${searchResponse.results.map(item => `
              <div class="card">
                <div class="card-header">
                  <span class="card-type ${escapeAttribute(item.type)}">${item.type === 'project' ? '📊' : '🔧'} ${escapeHtml(item.type)}</span>
                  <span class="card-meta">${escapeHtml(item.owner)}</span>
                </div>
                <h3>${escapeHtml(item.title)}</h3>
                <p>${escapeHtml(item.description)}</p>
                ${item.tags ? `
                  <div class="tags">
                    ${item.tags.split(',').map(tag => `<span class="tag">${escapeHtml(tag.trim())}</span>`).join('')}
                  </div>
                ` : ''}
                <div class="card-footer">
                  <button class="btn" onclick="likeItem('${escapeAttribute(item.id)}')">
                    ${item.likedBy?.includes(appState.currentUser?.id) ? '❤️' : '🤍'} ${item.likes || 0}
                  </button>
                  <button class="btn" onclick="toggleFollow('${escapeAttribute(item.id)}')">
                    ${appState.followers[item.id] ? '✓ Following' : '+ Follow'}
                  </button>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
      
      searchPage.style.display = 'block';
    }

    // Search Page Functions
    let searchFilter = 'all';
    let searchDebounceTimer = null;

    function handleSearchInput(event) {
      const query = event.target.value.trim();
      
      // Clear existing timer
      if (searchDebounceTimer) {
        clearTimeout(searchDebounceTimer);
      }
      
      // Debounce search to avoid too many requests
      searchDebounceTimer = setTimeout(() => {
        performSearchPageQuery(query);
      }, 300);
    }

    function setSearchFilter(filter) {
      searchFilter = filter;
      
      // Update active button
      document.querySelectorAll('.search-filter').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-filter="${filter}"]`).classList.add('active');
      
      // Re-run search if there's a query
      const query = document.getElementById('search-page-input').value.trim();
      if (query) {
        performSearchPageQuery(query);
      }
    }

    async function performSearchPageQuery(query) {
      const resultsContainer = document.getElementById('search-results-container');
      const loadingDiv = document.getElementById('search-results-loading');
      const emptyDiv = document.getElementById('search-results-empty');
      const resultsList = document.getElementById('search-results-list');
      
      if (!query) {
        loadingDiv.style.display = 'none';
        emptyDiv.style.display = 'block';
        resultsList.style.display = 'none';
        return;
      }
      
      // Show loading state
      loadingDiv.style.display = 'block';
      emptyDiv.style.display = 'none';
      resultsList.style.display = 'none';
      
      try {
        // Perform search based on filter
        let results = [];
        
        if (searchFilter === 'all' || searchFilter === 'projects') {
          const projects = appState.items.filter(item => 
            item.type === 'project' && 
            (item.title.toLowerCase().includes(query.toLowerCase()) ||
             item.description.toLowerCase().includes(query.toLowerCase()) ||
             (item.tags && item.tags.toLowerCase().includes(query.toLowerCase())))
          );
          results = results.concat(projects.map(p => ({...p, resultType: 'project'})));
        }
        
        if (searchFilter === 'all' || searchFilter === 'equipment') {
          const equipment = appState.items.filter(item => 
            item.type === 'equipment' && 
            (item.title.toLowerCase().includes(query.toLowerCase()) ||
             item.description.toLowerCase().includes(query.toLowerCase()) ||
             (item.tags && item.tags.toLowerCase().includes(query.toLowerCase())))
          );
          results = results.concat(equipment.map(e => ({...e, resultType: 'equipment'})));
        }
        
        if (searchFilter === 'all' || searchFilter === 'discussions') {
          const discussions = appState.discussions.filter(d => 
            d.title.toLowerCase().includes(query.toLowerCase()) ||
            d.content.toLowerCase().includes(query.toLowerCase())
          );
          results = results.concat(discussions.map(d => ({...d, resultType: 'discussion'})));
        }
        
        if (searchFilter === 'all' || searchFilter === 'papers') {
          const papers = appState.journalPapers.filter(p => 
            p.title.toLowerCase().includes(query.toLowerCase()) ||
            p.authors.toLowerCase().includes(query.toLowerCase()) ||
            p.abstract.toLowerCase().includes(query.toLowerCase())
          );
          results = results.concat(papers.map(p => ({...p, resultType: 'paper'})));
        }
        
        // Display results
        displaySearchPageResults(results);
        
      } catch (error) {
        console.error('Search error:', error);
        showToast('Search failed. Please try again.', 'error');
      } finally {
        loadingDiv.style.display = 'none';
      }
    }

    function displaySearchPageResults(results) {
      const resultsList = document.getElementById('search-results-list');
      const emptyDiv = document.getElementById('search-results-empty');
      
      if (results.length === 0) {
        emptyDiv.innerHTML = `
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="opacity: 0.3; margin-bottom: 16px;">
            <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M16 16L20 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <h3 style="color: var(--muted); font-weight: 500;">No results found</h3>
          <p style="color: var(--muted); opacity: 0.7; margin-top: 8px;">Try different keywords or filters</p>
        `;
        emptyDiv.style.display = 'block';
        resultsList.style.display = 'none';
        return;
      }
      
      // Build results HTML
      let html = `<h3 style="margin-bottom: 20px;">Found ${results.length} result${results.length !== 1 ? 's' : ''}</h3>`;
      
      results.forEach(result => {
        const typeLabel = result.resultType.charAt(0).toUpperCase() + result.resultType.slice(1);
        const typeColor = {
          project: 'var(--gold)',
          equipment: 'var(--atomic-cyan)',
          discussion: 'var(--cosmic-purple)',
          paper: 'var(--retro-orange)'
        }[result.resultType] || 'var(--muted)';
        
        html += `
          <div class="search-result-item" onclick="navigateToResult('${result.resultType}', '${result.id}')">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
              <h4 style="margin: 0; color: var(--white);">${escapeHtml(result.title)}</h4>
              <span style="background: ${typeColor}; color: var(--ink); padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: 600;">
                ${typeLabel}
              </span>
            </div>
            <p style="color: var(--muted); margin: 0 0 8px 0; line-height: 1.5;">
              ${escapeHtml(result.description || result.content || result.abstract || 'No description available').substring(0, 200)}...
            </p>
            <div style="display: flex; gap: 16px; font-size: 13px; color: var(--muted);">
              ${result.owner ? `<span>By @${escapeHtml(result.owner)}</span>` : ''}
              ${result.createdAt ? `<span>${new Date(result.createdAt).toLocaleDateString()}</span>` : ''}
              ${result.tags ? `<span>${escapeHtml(result.tags)}</span>` : ''}
            </div>
          </div>
        `;
      });
      
      resultsList.innerHTML = html;
      resultsList.style.display = 'block';
      emptyDiv.style.display = 'none';
    }

    function navigateToResult(type, id) {
      switch(type) {
        case 'project':
          window.location.href = `/project.html?id=${id}`;
          break;
        case 'equipment':
          window.location.href = `/marketplace.html?id=${id}`;
          break;
        case 'discussion':
          window.location.href = `/discussion-thread.html?id=${id}`;
          break;
        case 'paper':
          // For now, just show the journal page
          setRoute('journal');
          break;
      }
    }

    // Demo data seeding
    async function seedDemoData() {
      showLoading('Loading demo data...');
      try {
        const response = await apiCall('/seed', { method: 'POST' });
        await loadData();
        updateRoute();
        showToast('Demo data loaded successfully! Explore projects and equipment.', 'success', 5000);
        
        // Hide the welcome screen if it exists
        const welcomeScreen = document.getElementById('welcome-screen');
        if (welcomeScreen) {
          welcomeScreen.style.display = 'none';
        }
      } catch (error) {
        showToast('Failed to load demo data: ' + error.message, 'error');
      } finally {
        hideLoading();
      }
    }
    
    // Check if this is a new user (no data)
    async function checkNewUser() {
      const data = await loadData();
      if ((!data.items || data.items.length === 0) && !appState.currentUser) {
        showWelcomeScreen();
      }
    }
    
    // Show welcome screen for new users
    function showWelcomeScreen() {
      const welcomeScreen = document.createElement('div');
      welcomeScreen.id = 'welcome-screen';
      welcomeScreen.className = 'modal-overlay';
      welcomeScreen.style.display = 'flex';
      welcomeScreen.style.background = 'linear-gradient(135deg, rgba(10,13,26,0.95) 0%, rgba(26,35,56,0.95) 100%)';
      
      welcomeScreen.innerHTML = `
        <div class="modal-content" style="max-width: 600px; text-align: center;">
          <img src="/assets/logo.png" alt="Tyton" style="width: 120px; height: 120px; margin-bottom: 24px;" 
               onerror="this.src='${generateFallbackLogo()}'">
          
          <h1 style="font-size: 36px; margin-bottom: 16px;">Welcome to Tyton</h1>
          <p style="font-size: 18px; color: var(--muted); margin-bottom: 32px;">
            A modern research collaboration platform for projects and equipment sharing
          </p>
          
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 32px;">
            <div>
              <div style="font-size: 32px; margin-bottom: 8px;">📊</div>
              <h3>Share Projects</h3>
              <p style="color: var(--muted); font-size: 14px;">Collaborate on research initiatives</p>
            </div>
            <div>
              <div style="font-size: 32px; margin-bottom: 8px;">🔧</div>
              <h3>Book Equipment</h3>
              <p style="color: var(--muted); font-size: 14px;">Access shared lab resources</p>
            </div>
            <div>
              <div style="font-size: 32px; margin-bottom: 8px;">👥</div>
              <h3>Connect</h3>
              <p style="color: var(--muted); font-size: 14px;">Build your research network</p>
            </div>
          </div>
          
          <div style="display: flex; gap: 16px; justify-content: center;">
            <button class="btn gold" onclick="showAuthModal('register'); document.getElementById('welcome-screen').remove();">
              Get Started
            </button>
            <button class="btn" onclick="seedDemoData(); document.getElementById('welcome-screen').remove();">
              Explore Demo
            </button>
            <button class="btn" onclick="document.getElementById('welcome-screen').remove();">
              Skip
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(welcomeScreen);
    }
    
    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', async () => {
      await init();
      // Check if new user after a short delay
      setTimeout(checkNewUser, 1000);
    });
  </script>

  <!-- Create Item Modal -->
  <div id="createModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Create New Item</h3>
        <button class="modal-close" onclick="hideCreateModal()">×</button>
      </div>
      
      <form id="createModalForm">
        <div class="tabs">
          <button type="button" id="modal-tab-project" onclick="setCreateType('project')">
            📊 Project
          </button>
          <button type="button" id="modal-tab-equipment" onclick="setCreateType('equipment')">
            🔧 Equipment
          </button>
        </div>
        
        <div class="modal-form-grid">
          <div class="field">
            <label>Title</label>
            <input name="title" placeholder="Name your project or equipment" required>
          </div>
          <div class="field">
            <label>Location</label>
            <input name="location" placeholder="Lab, building, or remote">
          </div>
          <div class="field field-full">
            <label>Description</label>
            <textarea name="description" rows="4" placeholder="Describe your project goals, methodology, or equipment specifications" required></textarea>
          </div>
          <div class="field field-full">
            <label>Tags</label>
            <input name="tags" placeholder="Separate with commas: quantum, AI, biotech">
          </div>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn" onclick="hideCreateModal()">Cancel</button>
          <button class="btn gold" type="submit">🚀 Create Item</button>
        </div>
      </form>
    </div>
  </div>

  <style>
    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(8px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal-content {
      background: 
        linear-gradient(135deg, var(--card) 0%, rgba(15,22,41,.95) 100%),
        linear-gradient(135deg, rgba(255,107,53,.08) 0%, rgba(139,92,246,.05) 50%, rgba(0,212,170,.07) 100%);
      border: 1px solid var(--border-accent);
      border-radius: 20px;
      padding: 0;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow:
        0 25px 50px rgba(0,0,0,.5),
        0 10px 20px rgba(0,0,0,.3),
        0 0 0 1px rgba(218,165,32,.3),
        inset 0 1px 0 rgba(241,245,249,.08);
      position: relative;
    }

    .modal-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, #b8860b, #daa520, #ffd700, transparent);
      opacity: 0.8;
      pointer-events: none;
      box-shadow: 0 0 8px rgba(218, 165, 32, 0.2);
    }

    .modal-header {
      padding: 24px 32px 0 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-subtle);
      margin-bottom: 24px;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--muted);
      font-size: 32px;
      line-height: 1;
      cursor: pointer;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: all 0.2s ease;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--white);
    }

    .modal-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      padding: 0 32px;
      margin-bottom: 24px;
    }

    .field-full {
      grid-column: span 2;
    }

    .modal-actions {
      padding: 24px 32px 32px 32px;
      display: flex;
      gap: 16px;
      justify-content: flex-end;
      border-top: 1px solid var(--border-subtle);
    }

    /* Modal form tabs */
    #createModalForm .tabs {
      margin: 0 32px 24px 32px;
      padding-bottom: 16px;
    }

    @media (max-width: 768px) {
      .modal-content {
        margin: 10px;
        max-height: 95vh;
      }
      
      .modal-header,
      .modal-form-grid,
      .modal-actions {
        padding-left: 20px;
        padding-right: 20px;
      }
      
      .modal-form-grid {
        grid-template-columns: 1fr;
      }
      
      .field-full {
        grid-column: span 1;
      }
      
      .modal-actions {
        flex-direction: column;
      }
    }
  </style>
  
  <!-- Footer with Quick Actions -->
  <footer style="margin-top: 60px; padding: 24px; background: var(--card); border-top: 1px solid rgba(255,255,255,0.1);">
    <div style="max-width: 1200px; margin: 0 auto; text-align: center;">
      <p style="color: var(--muted); margin-bottom: 8px;">
        Tyton Demo - Research Collaboration Platform
      </p>
      <p style="color: var(--muted); font-size: 11px; margin-bottom: 16px; opacity: 0.7;">
        © 2025 Tyton Systems - All rights reserved
      </p>
      <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
        <button class="btn" onclick="seedDemoData()" title="Load sample projects and equipment">
          🎭 Load Demo Data
        </button>
        <button class="btn" onclick="if(confirm('This will reset all data. Are you sure?')) { apiCall('/reset', {method:'DELETE'}).then(() => location.reload()) }">
          🔄 Reset Data
        </button>
        <button class="btn" onclick="showToast('API Docs: GET /api/data, POST /api/items, GET /api/search', 'info', 6000)">
          📖 API Info
        </button>
      </div>
    </div>
  </footer>
</body>
</html>